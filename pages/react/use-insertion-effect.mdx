# useInsertionEffect: CSS-in-JS –∏ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π

`useInsertionEffect` ‚Äî —ç—Ç–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è `useLayoutEffect`, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–∞—è –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –¥–ª—è –±–∏–±–ª–∏–æ—Ç–µ–∫ **CSS-in-JS**. –û–Ω –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è *–¥–æ* –ª—é–±—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ DOM –∏ *–¥–æ* —Ç–æ–≥–æ, –∫–∞–∫ —Å—Ä–∞–±–æ—Ç–∞—é—Ç `useLayoutEffect`.

### –ü–æ—á–µ–º—É –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?

[Icon: Info] –û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã—Ö CSS-in-JS –±–∏–±–ª–∏–æ—Ç–µ–∫ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ –∫–æ–≥–¥–∞ —Å—Ç–∏–ª–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∏–ª–∏ –∏–∑–º–µ–Ω—è—é—Ç—Å—è –≤–æ –≤—Ä–µ–º—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ `useEffect`), –±—Ä–∞—É–∑–µ—Ä –≤—ã–Ω—É–∂–¥–µ–Ω –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å —Å—Ç–∏–ª–∏ (recalculate styles) –¥–ª—è –≤—Å–µ–≥–æ –¥–µ—Ä–µ–≤–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤. –ï—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–∞—Å—Ç–æ, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–∞–¥–∞–µ—Ç.

`useInsertionEffect` –ø–æ–∑–≤–æ–ª—è–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º –≤—Å—Ç–∞–≤–ª—è—Ç—å —Ç–µ–≥–∏ `<style>` –≤ DOM –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –±—Ä–∞—É–∑–µ—Ä –Ω–∞—á–Ω–µ—Ç –≤—ã—á–∏—Å–ª—è—Ç—å –º–∞–∫–µ—Ç (layout).

### –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ö—É–∫–æ–≤

1.  **Render:** React –≤—ã—á–∏—Å–ª—è–µ—Ç, —á—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ DOM.
2.  **useInsertionEffect:** –í—Å—Ç–∞–≤–∫–∞ —Å—Ç–∏–ª–µ–π –≤ DOM.
3.  **[useLayoutEffect](/react/use-layout-effect):** –ß—Ç–µ–Ω–∏–µ –º–∞–∫–µ—Ç–∞ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è DOM.
4.  **useEffect:** –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã (–∑–∞–ø—Ä–æ—Å—ã, –ø–æ–¥–ø–∏—Å–∫–∏).

```mermaid
graph TD
    A[Render Phase] --> B[useInsertionEffect]
    B --> C[DOM Mutations]
    C --> D[useLayoutEffect]
    D --> E[Browser Paints]
    E --> F[useEffect]
```

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

–û–±—ã—á–Ω–æ —ç—Ç–æ—Ç —Ö—É–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π CSS-in-JS. –í–æ—Ç —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä:

```tsx
import { useInsertionEffect } from 'react';

// –ì–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –≤—Å—Ç–∞–≤–∫–∏ —Å—Ç–∏–ª–µ–π
function useCSS(styleObject) {
  useInsertionEffect(() => {
    const styleTag = document.createElement('style');
    styleTag.textContent = generateCSS(styleObject);
    document.head.appendChild(styleTag);

    return () => {
      document.head.removeChild(styleTag);
    };
  }, [styleObject]);
}

function MyComponent() {
  useCSS({ color: 'red', fontSize: '20px' });
  return <div className="dynamic-style">–ü—Ä–∏–≤–µ—Ç, –º–∏—Ä!</div>;
}
```

### –ö–ª—é—á–µ–≤—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- **–¢–æ–ª—å–∫–æ –¥–ª—è –±–∏–±–ª–∏–æ—Ç–µ–∫:** –ï—Å–ª–∏ –≤—ã –Ω–µ –ø–∏—à–µ—Ç–µ —Å–≤–æ—é CSS-in-JS –±–∏–±–ª–∏–æ—Ç–µ–∫—É, –≤–∞–º –ø–æ—á—Ç–∏ –Ω–∞–≤–µ—Ä–Ω—è–∫–∞ –Ω–µ –Ω—É–∂–µ–Ω —ç—Ç–æ—Ç —Ö—É–∫.
- **–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ refs:** –í–Ω—É—Ç—Ä–∏ `useInsertionEffect` –≤—ã –Ω–µ –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ `ref.current` —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤–∞—à–µ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞, —Ç–∞–∫ –∫–∞–∫ DOM –µ—â–µ –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω.
- **–¢–æ–ª—å–∫–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ:** –ö–∞–∫ –∏ –¥—Ä—É–≥–∏–µ —ç—Ñ—Ñ–µ–∫—Ç—ã, –æ–Ω –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ —Å–µ—Ä–≤–µ—Ä–Ω–æ–º —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ (SSR).

[Icon: Alert-Triangle] **–í–∞–∂–Ω–æ:** –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç —Ö—É–∫ –¥–ª—è –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Å–≤—è–∑–∞–Ω—ã —Å–æ —Å—Ç–∏–ª—è–º–∏. –î–ª—è –æ–±—ã—á–Ω—ã—Ö –∑–∞–¥–∞—á –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `useEffect` –∏–ª–∏ `useLayoutEffect`.

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏
- [string`. –ï—Å–ª–∏ —à–∏—Ä–∏–Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `div`) —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –º–µ–Ω—å—à–µ 300px, —Ç–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω —É—Å–µ–∫–∞—Ç—å—Å—è –∏ –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –º–Ω–æ–≥–æ—Ç–æ—á–∏–µ (`...`). –ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –ø–ª–∞–≤–Ω–æ –∏ –±–µ–∑ –º–µ—Ä—Ü–∞–Ω–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞ –±—Ä–∞—É–∑–µ—Ä–∞.
    *   –ü–æ–¥—Å–∫–∞–∑–∫–∞: –í–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è `useRef` –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∏ `ResizeObserver` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ä–∞–∑–º–µ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –≤—ã –±—É–¥–µ—Ç–µ –ø–æ–¥–∫–ª—é—á–∞—Ç—å/–æ—Ç–∫–ª—é—á–∞—Ç—å –≤ `useLayoutEffect` –∏–ª–∏ `useEffect`. –ù–æ —Å–∞–º–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —É—Å–µ—á–µ–Ω–∏—è, –∑–∞–≤–∏—Å—è—â–µ–µ –æ—Ç —Ä–∞–∑–º–µ—Ä–æ–≤, –ª—É—á—à–µ –¥–µ–ª–∞—Ç—å —á–µ—Ä–µ–∑ `useLayoutEffect`.

3.  **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ç—É–ª—Ç–∏–ø (–≤—Å–ø–ª—ã–≤–∞—é—â–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞)**:
    –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `Tooltip` (–∫–æ—Ç–æ—Ä—ã–π —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ `Button` –∏–ª–∏ `HoverArea` –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞). –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–≤–æ–¥–∏—Ç –∫—É—Ä—Å–æ—Ä –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç, –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ç—É–ª—Ç–∏–ø. `Tooltip` –¥–æ–ª–∂–µ–Ω –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —ç–ª–µ–º–µ–Ω—Ç–∞, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–≤–µ–ª–∏, –∏ *–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å*, —á—Ç–æ –æ–Ω –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –≤–∏–¥–∏–º–æ–π –æ–±–ª–∞—Å—Ç–∏ —ç–∫—Ä–∞–Ω–∞ (viewport). –ü–µ—Ä–µ—Å—á–µ—Ç –ø–æ–∑–∏—Ü–∏–∏ –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –≤ `useLayoutEffect` –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–æ—è–≤–ª–µ–Ω–∏–∏ —Ç—É–ª—Ç–∏–ø–∞ –∏–ª–∏ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ/—Ä–µ—Å–∞–π–∑–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
    *   –ü–æ–¥—Å–∫–∞–∑–∫–∞: `getBoundingClientRect()` —ç–ª–µ–º–µ–Ω—Ç–∞-—Ç—Ä–∏–≥–≥–µ—Ä–∞ –∏ `window.innerWidth`/`window.innerHeight` –¥–ª—è viewport. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `useState` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ —Ç—É–ª—Ç–∏–ø–∞ (`top`, `left`).

### ### üí° –°–æ–≤–µ—Ç

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `useLayoutEffect` —Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ –≤–∞–º –∞–±—Å–æ–ª—é—Ç–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å DOM –ø–æ—Å–ª–µ –µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è React](/react/use-layout-effect)

### –ü—Ä–∞–∫—Ç–∏–∫–∞

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–∏–º–µ—Ä—ã –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ:

<Playground template="react" />

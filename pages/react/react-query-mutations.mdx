# [TanStack Query](/react/react-query-intro): –ú—É—Ç–∞—Ü–∏–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞

–í —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ `useQuery` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è *—á—Ç–µ–Ω–∏—è* –¥–∞–Ω–Ω—ã—Ö, —Ö—É–∫ **`useMutation`** –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∏—Ö *–∏–∑–º–µ–Ω–µ–Ω–∏—è* (—Å–æ–∑–¥–∞–Ω–∏—è, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, —É–¥–∞–ª–µ–Ω–∏—è).

### –ü—Ä–æ–±–ª–µ–º–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

–ö–æ–≥–¥–∞ –≤—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ POST-–∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä, –≤–∞—à –ª–æ–∫–∞–ª—å–Ω—ã–π –∫—ç—à (—Ç–æ, —á—Ç–æ –±—ã–ª–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ —á–µ—Ä–µ–∑ `useQuery`) —É—Å—Ç–∞—Ä–µ–≤–∞–µ—Ç. –í–∞–º –Ω—É–∂–Ω–æ —Å–æ–æ–±—â–∏—Ç—å [TanStack Query](/react/react-query-intro), —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –Ω—É–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞–Ω–æ–≤–æ.

```mermaid
flowchart TD
    A[Start Mutation] --> B[API Request]
    B -- Success --> C[Invalidate Queries]
    C --> D[Refetch Data]
    D --> E[UI Updated]
```

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `useMutation`

```tsx
import { useMutation, useQueryClient } from '@tanstack/react-query';

function AddTodo() {
  const queryClient = useQueryClient();

  const mutation = useMutation({
    mutationFn: (newTodo) => {
      return fetch('/api/todos', {
        method: 'POST',
        body: JSON.stringify(newTodo),
      });
    },
    onSuccess: () => {
      // 1. –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º –∫—ç—à –ø–æ –∫–ª—é—á—É 'todos'
      // –≠—Ç–æ –∑–∞—Å—Ç–∞–≤–∏—Ç –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ ['todos'], –ø–µ—Ä–µ–∫–∞—á–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
      queryClient.invalidateQueries({ queryKey: ['todos'] });
    },
  });

  return (
    <button onClick={() => mutation.mutate({ title: '–ö—É–ø–∏—Ç—å –º–æ–ª–æ–∫–æ' })}>
      –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É
    </button>
  );
}
```

### Optimistic Updates (–û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)

–≠—Ç–æ —Ç–µ—Ö–Ω–∏–∫–∞, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –º—ã –æ–±–Ω–æ–≤–ª—è–µ–º UI *–¥–æ —Ç–æ–≥–æ*, –∫–∞–∫ —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏—à–ª–µ—Ç –æ—Ç–≤–µ—Ç. –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å —É–ø–∞–¥–µ—Ç, –º—ã –æ—Ç–∫–∞—Ç—ã–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è.

[Icon: Zap] –≠—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –æ—â—É—â–µ–Ω–∏–µ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.

```tsx
onMutate: async (newTodo) => {
  await queryClient.cancelQueries({ queryKey: ['todos'] });
  const previousTodos = queryClient.getQueryData(['todos']);
  queryClient.setQueryData(['todos'], (old) => [...old, newTodo]);
  return { previousTodos }; // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–µ–π—Ç –¥–ª—è –æ—Ç–∫–∞—Ç–∞
},
onError: (err, newTodo, context) => {
  queryClient.setQueryData(['todos'], context.previousTodos);
},
```

### –ò—Ç–æ–≥

[Icon: Check] **Mutation:** –õ–æ–≥–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.
[Icon: Refresh-Ccw] **Invalidation:** –°–ø–æ—Å–æ–± –¥–µ—Ä–∂–∞—Ç—å –∫—ç—à –≤ –∞–∫—Ç—É–∞–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏.
[Icon: Layout] **DevTools:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ [React Query](/react/react-query-intro) DevTools, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å, –∫–∞–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã —Å–µ–π—á–∞—Å –≤ —Å—Ç–∞—Ç—É—Å–µ `fetching`, `stale` –∏–ª–∏ `inactive`.

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏
- [TanStack Query (React Query): –†–∞–±–æ—Ç–∞ —Å —Å–µ—Ä–≤–µ—Ä–Ω—ã–º —Å—Ç–µ–π—Ç–æ–º](/react/react-query-intro)

### –ü—Ä–∞–∫—Ç–∏–∫–∞

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–∏–º–µ—Ä—ã –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ:

<Playground template="react" />

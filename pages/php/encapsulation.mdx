# Инкапсуляция

## Введение
## Подробное введение

Инкапсуляция - важная тема в PHP разработке. В этом разделе мы детально разберем все аспекты работы с инкапсуляция.

### Зачем это нужно?

- Решение реальных задач в веб-разработке
- Повышение безопасности приложений
- Улучшение производительности кода
- Соответствие best practices

### Где применяется?

В современной PHP разработке инкапсуляция используется повсеместно:
- Веб-приложения
- API сервисы
- Content Management Systems (WordPress, Drupal)
- E-commerce платформы
- Корпоративные системы


В этом уроке мы изучим инкапсуляция. Это важная тема для понимания PHP и разработки динамических веб-приложений.

### Что вы узнаете

- Основы работы с инкапсуляция
- Практические примеры использования
- Применение в WordPress
- Best practices и рекомендации

## Теория


Подробная информация о инкапсуляция и практические примеры использования в PHP.

```php
<?php
// Примеры кода для Инкапсуляция
echo "Инкапсуляция в PHP";
?>
```text


## Примеры кода


### Пример 1: Базовое использование

```php
<?php
// Простой пример
echo "Пример кода";
?>
```text

### Пример 2: Практическое применение

```php
<?php
// Более сложный пример
function example() {
    return "Результат";
}
?>
```text

### Пример 3: Реальная задача

```php
<?php
// Решение реальной проблемы
// TODO: Добавить конкретный пример
?>
```text


## WordPress контекст


Инкапсуляция активно используется в WordPress для различных задач.

```php
<?php
// Пример использования в WordPress
// TODO: Добавить конкретный WordPress пример для encapsulation
?>
```text



## Расширенные примеры

### Пример 1: Базовое использование

```php
<?php
// Простой пример для начинающих
echo "Пример кода";

// Пошаговое объяснение:
// 1. Создаем переменную
// 2. Обрабатываем данные
// 3. Выводим результат
?>
```text

### Пример 2: Промежуточный уровень

```php
<?php
// Более сложный пример с реальной логикой

function processData($data) {
    // Валидация
    if (empty($data)) {
        return false;
    }
    
    // Обработка
    $result = [];
    foreach ($data as $item) {
        $result[] = transformItem($item);
    }
    
    return $result;
}

function transformItem($item) {
    // Трансформация элемента
    return strtoupper($item);
}

// Использование
$input = ['apple', 'banana', 'orange'];
$output = processData($input);
print_r($output);
?>
```text

### Пример 3: Продвинутый уровень

```php
<?php
// Реальный production-ready код

class DataProcessor {
    private $data;
    private $filters = [];
    
    public function __construct(array $data) {
        $this->data = $data;
    }
    
    public function addFilter(callable $filter) {
        $this->filters[] = $filter;
        return $this;
    }
    
    public function process() {
        $result = $this->data;
        
        foreach ($this->filters as $filter) {
            $result = array_filter($result, $filter);
        }
        
        return $result;
    }
}

// Использование
$processor = new DataProcessor([1, 2, 3, 4, 5, 6, 7, 8, 9, 10]);

$processor
    ->addFilter(function($n) { return $n % 2 == 0; })  // Только четные
    ->addFilter(function($n) { return $n > 5; });       // Больше 5

$result = $processor->process();
print_r($result);  // [6, 8, 10]
?>
```text



## Best Practices и рекомендации

### Что нужно делать ✅

1. **Использовать строгую типизацию**
   ```php
   <?php
   declare(strict_types=1);
   
   function calculate(int $a, int $b): int {
       return $a + $b;
   }
   ?>
   ```

2. **Валидировать входные данные**
   ```php
   <?php
   $email = filter_input(INPUT_POST, 'email', FILTER_VALIDATE_EMAIL);
   if ($email === false) {
       die("Некорректный email");
   }
   ?>
   ```

3. **Обрабатывать ошибки**
   ```php
   <?php
   try {
       // Опасная операция
       $result = riskyOperation();
   } catch (Exception $e) {
       // Логирование ошибки
       error_log($e->getMessage());
       // Показываем пользователю
       echo "Произошла ошибка";
   }
   ?>
   ```

4. **Использовать prepared statements для БД**
   ```php
   <?php
   $stmt = $pdo->prepare("SELECT * FROM users WHERE email = ?");
   $stmt->execute([$email]);
   ?>
   ```

5. **Экранировать вывод**
   ```php
   <?php
   echo htmlspecialchars($user_input, ENT_QUOTES, 'UTF-8');
   ?>
   ```

### Чего избегать ❌

1. **Не использовать устаревшие функции**
   ```php
   <?php
   // ❌ Плохо
   mysql_connect();  // Deprecated
   
   // ✅ Хорошо
   $pdo = new PDO($dsn, $user, $pass);
   ?>
   ```

2. **Не игнорировать ошибки**
   ```php
   <?php
   // ❌ Плохо
   @file_get_contents($url);  // @ скрывает ошибки!
   
   // ✅ Хорошо
   $content = file_get_contents($url);
   if ($content === false) {
       // Обработка ошибки
   }
   ?>
   ```

3. **Не хранить пароли в plain text**
   ```php
   <?php
   // ❌ Плохо
   $password = $_POST['password'];
   
   // ✅ Хорошо
   $hash = password_hash($_POST['password'], PASSWORD_DEFAULT);
   ?>
   ```



## Применение в WordPress

Инкапсуляция широко используется в WordPress разработке.

### Примеры из реальной практики

#### В темах WordPress

```php
<?php
// functions.php

// Регистрация кастомных возможностей
function theme_setup() {
    add_theme_support('post-thumbnails');
    add_theme_support('title-tag');
    add_theme_support('custom-logo');
    
    register_nav_menus([
        'primary' => 'Primary Menu',
        'footer' => 'Footer Menu'
    ]);
}
add_action('after_setup_theme', 'theme_setup');

// Загрузка стилей и скриптов
function enqueue_assets() {
    wp_enqueue_style('main', get_stylesheet_uri(), [], '1.0.0');
    wp_enqueue_script('main-js', get_template_directory_uri() . '/js/main.js', ['jquery'], '1.0.0', true);
}
add_action('wp_enqueue_scripts', 'enqueue_assets');
?>
```text

#### В плагинах

```php
<?php
/**
 * Plugin Name: My Custom Plugin
 * Description: Example plugin demonstrating Инкапсуляция
 * Version: 1.0.0
 */

// Активация плагина
function my_plugin_activate() {
    // Создание таблиц, настройка опций
    global $wpdb;
    $table_name = $wpdb->prefix . 'my_table';
    
    $charset_collate = $wpdb->get_charset_collate();
    
    $sql = "CREATE TABLE $table_name (
        id mediumint(9) NOT NULL AUTO_INCREMENT,
        name varchar(255) NOT NULL,
        email varchar(255) NOT NULL,
        PRIMARY KEY  (id)
    ) $charset_collate;";
    
    require_once(ABSPATH . 'wp-admin/includes/upgrade.php');
    dbDelta($sql);
}
register_activation_hook(__FILE__, 'my_plugin_activate');

// Деактивация плагина
function my_plugin_deactivate() {
    // Очистка, удаление cron jobs
    wp_clear_scheduled_hook('my_plugin_cron');
}
register_deactivation_hook(__FILE__, 'my_plugin_deactivate');
?>
```text

#### Кастомные типы постов и таксономии

```php
<?php
function register_custom_post_types() {
    // Кастомный тип поста
    register_post_type('portfolio', [
        'labels' => [
            'name' => 'Portfolio',
            'singular_name' => 'Portfolio Item'
        ],
        'public' => true,
        'has_archive' => true,
        'supports' => ['title', 'editor', 'thumbnail'],
        'menu_icon' => 'dashicons-portfolio'
    ]);
    
    // Таксономия
    register_taxonomy('portfolio_category', 'portfolio', [
        'labels' => [
            'name' => 'Categories',
            'singular_name' => 'Category'
        ],
        'hierarchical' => true,
        'show_admin_column' => true
    ]);
}
add_action('init', 'register_custom_post_types');
?>
```text



## Решение типичных проблем

### Проблема 1: Не работает код

**Симптомы:**
- Пустая белая страница
- Ошибка 500

**Решение:**
```php
<?php
// Включите отображение ошибок для отладки
ini_set('display_errors', 1);
error_reporting(E_ALL);

// Проверьте логи ошибок
// Linux: /var/log/apache2/error.log
// XAMPP: C:\xampp\apache\logs\error.log
?>
```text

### Проблема 2: Данные не сохраняются

**Симптомы:**
- Форма не работает
- Данные теряются

**Решение:**
```php
<?php
// Проверьте метод отправки
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // Проверьте наличие данных
    var_dump($_POST);
    
    // Проверьте валидацию
    if (empty($_POST['name'])) {
        die("Name is required");
    }
}
?>
```text

### Проблема 3: Проблемы с кодировкой

**Симптомы:**
- Кракозябры вместо русских букв

**Решение:**
```php
<?php
// Установите кодировку
header('Content-Type: text/html; charset=utf-8');

// В БД используйте utf8mb4
$pdo = new PDO($dsn, $user, $pass, [
    PDO::MYSQL_ATTR_INIT_COMMAND => "SET NAMES utf8mb4"
]);
?>
```text



## Продвинутые темы

### Оптимизация производительности

```php
<?php
// Кеширование результатов
function get_expensive_data() {
    static $cache = null;
    
    if ($cache === null) {
        // Дорогая операция выполняется только раз
        $cache = heavy_computation();
    }
    
    return $cache;
}

// Использование опкода кеша (OPcache)
// Уже включено в современных версиях PHP
// Проверка: php -i | grep opcache
?>
```text

### Паттерны проектирования

```php
<?php
// Singleton pattern
class Database {
    private static $instance = null;
    private $connection;
    
    private function __construct() {
        $this->connection = new PDO($dsn, $user, $pass);
    }
    
    public static function getInstance() {
        if (self::$instance === null) {
            self::$instance = new self();
        }
        return self::$instance;
    }
    
    public function getConnection() {
        return $this->connection;
    }
}

// Использование
$db = Database::getInstance()->getConnection();
?>
```text

### Тестирование

```php
<?php
// PHPUnit test example
use PHPUnit\Framework\TestCase;

class CalculatorTest extends TestCase {
    public function testAdd() {
        $calc = new Calculator();
        $result = $calc->add(2, 3);
        $this->assertEquals(5, $result);
    }
    
    public function testDivideByZero() {
        $this->expectException(DivisionByZeroError::class);
        $calc = new Calculator();
        $calc->divide(10, 0);
    }
}
?>
```text


## Практика


### Задание 1: Базовое

Создайте простой пример использования инкапсуляция.

### Задание 2: Промежуточное

Реализуйте более сложную задачу с применением инкапсуляция.

### Задание 3: Продвинутое

Создайте реальное приложение используя изученный материал.

### Задание 4: WordPress

Примените знания инкапсуляция в контексте WordPress.

### Задание 5: Проект

Разработайте небольшой проект, демонстрирующий практическое применение темы.


## Онлайн-редакторы

Тестируйте примеры из этого урока:

- **PHPSandbox** (https://phpsandbox.io/) — полноценная PHP-среда в браузере
- **3v4l** (https://3v4l.org/) — тестирование кода на разных версиях PHP

## Итоги

В этом уроке вы изучили:


✅ Основные концепции  
✅ Практические примеры  
✅ Применение в WordPress  
✅ Best practices  
✅ Типичные ошибки и их решения  


### Следующий шаг

Переходите к следующему уроку для углубления знаний PHP.

### Ключевые моменты


1. Понимание основ — залог успеха
2. Практика важнее теории
3. Используйте примеры из реальной разработки
4. Изучайте код других разработчиков
5. Не бойтесь экспериментировать


**Совет:** Практикуйтесь с примерами из урока — это лучший способ запомнить материал!

---

**Готовы двигаться дальше?** Продолжайте изучение PHP!



## Интерактивный пример

<Sandpack
  template="vanilla"
  files={{
    "/index.html": `<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Инкапсуляция в JavaScript</title>
    <link rel="stylesheet" href="./styles.css">
</head>
<body>
    <div class="container">
        <h1>Инкапсуляция в JavaScript</h1>
        <p>В этом примере мы демонстрируем концепцию инкапсуляции, скрывая внутренние детали объекта и предоставляя контролируемый доступ к ним.</p>

        <div id="account-info">
            <h2>Информация о счете</h2>
            <p>Баланс: <span id="balance"></span></p>
            <input type="number" id="deposit-amount" placeholder="Сумма для пополнения">
            <button id="deposit-button">Пополнить</button>
            <input type="number" id="withdraw-amount" placeholder="Сумма для снятия">
            <button id="withdraw-button">Снять</button>
            <p id="message"></p>
        </div>
    </div>
    <script src="./index.js"><\/script>
</body>
</html>`,
    "/styles.css": `body {
    font-family: sans-serif;
    background-color: #222;
    color: #eee;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
}

.container {
    background-color: #333;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    width: 500px;
}

h1 {
    text-align: center;
    margin-bottom: 20px;
}

#account-info {
    margin-top: 20px;
}

input[type="number"] {
    padding: 8px;
    margin-right: 10px;
    border: 1px solid #555;
    border-radius: 4px;
    background-color: #444;
    color: #eee;
}

button {
    padding: 8px 12px;
    background-color: #555;
    color: #eee;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

button:hover {
    background-color: #777;
}

#message {
    margin-top: 10px;
    color: #ffcc00;
}`,
    "/index.js": `// Пример инкапсуляции в JavaScript

// Создаем класс Account, который представляет банковский счет
class Account {
    // #balance - это приватное поле (доступно только внутри класса)
    #balance;

    constructor(initialBalance) {
        // Устанавливаем начальный баланс
        this.#balance = initialBalance;
        this.updateBalanceDisplay();
    }

    // Метод для получения баланса (публичный)
    getBalance() {
        return this.#balance;
    }

    // Метод для пополнения счета
    deposit(amount) {
        if (amount > 0) {
            this.#balance += amount;
            this.updateBalanceDisplay();
            this.showMessage(\`Успешно пополнено на \${amount}\`);
        } else {
            this.showMessage("Сумма пополнения должна быть больше нуля.");
        }
    }

    // Метод для снятия средств со счета
    withdraw(amount) {
        if (amount > 0 && amount <= this.#balance) {
            this.#balance -= amount;
            this.updateBalanceDisplay();
            this.showMessage(\`Успешно снято \${amount}\`);
        } else if (amount <= 0) {
            this.showMessage("Сумма снятия должна быть больше нуля.");
        } else {
            this.showMessage("Недостаточно средств на счете.");
        }
    }

    // Приватный метод для обновления отображаемого баланса
    updateBalanceDisplay() {
        document.getElementById("balance").textContent = this.#balance;
    }

    // Приватный метод для отображения сообщений
    showMessage(message) {
        document.getElementById("message").textContent = message;
    }
}

// Создаем экземпляр класса Account с начальным балансом 1000
const myAccount = new Account(1000);

// Получаем элементы DOM
const depositButton = document.getElementById("deposit-button");
const withdrawButton = document.getElementById("withdraw-button");
const depositAmountInput = document.getElementById("deposit-amount");
const withdrawAmountInput = document.getElementById("withdraw-amount");

// Добавляем обработчики событий для кнопок
depositButton.addEventListener("click", () => {
    const amount = parseFloat(depositAmountInput.value);
    myAccount.deposit(amount);
    depositAmountInput.value = ""; // Очищаем поле ввода
});

withdrawButton.addEventListener("click", () => {
    const amount = parseFloat(withdrawAmountInput.value);
    myAccount.withdraw(amount);
    withdrawAmountInput.value = ""; // Очищаем поле ввода
});
`
  }}
  options={{
    showNavigator: false,
    showLineNumbers: true,
    editorHeight: 400
  }}
/>

## Урок: HTML Drag and Drop API


![Иллюстрация к уроку](/lessons/html-drag-drop-api.png)
Drag and Drop API (Перетаскивание) в HTML позволяет пользователям перетаскивать элементы на веб-странице, что значительно улучшает взаимодействие с интерфейсом. Этот урок познакомит вас с основами этой мощной возможности.

### Основы Drag and Drop

Концепция Drag and Drop проста: нужно указать, какие элементы можно перетаскивать, и куда их можно перетащить. Для этого используются специальные атрибуты HTML и JavaScript события.

### Атрибуты и события

Основные атрибуты:

*   `draggable="true"`: Указывает, что элемент можно перетаскивать.

Основные события:

*   `dragstart`: Срабатывает, когда пользователь начинает перетаскивание элемента.
*   `dragenter`: Срабатывает, когда перетаскиваемый элемент входит в целевую область.
*   `dragover`: Срабатывает, когда перетаскиваемый элемент находится над целевой областью. **Этот обработчик обязателен для разрешения drop!**
*   `dragleave`: Срабатывает, когда перетаскиваемый элемент покидает целевую область.
*   `drop`: Срабатывает, когда перетаскиваемый элемент отпущен в целевой области.
*   `dragend`: Срабатывает, когда перетаскивание завершено (независимо от того, успешно ли прошло перетаскивание).

### Практический пример

Давайте создадим простой пример с перетаскиванием изображения в контейнер.

```html
<!DOCTYPE html>
<html>
<head>
  <title>Drag and Drop Пример</title>
  <style>
    #draggable {
      width: 100px;
      height: 100px;
      background-color: lightblue;
      cursor: move;
    }

    #dropzone {
      width: 200px;
      height: 200px;
      border: 2px dashed gray;
      text-align: center;
      line-height: 200px;
    }
  </style>
</head>
<body>

  <div id="draggable" draggable="true">Перетащи меня!</div>
  <div id="dropzone">Отпустите здесь!</div>

  <script>
    const draggable = document.getElementById('draggable');
    const dropzone = document.getElementById('dropzone');

    draggable.addEventListener('dragstart', (event) => {
      event.dataTransfer.setData('text/plain', event.target.id); // Сохраняем ID перетаскиваемого элемента
    });

    dropzone.addEventListener('dragover', (event) => {
      event.preventDefault(); // Необходимо для разрешения drop
    });

    dropzone.addEventListener('drop', (event) => {
      event.preventDefault(); // Предотвращаем стандартное поведение браузера
      const id = event.dataTransfer.getData('text/plain'); // Получаем ID перетаскиваемого элемента
      const element = document.getElementById(id); // Получаем сам элемент
      dropzone.appendChild(element); // Добавляем элемент в dropzone
      dropzone.textContent = 'Перетащено!';
    });
  </script>

</body>
</html>
```

В этом примере:

*   `draggable="true"` делает элемент с ID "draggable" перетаскиваемым.
*   `event.dataTransfer.setData('text/plain', event.target.id)` сохраняет ID перетаскиваемого элемента в `dataTransfer` при начале перетаскивания.
*   `event.preventDefault()` в `dragover` необходим для того, чтобы событие `drop` сработало.
*   В `drop` мы получаем ID элемента из `dataTransfer` и добавляем его в `dropzone`.

### Жизненный пример

Drag and Drop API широко используется в различных приложениях:

*   **Trello, Jira:** Для перетаскивания задач между колонками.
*   **Интерфейсы файловых менеджеров:** Для перетаскивания файлов и папок.
*   **Конструкторы сайтов (Webflow, Wix):** Для перетаскивания элементов на страницу.
*   **Редакторы изображений:** Для изменения порядка слоев.

Многие JavaScript библиотеки и фреймворки (React, Angular, Vue) предлагают компоненты и обертки для упрощения работы с Drag and Drop API, делая его более удобным и кросс-браузерным.

### Ключевые моменты

*   `draggable="true"` - необходим для активации перетаскивания.
*   `event.preventDefault()` в `dragover` - обязателен для разрешения `drop`.
*   `dataTransfer` - используется для передачи данных между перетаскиваемым элементом и целевой областью.
*   Drag and Drop API предоставляет мощные возможности для создания интерактивных интерфейсов.



## Интерактивный пример

<Sandpack
  template="vanilla"
  files={{
    "/index.html": `<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HTML Drag and Drop API Пример</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>

  <div class="container">
    <div id="draggable" draggable="true" class="item">Перетащи меня!</div>
    <div id="dropzone" class="dropzone">Отпустите здесь!</div>
    <div id="log" class="log"></div>
  </div>

  <script src="/index.js"><\/script>

</body>
</html>`,
    "/styles.css": `body {
  font-family: sans-serif;
  background-color: #282c34;
  color: #fff;
  padding: 20px;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}

.container {
  display: flex;
  gap: 20px;
}

.item {
  width: 150px;
  height: 100px;
  background-color: #61dafb;
  color: #282c34;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: move;
  border-radius: 5px;
  padding: 10px;
  box-sizing: border-box;
}

.dropzone {
  width: 200px;
  height: 100px;
  border: 2px dashed #fff;
  text-align: center;
  line-height: 100px;
  border-radius: 5px;
}

.log {
  width: 200px;
  height: 100px;
  border: 1px solid #fff;
  padding: 10px;
  box-sizing: border-box;
  overflow-y: auto;
  border-radius: 5px;
}
`,
    "/index.js": `const draggable = document.getElementById('draggable');
const dropzone = document.getElementById('dropzone');
const log = document.getElementById('log');

function logEvent(message) {
  log.innerHTML += \`<div>\${message}</div>\`;
  log.scrollTop = log.scrollHeight; // Автоматическая прокрутка вниз
}

draggable.addEventListener('dragstart', (event) => {
  logEvent('dragstart: Начало перетаскивания');
  event.dataTransfer.setData('text/plain', event.target.id); // Сохраняем ID перетаскиваемого элемента
  draggable.classList.add('dragging'); // Добавляем класс для стилизации во время перетаскивания
});

draggable.addEventListener('dragend', (event) => {
  logEvent('dragend: Перетаскивание завершено');
  draggable.classList.remove('dragging'); // Убираем класс после завершения перетаскивания
});

dropzone.addEventListener('dragenter', (event) => {
  logEvent('dragenter: Элемент вошел в зону drop');
  event.preventDefault(); // Необходимо для разрешения drop
  dropzone.classList.add('dragover'); // Добавляем класс для стилизации зоны drop
});

dropzone.addEventListener('dragover', (event) => {
  event.preventDefault(); // Необходимо для разрешения drop
});

dropzone.addEventListener('dragleave', (event) => {
  logEvent('dragleave: Элемент покинул зону drop');
  dropzone.classList.remove('dragover'); // Убираем класс при покидании зоны drop
});

dropzone.addEventListener('drop', (event) => {
  logEvent('drop: Элемент отпущен в зоне drop');
  event.preventDefault(); // Предотвращаем стандартное поведение браузера
  const id = event.dataTransfer.getData('text/plain'); // Получаем ID перетаскиваемого элемента
  const element = document.getElementById(id); // Получаем сам элемент
  dropzone.appendChild(element); // Добавляем элемент в dropzone
  dropzone.textContent = 'Перетащено!';
  dropzone.classList.remove('dragover'); // Убираем класс после drop
});
`
  }}
  options={{
    showNavigator: false,
    showLineNumbers: true,
    editorHeight: 400
  }}
/>

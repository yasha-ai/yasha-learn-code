## HTML: Скелет. Урок 5: Canvas Animation


![Иллюстрация к уроку](/lessons/html-canvas-animation.png)
В этом уроке мы погрузимся в мир анимации с использованием элемента `<canvas>` в HTML. Canvas позволяет нам создавать динамические и интерактивные визуализации прямо в браузере, используя JavaScript.

### Что такое Canvas и как он работает?

Элемент `<canvas>` сам по себе является просто контейнером для графики. Вся магия происходит с помощью JavaScript, который рисует на этом контейнере пиксели, линии, фигуры и текст. Для создания анимации нам нужно многократно перерисовывать canvas с небольшими изменениями, создавая иллюзию движения.

Давайте начнем с простого примера: рисуем движущийся круг.

```html
<!DOCTYPE html>
<html>
<head>
  <title>Canvas Animation</title>
</head>
<body>
  <canvas id="myCanvas" width="200" height="100" style="border:1px solid #000000;"></canvas>

  <script>
    const canvas = document.getElementById("myCanvas");
    const ctx = canvas.getContext("2d"); // Получаем 2D контекст для рисования

    let x = 0; // Начальная позиция круга по оси X
    let radius = 20; // Радиус круга

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height); // Очищаем canvas перед каждой перерисовкой
      ctx.beginPath(); // Начинаем новый путь для рисования
      ctx.arc(x, canvas.height/2, radius, 0, 2 * Math.PI); // Рисуем круг
      ctx.fillStyle = "blue"; // Задаем цвет заливки
      ctx.fill(); // Заливаем круг
      x++; // Изменяем позицию круга
      if (x > canvas.width + radius) {
        x = -radius; // Возвращаем круг в начало, когда он выходит за пределы canvas
      }
      requestAnimationFrame(draw); // Запрашиваем следующий кадр анимации
    }

    draw(); // Запускаем анимацию
  </script>

</body>
</html>
```

В этом коде:

*   `canvas.getContext("2d")` возвращает объект контекста рисования, который предоставляет методы для рисования фигур, текста, изображений и других объектов.
*   `ctx.clearRect(0, 0, canvas.width, canvas.height)` очищает canvas перед каждой перерисовкой, чтобы не оставалось следов от предыдущих кадров.
*   `requestAnimationFrame(draw)` — это ключевая функция для анимации. Она сообщает браузеру, что мы хотим выполнить анимацию, и браузер вызывает нашу функцию `draw` перед следующей перерисовкой экрана. Это обеспечивает плавную анимацию с оптимальной частотой кадров.

### Управление скоростью анимации

Мы можем контролировать скорость анимации, добавляя задержку или изменяя величину приращения `x` (позиции круга). Например, чтобы замедлить движение:

```javascript
x += 0.5; // Меньшее значение приращения
```

### Жизненный пример

Canvas animation широко используется в различных областях:

*   **Игры:** Многие веб-игры создаются с использованием Canvas, обеспечивая высокую производительность и контроль над графикой.
*   **Визуализация данных:** Canvas позволяет создавать интерактивные графики и диаграммы для отображения данных. Например, библиотеки вроде Chart.js используют Canvas.
*   **Рекламные баннеры:** Динамичные рекламные баннеры часто используют Canvas для создания привлекательных анимаций.
*   **Интерактивные элементы интерфейса:** Canvas может быть использован для создания кастомных элементов управления, таких как слайдеры, кнопки и т.д.
*   **Фреймворки:** Многие JavaScript фреймворки (например, PixiJS, Three.js) используют Canvas или WebGL (расширение Canvas) для рендеринга графики.

### Ключевые моменты

*   `canvas.getContext("2d")` - получение контекста для рисования.
*   `requestAnimationFrame()` - функция для плавной анимации.
*   Необходимо очищать canvas перед каждой перерисовкой (`clearRect()`).
*   Canvas предоставляет множество методов для рисования фигур, текста и изображений.
*   Canvas является мощным инструментом для создания интерактивной графики в браузере.



## Интерактивный пример

<Sandpack
  template="vanilla"
  files={{
    "/index.html": `<!DOCTYPE html>
<html>
<head>
  <title>Canvas Animation</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <canvas id="myCanvas" width="400" height="200"></canvas>
  <div class="controls">
    <label for="speed">Скорость:</label>
    <input type="range" id="speed" min="0.1" max="5" value="1" step="0.1">
    <span id="speedValue">1</span>
    <br>
    <label for="color">Цвет:</label>
    <input type="color" id="color" value="#007bff">
  </div>

  <script src="/index.js"><\/script>
</body>
</html>`,
    "/styles.css": `body {
  font-family: sans-serif;
  background-color: #222;
  color: #eee;
  padding: 20px;
}

canvas {
  border: 1px solid #eee;
  background-color: #333;
}

.controls {
  margin-top: 20px;
}

.controls label {
  margin-right: 10px;
}

.controls input[type="range"] {
  width: 200px;
}
`,
    "/index.js": `const canvas = document.getElementById("myCanvas");
const ctx = canvas.getContext("2d");

let x = 0;
let radius = 20;
let speed = 1;
let color = "#007bff";

const speedInput = document.getElementById("speed");
const speedValue = document.getElementById("speedValue");
const colorInput = document.getElementById("color");

speedInput.addEventListener("input", () => {
  speed = parseFloat(speedInput.value);
  speedValue.textContent = speed.toFixed(1);
});

colorInput.addEventListener("input", () => {
  color = colorInput.value;
});

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.beginPath();
  ctx.arc(x, canvas.height/2, radius, 0, 2 * Math.PI);
  ctx.fillStyle = color;
  ctx.fill();
  x += speed;
  if (x > canvas.width + radius) {
    x = -radius;
  }
  requestAnimationFrame(draw);
}

draw();`
  }}
  options={{
    showNavigator: false,
    showLineNumbers: true,
    editorHeight: 400
  }}
/>

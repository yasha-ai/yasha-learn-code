import { Sandpack } from '@codesandbox/sandpack-react'

## JavaScript: Рекурсия - Мозги

Добро пожаловать в мир рекурсии! Рекурсия - мощный инструмент в программировании, позволяющий функции вызывать саму себя для решения более мелких подзадач. В этом уроке мы разберем эту концепцию на простых примерах.

### Что такое рекурсия?

Рекурсия - это техника программирования, когда функция вызывает саму себя внутри своего собственного тела.  Представьте себе зеркало, отражающее другое зеркало - это бесконечный цикл отражений.  В рекурсии важно иметь условие остановки, чтобы не уйти в бесконечный цикл, иначе программа просто зависнет. Это условие остановки называется *базовый случай*.

### Простой пример: Факториал

Давайте рассмотрим классический пример рекурсии - вычисление факториала числа.  Факториал числа n (обозначается как n!) - это произведение всех целых чисел от 1 до n.

```javascript
function factorial(n) {
  // Базовый случай: факториал 0 равен 1
  if (n === 0) {
    return 1;
  } else {
    // Рекурсивный вызов: n! = n * (n-1)!
    return n * factorial(n - 1);
  }
}

console.log(factorial(5)); // Вывод: 120
```

В этом примере:

*   `factorial(0)` - это *базовый случай*.  Когда `n` равно 0, функция возвращает 1 и рекурсия заканчивается.
*   `return n * factorial(n - 1);` - это *рекурсивный вызов*. Функция вызывает саму себя с аргументом `n - 1`.

### Еще один пример: Обратный отсчет

Другой пример, демонстрирующий рекурсию:

```javascript
function countdown(n) {
  // Базовый случай: когда n меньше или равно 0, прекращаем отсчет
  if (n <= 0) {
    console.log("Пуск!");
  } else {
    console.log(n);
    countdown(n - 1); // Рекурсивный вызов
  }
}

countdown(5); // Вывод: 5 4 3 2 1 Пуск!
```

### Жизненный пример

Рекурсия часто используется при работе с древовидными структурами данных, такими как DOM в веб-разработке.  Например, если вам нужно найти все элементы определенного класса внутри элемента DOM и его потомков, рекурсивная функция может быть очень полезной.

Представьте, что вам нужно найти все элементы `div` с классом `highlight` в сложном HTML документе.

```javascript
function findHighlightDivs(element) {
  let highlights = [];

  // Проверяем, является ли текущий элемент искомым
  if (element.tagName === 'DIV' && element.classList.contains('highlight')) {
    highlights.push(element);
  }

  // Перебираем дочерние элементы
  for (let i = 0; i < element.children.length; i++) {
    // Рекурсивно вызываем функцию для каждого дочернего элемента
    highlights = highlights.concat(findHighlightDivs(element.children[i]));
  }

  return highlights;
}

// Пример использования:
const rootElement = document.getElementById('root'); // Предположим, что есть элемент с id "root"
const highlightedDivs = findHighlightDivs(rootElement);

console.log(highlightedDivs); // Выведет массив найденных элементов
```

Этот пример иллюстрирует, как рекурсия может быть использована для обхода дерева DOM.  Фреймворки, такие как React и Vue.js, активно используют рекурсивные алгоритмы для обновления и рендеринга компонентов.

### Ключевые моменты

*   **Базовый случай:**  Необходимо иметь условие остановки, чтобы рекурсия не стала бесконечной.
*   **Рекурсивный вызов:** Функция должна вызывать саму себя с измененными аргументами, приближаясь к базовому случаю.
*   **Стек вызовов:** Каждый рекурсивный вызов добавляется в стек вызовов.  При слишком глубокой рекурсии может произойти переполнение стека (Stack Overflow).
*   **Альтернативы:**  Рекурсию часто можно заменить итеративными решениями (циклами).  Иногда итеративные решения более эффективны, особенно при работе с большими объемами данных.

Теперь вы знакомы с основами рекурсии!  Попрактикуйтесь с различными примерами, чтобы лучше понять эту концепцию. Удачи!

### Практика

Попробуйте примеры в интерактивном редакторе:

<Sandpack
  template="vanilla"
  files={{
    '/index.html': `<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Рекурсия</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div id="app"></div>
  <script src="index.js"></script>
</body>
</html>`,
    '/index.js': `var callStack = [];

// Рекурсивная функция факториала с визуализацией
function factorial(n, depth) {
  if (depth === undefined) depth = 0;
  var indent = '  '.repeat(depth);
  callStack.push(indent + 'factorial(' + n + ')');
  updateStack();

  if (n === 0) {
    callStack.push(indent + '-> return 1');
    updateStack();
    return 1;
  }

  var result = n * factorial(n - 1, depth + 1);
  callStack.push(indent + '-> return ' + n + ' * ' + (n - 1) + '! = ' + result);
  updateStack();
  return result;
}

// Рекурсивное суммирование массива
function sumArray(arr) {
  if (arr.length === 0) return 0;
  return arr[0] + sumArray(arr.slice(1));
}

// Числа Фибоначчи
function fibonacci(n) {
  if (n <= 1) return n;
  return fibonacci(n - 1) + fibonacci(n - 2);
}

// Обход дерева
function traverseTree(node, depth) {
  if (depth === undefined) depth = 0;
  var items = [];
  var indent = '  '.repeat(depth);
  items.push(indent + 'folder: ' + node.name);

  if (node.children) {
    node.children.forEach(function(child) {
      var childItems = traverseTree(child, depth + 1);
      for (var i = 0; i < childItems.length; i++) {
        items.push(childItems[i]);
      }
    });
  }

  return items;
}

var app = document.getElementById('app');

app.innerHTML =
  '<div class="section">' +
    '<h2>Факториал с визуализацией стека</h2>' +
    '<input type="number" id="factInput" value="5" min="0" max="10">' +
    '<button onclick="calcFactorial()">Вычислить факториал</button>' +
    '<div id="factResult"></div>' +
    '<div id="stack"></div>' +
  '</div>' +
  '<div class="section">' +
    '<h2>Сумма массива (рекурсия)</h2>' +
    '<button onclick="calcSum()">Сумма [1,2,3,4,5]</button>' +
    '<div id="sumResult"></div>' +
  '</div>' +
  '<div class="section">' +
    '<h2>Числа Фибоначчи</h2>' +
    '<input type="number" id="fibInput" value="7" min="0" max="15">' +
    '<button onclick="calcFib()">Вычислить Фибоначчи</button>' +
    '<div id="fibResult"></div>' +
  '</div>' +
  '<div class="section">' +
    '<h2>Обход дерева файлов</h2>' +
    '<button onclick="traverseFiles()">Обойти дерево</button>' +
    '<div id="treeResult"></div>' +
  '</div>';

function updateStack() {
  var stackDiv = document.getElementById('stack');
  if (!stackDiv) return;

  stackDiv.innerHTML =
    '<h3>Стек вызовов:</h3>' +
    '<pre>' + callStack.join('\\n') + '</pre>';
}

window.calcFactorial = function() {
  callStack = [];
  var n = parseInt(document.getElementById('factInput').value);

  if (n < 0 || n > 10) {
    alert('Введите число от 0 до 10');
    return;
  }

  var result = factorial(n);

  document.getElementById('factResult').innerHTML =
    '<div class="result-box success">' +
      '<strong>' + n + '! = ' + result + '</strong>' +
    '</div>';

  console.log(n + '! =', result);
};

window.calcSum = function() {
  var arr = [1, 2, 3, 4, 5];
  var result = sumArray(arr);

  document.getElementById('sumResult').innerHTML =
    '<div class="result-box success">' +
      'Массив: [' + arr.join(', ') + ']<br>' +
      'Сумма: <strong>' + result + '</strong>' +
    '</div>' +
    '<div class="info">' +
      'Рекурсия: sumArray([1,2,3,4,5]) = 1 + sumArray([2,3,4,5]) = ...' +
    '</div>';

  console.log('Сумма:', result);
};

window.calcFib = function() {
  var n = parseInt(document.getElementById('fibInput').value);

  if (n < 0 || n > 15) {
    alert('Введите число от 0 до 15');
    return;
  }

  var start = Date.now();
  var result = fibonacci(n);
  var time = Date.now() - start;

  document.getElementById('fibResult').innerHTML =
    '<div class="result-box success">' +
      'fibonacci(' + n + ') = <strong>' + result + '</strong>' +
    '</div>' +
    '<div class="info">' +
      'Вычислено за ' + time + 'ms<br>' +
      'Эта рекурсия неэффективна для больших n (много повторных вызовов)' +
    '</div>';

  console.log('fibonacci(' + n + ') =', result);
};

window.traverseFiles = function() {
  var fileSystem = {
    name: 'root',
    children: [
      {
        name: 'src',
        children: [
          { name: 'index.js' },
          { name: 'app.js' },
          { name: 'utils', children: [
            { name: 'helpers.js' }
          ]}
        ]
      },
      {
        name: 'public',
        children: [
          { name: 'index.html' },
          { name: 'styles.css' }
        ]
      },
      { name: 'package.json' }
    ]
  };

  var result = traverseTree(fileSystem);

  document.getElementById('treeResult').innerHTML =
    '<div class="result-box">' +
      '<pre>' + result.join('\\n') + '</pre>' +
    '</div>' +
    '<div class="info">' +
      'Рекурсия обходит все узлы дерева, включая вложенные' +
    '</div>';

  console.log('Дерево файлов:', result);
};

console.log('Рекурсия - функция вызывает саму себя!');
`,
    '/styles.css': `body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  padding: 20px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  margin: 0;
}

#app {
  max-width: 800px;
  margin: 0 auto;
}

.section {
  background: white;
  border-radius: 12px;
  padding: 24px;
  margin-bottom: 20px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

h2, h3 {
  margin: 0 0 16px 0;
  color: #333;
}

input[type="number"] {
  padding: 10px 12px;
  border: 2px solid #e0e0e0;
  border-radius: 6px;
  font-size: 16px;
  margin-right: 8px;
  width: 100px;
}

input:focus {
  outline: none;
  border-color: #667eea;
}

button {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  font-size: 15px;
  font-weight: bold;
  cursor: pointer;
  transition: transform 0.2s;
}

button:hover {
  transform: scale(1.05);
}

button:active {
  transform: scale(0.95);
}

.result-box {
  background: #f8f9fa;
  padding: 16px;
  border-radius: 8px;
  margin-top: 12px;
  border-left: 4px solid #667eea;
}

.result-box.success {
  background: #e8f5e9;
  border-left-color: #4caf50;
}

.info {
  background: #fff3e0;
  border-left: 4px solid #ff9800;
  padding: 12px;
  border-radius: 6px;
  margin-top: 12px;
  font-size: 14px;
  color: #e65100;
}

#stack {
  margin-top: 16px;
}

#stack h3 {
  font-size: 1em;
  margin-bottom: 8px;
  color: #667eea;
}

pre {
  background: #263238;
  color: #aed581;
  padding: 16px;
  border-radius: 8px;
  overflow-x: auto;
  font-family: 'Courier New', monospace;
  font-size: 13px;
  line-height: 1.6;
  margin: 0;
}

.result-box pre {
  background: #f8f9fa;
  color: #333;
}
`
  }}
/>

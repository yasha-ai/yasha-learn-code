## JavaScript: Рекурсия - Мозги


![Иллюстрация к уроку](/lessons/javascript-recursion.png)
Добро пожаловать в мир рекурсии! Рекурсия - мощный инструмент в программировании, позволяющий функции вызывать саму себя для решения более мелких подзадач. В этом уроке мы разберем эту концепцию на простых примерах.

### Что такое рекурсия?

Рекурсия - это техника программирования, когда функция вызывает саму себя внутри своего собственного тела.  Представьте себе зеркало, отражающее другое зеркало - это бесконечный цикл отражений.  В рекурсии важно иметь условие остановки, чтобы не уйти в бесконечный цикл, иначе программа просто зависнет. Это условие остановки называется *базовый случай*.

### Простой пример: Факториал

Давайте рассмотрим классический пример рекурсии - вычисление факториала числа.  Факториал числа n (обозначается как n!) - это произведение всех целых чисел от 1 до n.

```javascript
function factorial(n) {
  // Базовый случай: факториал 0 равен 1
  if (n === 0) {
    return 1;
  } else {
    // Рекурсивный вызов: n! = n * (n-1)!
    return n * factorial(n - 1);
  }
}

console.log(factorial(5)); // Вывод: 120
```

В этом примере:

*   `factorial(0)` - это *базовый случай*.  Когда `n` равно 0, функция возвращает 1 и рекурсия заканчивается.
*   `return n * factorial(n - 1);` - это *рекурсивный вызов*. Функция вызывает саму себя с аргументом `n - 1`.

### Еще один пример: Обратный отсчет

Другой пример, демонстрирующий рекурсию:

```javascript
function countdown(n) {
  // Базовый случай: когда n меньше или равно 0, прекращаем отсчет
  if (n <= 0) {
    console.log("Пуск!");
  } else {
    console.log(n);
    countdown(n - 1); // Рекурсивный вызов
  }
}

countdown(5); // Вывод: 5 4 3 2 1 Пуск!
```

### Жизненный пример

Рекурсия часто используется при работе с древовидными структурами данных, такими как DOM в веб-разработке.  Например, если вам нужно найти все элементы определенного класса внутри элемента DOM и его потомков, рекурсивная функция может быть очень полезной.

Представьте, что вам нужно найти все элементы `div` с классом `highlight` в сложном HTML документе.

```javascript
function findHighlightDivs(element) {
  let highlights = [];

  // Проверяем, является ли текущий элемент искомым
  if (element.tagName === 'DIV' && element.classList.contains('highlight')) {
    highlights.push(element);
  }

  // Перебираем дочерние элементы
  for (let i = 0; i < element.children.length; i++) {
    // Рекурсивно вызываем функцию для каждого дочернего элемента
    highlights = highlights.concat(findHighlightDivs(element.children[i]));
  }

  return highlights;
}

// Пример использования:
const rootElement = document.getElementById('root'); // Предположим, что есть элемент с id "root"
const highlightedDivs = findHighlightDivs(rootElement);

console.log(highlightedDivs); // Выведет массив найденных элементов
```

Этот пример иллюстрирует, как рекурсия может быть использована для обхода дерева DOM.  Фреймворки, такие как React и Vue.js, активно используют рекурсивные алгоритмы для обновления и рендеринга компонентов.

### Ключевые моменты

*   **Базовый случай:**  Необходимо иметь условие остановки, чтобы рекурсия не стала бесконечной.
*   **Рекурсивный вызов:** Функция должна вызывать саму себя с измененными аргументами, приближаясь к базовому случаю.
*   **Стек вызовов:** Каждый рекурсивный вызов добавляется в стек вызовов.  При слишком глубокой рекурсии может произойти переполнение стека (Stack Overflow).
*   **Альтернативы:**  Рекурсию часто можно заменить итеративными решениями (циклами).  Иногда итеративные решения более эффективны, особенно при работе с большими объемами данных.

Теперь вы знакомы с основами рекурсии!  Попрактикуйтесь с различными примерами, чтобы лучше понять эту концепцию. Удачи!



## Интерактивный пример

<Sandpack
  template="vanilla"
  files={{
    "/index.html": `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Рекурсия в JavaScript</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div id="app">
    <h1>Рекурсивный Факториал</h1>
    <label for="numberInput">Введите число:</label>
    <input type="number" id="numberInput" value="5">
    <button id="calculateButton">Вычислить Факториал</button>
    <p>Факториал: <span id="result"></span></p>

    <h2>Рекурсивный Обратный Отсчет</h2>
    <label for="countdownInput">Введите число для отсчета:</label>
    <input type="number" id="countdownInput" value="5">
    <button id="countdownButton">Начать Отсчет</button>
    <div id="countdownOutput"></div>

    <h2>Поиск элементов с классом "highlight" (рекурсия по DOM)</h2>
    <div id="root">
      <div>
        <p>Обычный параграф</p>
        <div class="highlight">Первый highlight div</div>
        <div>
          <p>Вложенный параграф</p>
          <div class="highlight">Второй highlight div</div>
        </div>
      </div>
      <div class="highlight">Третий highlight div</div>
    </div>
    <button id="findHighlightsButton">Найти Highlight Divs</button>
    <div id="highlightsOutput"></div>
  </div>
  <script src="/index.js"><\/script>
</body>
</html>`,
    "/styles.css": `body {
  font-family: sans-serif;
  background-color: #222;
  color: #eee;
  padding: 20px;
}

#app {
  max-width: 600px;
  margin: 0 auto;
}

input[type="number"] {
  background-color: #333;
  color: #eee;
  border: 1px solid #555;
  padding: 5px;
  margin-right: 10px;
}

button {
  background-color: #444;
  color: #eee;
  border: none;
  padding: 5px 10px;
  cursor: pointer;
}

button:hover {
  background-color: #555;
}

.highlight {
  background-color: rgba(255, 255, 0, 0.2);
  padding: 5px;
  margin: 5px 0;
}
`,
    "/index.js": `// Факториал
function factorial(n) {
  if (n === 0) {
    return 1;
  } else {
    return n * factorial(n - 1);
  }
}

const numberInput = document.getElementById('numberInput');
const calculateButton = document.getElementById('calculateButton');
const resultElement = document.getElementById('result');

calculateButton.addEventListener('click', () => {
  const number = parseInt(numberInput.value);
  const fact = factorial(number);
  resultElement.textContent = fact;
});

// Обратный отсчет
function countdown(n, outputElement) {
  if (n <= 0) {
    outputElement.textContent += "Пуск! ";
  } else {
    outputElement.textContent += n + " ";
    countdown(n - 1, outputElement);
  }
}

const countdownInput = document.getElementById('countdownInput');
const countdownButton = document.getElementById('countdownButton');
const countdownOutput = document.getElementById('countdownOutput');

countdownButton.addEventListener('click', () => {
  const number = parseInt(countdownInput.value);
  countdownOutput.textContent = ""; // Очищаем предыдущий отсчет
  countdown(number, countdownOutput);
});

// Поиск highlight divs
function findHighlightDivs(element) {
  let highlights = [];

  if (element.tagName === 'DIV' && element.classList.contains('highlight')) {
    highlights.push(element);
  }

  for (let i = 0; i < element.children.length; i++) {
    highlights = highlights.concat(findHighlightDivs(element.children[i]));
  }

  return highlights;
}

const rootElement = document.getElementById('root');
const findHighlightsButton = document.getElementById('findHighlightsButton');
const highlightsOutput = document.getElementById('highlightsOutput');

findHighlightsButton.addEventListener('click', () => {
  const highlightedDivs = findHighlightDivs(rootElement);
  highlightsOutput.textContent = ""; // Очищаем предыдущие результаты
  highlightedDivs.forEach(div => {
    highlightsOutput.textContent += div.textContent + "; ";
  });
});
`
  }}
  options={{
    showNavigator: false,
    showLineNumbers: true,
    editorHeight: 400
  }}
/>

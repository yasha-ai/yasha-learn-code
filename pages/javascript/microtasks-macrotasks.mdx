import { Sandpack } from '@codesandbox/sandpack-react'

## JavaScript: Microtasks vs Macrotasks. –ü–æ–≥—Ä—É–∂–µ–Ω–∏–µ –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å.

–í JavaScript –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–≥—Ä–∞—é—Ç –∫–ª—é—á–µ–≤—É—é —Ä–æ–ª—å. –ß—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, –∫–∞–∫ JavaScript —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –Ω–∏–º–∏, –≤–∞–∂–Ω–æ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ —Ä–∞–∑–Ω–∏—Ü–µ –º–µ–∂–¥—É microtasks –∏ macrotasks.

### –û—á–µ—Ä–µ–¥—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (Event Loop)

```mermaid
stateDiagram-v2
    [*] --> CallStack: Script Start
    CallStack --> Microtasks: Stack Empty
    state Microtasks {
        [*] --> ProcessMicrotasks
        ProcessMicrotasks --> ProcessMicrotasks: More microtasks?
        ProcessMicrotasks --> [*]: All microtasks done
    }
    Microtasks --> Render: UI Update
    Render --> Macrotasks: Next in queue
    state Macrotasks {
        [*] --> ExecuteOneMacrotask
        ExecuteOneMacrotask --> [*]
    }
    Macrotasks --> CallStack
```
*–¶–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á: –æ–¥–∏–Ω –º–∞–∫—Ä–æ—Ç–∞—Å–∫ -> –≤—Å–µ –º–∏–∫—Ä–æ—Ç–∞—Å–∫–∏ -> —Ä–µ–Ω–¥–µ—Ä.*

### –ß—Ç–æ —Ç–∞–∫–æ–µ Microtasks –∏ Macrotasks?

JavaScript - –æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω—ã–π —è–∑—ã–∫, –Ω–æ –æ–Ω —É–º–µ–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏.  –î–ª—è —ç—Ç–æ–≥–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º Event Loop (—Ü–∏–∫–ª —Å–æ–±—ã—Ç–∏–π), –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∑–∞–¥–∞—á. –ó–∞–¥–∞—á–∏ –¥–µ–ª—è—Ç—Å—è –Ω–∞ –¥–≤–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∏–ø–∞:

*   **Macrotasks (–º–∞–∫—Ä–æ–∑–∞–¥–∞—á–∏):** –≠—Ç–æ –∑–∞–¥–∞—á–∏, –¥–æ–±–∞–≤–ª—è–µ–º—ã–µ –≤ –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á (task queue). –ü—Ä–∏–º–µ—Ä—ã: `setTimeout`, `setInterval`, –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π (click, scroll), —Å–µ—Ç–µ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã (fetch, XMLHttpRequest).
*   **Microtasks (–º–∏–∫—Ä–æ–∑–∞–¥–∞—á–∏):** –≠—Ç–æ –∑–∞–¥–∞—á–∏, –¥–æ–±–∞–≤–ª—è–µ–º—ã–µ –≤ –æ—á–µ—Ä–µ–¥—å –º–∏–∫—Ä–æ–∑–∞–¥–∞—á (microtask queue). –ü—Ä–∏–º–µ—Ä—ã: `Promise.then`, `MutationObserver`, `process.nextTick` (–≤ Node.js).

–ì–ª–∞–≤–Ω–æ–µ –æ—Ç–ª–∏—á–∏–µ –≤ –ø–æ—Ä—è–¥–∫–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: Event Loop —Å–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ç–µ–∫—É—â–∏–π macrotask, –∑–∞—Ç–µ–º –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ microtasks, –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ —Å–ª–µ–¥—É—é—â–µ–º—É macrotask.

### –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```javascript
console.log("–ù–∞—á–∞–ª–æ");

setTimeout(() => {
  console.log("Macrotask: setTimeout");
}, 0);

Promise.resolve().then(() => {
  console.log("Microtask: Promise.then");
});

console.log("–ö–æ–Ω–µ—Ü");

// –í—ã–≤–æ–¥:
// –ù–∞—á–∞–ª–æ
// –ö–æ–Ω–µ—Ü
// Microtask: Promise.then
// Macrotask: setTimeout
```

–í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ —Å–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ ("–ù–∞—á–∞–ª–æ" –∏ "–ö–æ–Ω–µ—Ü"). –ó–∞—Ç–µ–º, –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–∏–º macrotask, –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤—Å–µ microtasks, –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ `Promise.then`.  `setTimeout` –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å macrotasks –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–∑–∂–µ.

### –ï—â–µ –æ–¥–∏–Ω –ø—Ä–∏–º–µ—Ä

```javascript
console.log("–ù–∞—á–∞–ª–æ");

setTimeout(() => {
  console.log("Macrotask 1");
  Promise.resolve().then(() => {
    console.log("Microtask –≤–Ω—É—Ç—Ä–∏ Macrotask 1");
  });
}, 0);

setTimeout(() => {
  console.log("Macrotask 2");
}, 0);

Promise.resolve().then(() => {
  console.log("Microtask 1");
  return Promise.resolve();
}).then(() => {
  console.log("Microtask 2");
});

console.log("–ö–æ–Ω–µ—Ü");

// –í—ã–≤–æ–¥:
// –ù–∞—á–∞–ª–æ
// –ö–æ–Ω–µ—Ü
// Microtask 1
// Microtask 2
// Macrotask 1
// Microtask –≤–Ω—É—Ç—Ä–∏ Macrotask 1
// Macrotask 2
```

–≠—Ç–æ—Ç –ø—Ä–∏–º–µ—Ä –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç, —á—Ç–æ microtasks, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –≤–Ω—É—Ç—Ä–∏ macrotasks, –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ macrotask, –Ω–æ –¥–æ –Ω–∞—á–∞–ª–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ.

### –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä

–í —Ä–µ–∞–ª—å–Ω—ã—Ö –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Ä–∞–∑–Ω–∏—Ü—ã –º–µ–∂–¥—É microtasks –∏ macrotasks –≤–∞–∂–Ω–æ –¥–ª—è:

*   **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**  –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è DOM, –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Promise.then` (microtask), —á—Ç–æ–±—ã –æ–Ω–∏ –≤—ã–ø–æ–ª–Ω–∏–ª–∏—Å—å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ –Ω–µ –∑–∞–¥–µ—Ä–∂–∏–≤–∞–ª–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫—É —Å–ª–µ–¥—É—é—â–µ–≥–æ –∫–∞–¥—Ä–∞.
*   **React:** React –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞–∫–µ—Ç–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è. –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è (setState) —á–∞—Å—Ç–æ –ø–ª–∞–Ω–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ microtasks, —á—Ç–æ–±—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ –≤—Å–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –±—É–¥—É—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –±—Ä–∞—É–∑–µ—Ä –ø–µ—Ä–µ—Ä–∏—Å—É–µ—Ç DOM. –≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –Ω–µ–Ω—É–∂–Ω—ã—Ö –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–æ–∫.
*   **Angular:** Angular –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Zone.js –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π. Zone.js —Ç–∞–∫–∂–µ –æ–ø–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ –∫–æ–Ω—Ü–µ–ø—Ü–∏—é microtasks –∏ macrotasks –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π.
*   **Vue.js:** Vue.js —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç microtasks –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è DOM.

### –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã

*   Macrotasks (setTimeout, setInterval, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π, —Å–µ—Ç–µ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã) –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á (task queue).
*   Microtasks (Promise.then, MutationObserver) –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å –º–∏–∫—Ä–æ–∑–∞–¥–∞—á (microtask queue).
*   Event Loop —Å–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ç–µ–∫—É—â–∏–π macrotask.
*   –ó–∞—Ç–µ–º Event Loop –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≤—Å–µ microtasks, –Ω–∞–∫–æ–ø–∏–≤—à–∏–µ—Å—è –≤ –æ—á–µ—Ä–µ–¥–∏.
*   –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ Event Loop –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ —Å–ª–µ–¥—É—é—â–µ–º—É macrotask.
*   –ó–Ω–∞–Ω–∏–µ —Ä–∞–∑–Ω–∏—Ü—ã –º–µ–∂–¥—É microtasks –∏ macrotasks –ø–æ–º–æ–≥–∞–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –ø–æ–Ω–∏–º–∞—Ç—å, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ JavaScript —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏.

### –ü—Ä–∞–∫—Ç–∏–∫–∞

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–∏–º–µ—Ä—ã –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ:

<Sandpack
  template="vanilla"
  files={{
    '/index.js': `index.js
// –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è Microtasks vs Macrotasks

document.body.style.fontFamily = 'Arial, sans-serif';
document.body.style.padding = '20px';
document.body.style.lineHeight = '1.6';

const output = document.createElement('div');
output.id = 'output';
output.style.backgroundColor = '#f5f5f5';
output.style.padding = '20px';
output.style.borderRadius = '8px';
output.style.marginTop = '20px';
document.body.appendChild(output);

const title = document.createElement('h2');
title.textContent = '–ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è Microtasks vs Macrotasks';
document.body.appendChild(title);

const description = document.createElement('p');
description.textContent = '–°–º–æ—Ç—Ä–∏—Ç–µ –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ –≤—ã–≤–æ–¥–µ –Ω–∏–∂–µ:';
document.body.appendChild(description);

const logContainer = document.createElement('div');
logContainer.style.marginTop = '20px';
document.body.appendChild(logContainer);

let stepNumber = 1;

function log(message, type = 'sync') {
  const colors = {
    sync: '#000',
    micro: '#2196F3',
    macro: '#FF9800'
  };
  
  const emoji = {
    sync: '‚ö°',
    micro: 'üîµ',
    macro: 'üü†'
  };
  
  const p = document.createElement('p');
  p.innerHTML = \`<strong>\${stepNumber++}.</strong> \${emoji[type]} <span style="color: \${colors[type]}">\${message}</span>\`;
  p.style.margin = '5px 0';
  logContainer.appendChild(p);
  
  console.log(\`[\${type.toUpperCase()}] \${message}\`);
}

// === –ü–†–ò–ú–ï–† 1: –ë–∞–∑–æ–≤—ã–π ===
log('üöÄ –ù–∞—á–∞–ª–æ —Å–∫—Ä–∏–ø—Ç–∞', 'sync');

setTimeout(() => {
  log('Macrotask: setTimeout(0)', 'macro');
}, 0);

Promise.resolve().then(() => {
  log('Microtask: Promise.then #1', 'micro');
});

Promise.resolve().then(() => {
  log('Microtask: Promise.then #2', 'micro');
});

log('–ö–æ–Ω–µ—Ü —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞', 'sync');

// === –ü–†–ò–ú–ï–† 2: –í–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ ===
setTimeout(() => {
  log('Macrotask: setTimeout #2', 'macro');
  
  Promise.resolve().then(() => {
    log('Microtask –≤–Ω—É—Ç—Ä–∏ Macrotask', 'micro');
  });
}, 0);

// –î–æ–±–∞–≤–ª—è–µ–º –ª–µ–≥–µ–Ω–¥—É
setTimeout(() => {
  const legend = document.createElement('div');
  legend.innerHTML = \`
    <h3>–õ–µ–≥–µ–Ω–¥–∞:</h3>
    <p>‚ö° <strong>–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥</strong> - –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å—Ä–∞–∑—É</p>
    <p>üîµ <strong style="color: #2196F3">Microtask</strong> - Promise.then, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞, –î–û macrotasks</p>
    <p>üü† <strong style="color: #FF9800">Macrotask</strong> - setTimeout, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –ø–æ—Å–ª–µ–¥–Ω—é—é –æ—á–µ—Ä–µ–¥—å</p>
    <hr>
    <p><strong>–ü–æ—Ä—è–¥–æ–∫ Event Loop:</strong></p>
    <ol>
      <li>–í—ã–ø–æ–ª–Ω–∏—Ç—å –≤–µ—Å—å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥</li>
      <li>–í—ã–ø–æ–ª–Ω–∏—Ç—å –í–°–ï microtasks</li>
      <li>–í—ã–ø–æ–ª–Ω–∏—Ç—å –û–î–ò–ù macrotask</li>
      <li>–ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Å —à–∞–≥–∞ 2</li>
    </ol>
  \`;
  legend.style.backgroundColor = '#e3f2fd';
  legend.style.padding = '15px';
  legend.style.borderRadius = '8px';
  legend.style.marginTop = '20px';
  document.body.appendChild(legend);
}, 100);`
  }}
/>

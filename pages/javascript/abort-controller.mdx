import { Playground } from '../../components/Playground'

## JavaScript: AbortController - –ö–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å—é

–í –º–∏—Ä–µ JavaScript, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏, –≤–∞–∂–Ω–æ —É–º–µ—Ç—å –∏—Ö –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å. `AbortController` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–æ—â–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –æ—Ç–º–µ–Ω—ã —Ç–∞–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π, –Ω–∞–ø—Ä–∏–º–µ—Ä, HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ –∏–ª–∏ –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π.

### –ß—Ç–æ —Ç–∞–∫–æ–µ AbortController?

`AbortController` - —ç—Ç–æ API –≤ JavaScript, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–∞–º –æ—Ç–º–µ–Ω—è—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏.  –û–Ω —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö —á–∞—Å—Ç–µ–π: `AbortController` –∏ `AbortSignal`. `AbortController` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–∏–≥–Ω–∞–ª–∞ –æ—Ç–º–µ–Ω—ã, –∞ `AbortSignal` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ–ø–µ—Ä–∞—Ü–∏—é, —á—Ç–æ–±—ã –æ–Ω–∞ –º–æ–≥–ª–∞ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø—Ä–µ—Ä–≤–∞—Ç—å—Å—è.

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –≤—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä, –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ—à–∏–ª –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –¥—Ä—É–≥—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞. –ë–µ–∑ `AbortController` –±—Ä–∞—É–∑–µ—Ä –≤—Å–µ —Ä–∞–≤–Ω–æ –±—É–¥–µ—Ç –∂–¥–∞—Ç—å –æ—Ç–≤–µ—Ç–∞, —á—Ç–æ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ.

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```javascript
// 1. –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä AbortController
const controller = new AbortController();
// 2. –ü–æ–ª—É—á–∞–µ–º AbortSignal
const signal = controller.signal;

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, fetch)
async function fetchData() {
  try {
    const response = await fetch('https://api.example.com/data', { signal }); // –ü–µ—Ä–µ–¥–∞–µ–º signal –≤ fetch
    const data = await response.json();
    console.log('–î–∞–Ω–Ω—ã–µ:', data);
  } catch (error) {
    if (error.name === 'AbortError') {
      console.log('–ó–∞–ø—Ä–æ—Å –æ—Ç–º–µ–Ω–µ–Ω!');
    } else {
      console.error('–û—à–∏–±–∫–∞:', error);
    }
  }
}

// –ó–∞–ø—É—Å–∫–∞–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ–ø–µ—Ä–∞—Ü–∏—é
fetchData();

// 3. –û—Ç–º–µ–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–Ω–æ–ø–∫—É)
setTimeout(() => {
  controller.abort(); // –û—Ç–º–µ–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
}, 1000);
```

–í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ –º—ã —Å–æ–∑–¥–∞–µ–º `AbortController` –∏ –ø–µ—Ä–µ–¥–∞–µ–º –µ–≥–æ `signal` –≤ —Ñ—É–Ω–∫—Ü–∏—é `fetch`. –ß–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É –º—ã –≤—ã–∑—ã–≤–∞–µ–º `controller.abort()`, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –æ—Ç–º–µ–Ω–µ –∑–∞–ø—Ä–æ—Å–∞.  `fetch` –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç `AbortError`, –∫–æ—Ç–æ—Ä—ã–π –º—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤ –±–ª–æ–∫–µ `catch`.

### –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Å UI

<Playground template="static" files={{
  'index.html': `
<div style="font-family: sans-serif; padding: 20px;">
  <h3>–ü—Ä–∏–º–µ—Ä AbortController</h3>
  <p>–ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É", –∑–∞—Ç–µ–º –±—ã—Å—Ç—Ä–æ "–û—Ç–º–µ–Ω–∏—Ç—å", —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —ç—Ñ—Ñ–µ–∫—Ç.</p>
  
  <div style="margin-bottom: 10px;">
    <button id="fetchBtn" style="padding: 8px 16px; margin-right: 10px; cursor: pointer;">–ù–∞—á–∞—Ç—å –¥–æ–ª–≥—É—é –∑–∞–≥—Ä—É–∑–∫—É</button>
    <button id="cancelBtn" style="padding: 8px 16px; cursor: pointer;" disabled>–û—Ç–º–µ–Ω–∏—Ç—å</button>
  </div>

  <div id="status" style="margin-top: 20px; padding: 10px; border: 1px solid #ccc; border-radius: 4px; min-height: 40px;">
    –û–∂–∏–¥–∞–Ω–∏–µ...
  </div>
</div>

<script>
  const fetchBtn = document.getElementById('fetchBtn');
  const cancelBtn = document.getElementById('cancelBtn');
  const statusDiv = document.getElementById('status');
  
  let controller = null;

  fetchBtn.addEventListener('click', async () => {
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º UI
    statusDiv.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö... (–ø–æ–¥–æ–∂–¥–∏—Ç–µ 3 —Å–µ–∫)';
    statusDiv.style.backgroundColor = '#e6f7ff';
    fetchBtn.disabled = true;
    cancelBtn.disabled = false;

    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
    controller = new AbortController();
    const signal = controller.signal;

    try {
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–µ—Ä–≤–∏—Å httpbin.org –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –∑–∞–¥–µ—Ä–∂–∫–∏
      const response = await fetch('https://httpbin.org/delay/3', { signal });
      
      const data = await response.json();
      statusDiv.textContent = '–£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ! –î–∞–Ω–Ω—ã–µ: ' + JSON.stringify(data.args || {});
      statusDiv.style.backgroundColor = '#d9f7be';
    } catch (err) {
      if (err.name === 'AbortError') {
        statusDiv.textContent = 'üõë –ó–∞–ø—Ä–æ—Å –±—ã–ª –æ—Ç–º–µ–Ω–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º!';
        statusDiv.style.backgroundColor = '#ffccc7';
      } else {
        statusDiv.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + err.message;
        statusDiv.style.backgroundColor = '#fff1f0';
      }
    } finally {
      // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫–∏ –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
      fetchBtn.disabled = false;
      cancelBtn.disabled = true;
      controller = null;
    }
  });

  cancelBtn.addEventListener('click', () => {
    if (controller) {
      controller.abort();
      statusDiv.textContent = '–û—Ç–º–µ–Ω—è–µ–º...';
    }
  });
</script>
  `
}} />

–≠—Ç–æ—Ç –ø—Ä–∏–º–µ—Ä –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç, –∫–∞–∫ `AbortController` –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –æ—Ç–º–µ–Ω—ã –∑–∞–ø—Ä–æ—Å–∞ –ø–æ –Ω–∞–∂–∞—Ç–∏—é –∫–Ω–æ–ø–∫–∏.  –í–∞–∂–Ω–æ —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å `controller` –ø–æ—Å–ª–µ –æ—Ç–º–µ–Ω—ã, —á—Ç–æ–±—ã –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ" —Å–æ–∑–¥–∞–≤–∞–ª—Å—è –Ω–æ–≤—ã–π `AbortController`.

### –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä

`AbortController` —à–∏—Ä–æ–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞—Ö, —Ç–∞–∫–∏—Ö –∫–∞–∫ React –∏ Vue, –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö. –ù–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –º–µ–∂–¥—É –º–∞—Ä—à—Ä—É—Ç–∞–º–∏ –∏–ª–∏ –ø—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞, –º–æ–∂–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å –≤—Å–µ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ HTTP-–∑–∞–ø—Ä–æ—Å—ã, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏ –∏ –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤.  –¢–∞–∫–∂–µ, –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ö –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–µ—Ç—å—é, –Ω–∞–ø—Ä–∏–º–µ—Ä, `axios`, –¥–ª—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–º–µ–Ω—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã.

### –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã

*   `AbortController` –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–º–µ–Ω—è—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏.
*   `AbortController` —Å–æ–∑–¥–∞–µ—Ç `AbortSignal`, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ–ø–µ—Ä–∞—Ü–∏—é.
*   –í—ã–∑–æ–≤ `controller.abort()` –æ—Ç–º–µ–Ω—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç `AbortError`.
*   –í–∞–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å `AbortError` –≤ –±–ª–æ–∫–µ `catch`.
*   `AbortController` –ø–æ–ª–µ–∑–µ–Ω –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏ –∏ –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ UI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö.

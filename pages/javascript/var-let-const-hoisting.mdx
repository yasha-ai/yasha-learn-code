## JavaScript: Мозги. Урок 2: var vs let vs const — hoisting и TDZ


![Иллюстрация к уроку](/lessons/javascript-var-let-const-hoisting.png)
Привет, будущие повелители JavaScript! Сегодня мы разберемся с тремя ключевыми способами объявления переменных: `var`, `let` и `const`. Поймем, чем они отличаются и как их поведение влияет на работу нашего кода, особенно в контексте hoisting и Temporal Dead Zone (TDZ).

### Объявление переменных: var, let и const

В JavaScript для объявления переменных используются `var`, `let` и `const`. Выбор между ними влияет на область видимости переменной и возможность её изменения.

*   **`var`**: Объявляет переменную, область видимости которой ограничена функцией (function scope) или, если объявлена вне функции, – глобальной областью видимости.
*   **`let`**: Объявляет переменную, область видимости которой ограничена блоком (block scope) – это означает, что она видна только внутри блока `{}` в котором объявлена.
*   **`const`**: Объявляет константу, значение которой нельзя изменить после инициализации. Область видимости также ограничена блоком (block scope).

```javascript
function exampleVar() {
  var x = 10;
  if (true) {
    var x = 20;  // Перезаписывает внешнюю переменную x
    console.log(x); // Выведет 20
  }
  console.log(x); // Выведет 20
}

exampleVar();
```

```javascript
function exampleLetConst() {
  let y = 10;
  if (true) {
    let y = 20;  // Создает новую переменную y в этом блоке
    console.log(y); // Выведет 20
    const z = 30;
    // z = 40; // Вызовет ошибку, так как const нельзя переназначить
  }
  console.log(y); // Выведет 10
  // console.log(z); // Вызовет ошибку, z не определена за пределами блока
}

exampleLetConst();
```

### Hoisting

Hoisting (поднятие) – это механизм в JavaScript, при котором объявления переменных и функций перемещаются в начало их области видимости до начала выполнения кода. Важно понимать, что поднимается только объявление, а не инициализация (присвоение значения).

*   **`var`**: Переменные, объявленные с помощью `var`, поднимаются и инициализируются значением `undefined`. Это означает, что можно использовать переменную до её объявления, но она будет иметь значение `undefined`.
*   **`let` и `const`**: Переменные, объявленные с помощью `let` и `const`, также поднимаются, но *не* инициализируются. Это означает, что попытка обратиться к переменной до её объявления вызовет ошибку `ReferenceError: Cannot access 'variable' before initialization`.  Это состояние называется Temporal Dead Zone (TDZ).

```javascript
console.log(myVar); // Выведет undefined
var myVar = 5;

// console.log(myLet); // Вызовет ReferenceError: Cannot access 'myLet' before initialization
let myLet = 10;

// console.log(myConst); // Вызовет ReferenceError: Cannot access 'myConst' before initialization
const myConst = 15;
```

### Temporal Dead Zone (TDZ)

TDZ – это временная "мертвая зона", в которой переменная, объявленная с помощью `let` или `const`, существует, но к ней нельзя обратиться до момента её объявления в коде. Попытка доступа к переменной в TDZ приводит к ошибке `ReferenceError`.

```javascript
function tdzExample() {
  console.log(myVar); // undefined
  // console.log(myLet); // ReferenceError: Cannot access 'myLet' before initialization
  var myVar = "var variable";
  let myLet = "let variable";
}

tdzExample();
```

### Жизненный пример

В современных JavaScript-фреймворках, таких как React, Angular и Vue, `let` и `const` используются повсеместно.  Например, при работе с React компонентами, `const` часто используется для объявления неизменяемых переменных, содержащих props или state, а `let` используется для переменных, которые могут меняться в пределах компонента.  Использование `let` и `const` позволяет избежать случайных ошибок, связанных с переопределением переменных, и делает код более предсказуемым.

```javascript
// Пример React компонента
function MyComponent(props) {
  const name = props.name; // Использование const для props
  let count = 0; // Использование let для state (упрощенный пример)

  function handleClick() {
    count++; // Изменяем значение count
    console.log(`Clicked ${count} times`);
  }

  return (
    <button onClick={handleClick}>
      Hello, {name}! Click me.
    </button>
  );
}
```

### Ключевые моменты

*   `var` имеет function scope, `let` и `const` имеют block scope.
*   `var` поднимается и инициализируется `undefined`, `let` и `const` поднимаются, но не инициализируются (TDZ).
*   `const` используется для констант, `let` для переменных, которые могут изменяться.
*   В современном JavaScript рекомендуется использовать `let` и `const` вместо `var` для повышения предсказуемости и избежания ошибок.
*   TDZ помогает выявлять ошибки до того, как они приведут к неожиданному поведению программы.



## Интерактивный пример

<Sandpack
  template="vanilla"
  files={{
    "/index.html": `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>var vs let vs const</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div class="container">
    <h1>var vs let vs const</h1>
    <p>Введите значение:</p>
    <input type="number" id="inputValue" value="10">
    <button id="runButton">Запустить пример</button>
    <div id="output"></div>
  </div>
  <script src="/index.js"><\/script>
</body>
</html>`,
    "/styles.css": `body {
  font-family: sans-serif;
  background-color: #222;
  color: #eee;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  margin: 0;
}

.container {
  background-color: #333;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  text-align: center;
}

input[type="number"] {
  padding: 8px;
  border-radius: 4px;
  border: 1px solid #555;
  background-color: #444;
  color: #eee;
  margin: 10px 0;
}

button {
  padding: 10px 20px;
  border: none;
  border-radius: 4px;
  background-color: #646cff;
  color: #fff;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

button:hover {
  background-color: #535bf2;
}

#output {
  margin-top: 20px;
  font-size: 16px;
  color: #999;
  min-height: 50px;
}
`,
    "/index.js": `document.addEventListener('DOMContentLoaded', () => {
  const inputValue = document.getElementById('inputValue');
  const runButton = document.getElementById('runButton');
  const output = document.getElementById('output');

  runButton.addEventListener('click', () => {
    const value = parseInt(inputValue.value);

    output.innerHTML = ''; // Очищаем предыдущий вывод

    // Пример с var
    function exampleVar(input) {
      var x = input;
      if (true) {
        var x = input * 2; // Перезаписывает внешнюю переменную x
        output.innerHTML += '<p>Внутри if (var): ' + x + '</p>';
      }
      output.innerHTML += '<p>Снаружи if (var): ' + x + '</p>';
    }

    // Пример с let и const
    function exampleLetConst(input) {
      let y = input;
      if (true) {
        let y = input * 2; // Создает новую переменную y в этом блоке
        const z = input * 3;
        output.innerHTML += '<p>Внутри if (let): ' + y + '</p>';
        output.innerHTML += '<p>Внутри if (const): ' + z + '</p>';
        // z = 40; // Вызовет ошибку, так как const нельзя переназначить
      }
      output.innerHTML += '<p>Снаружи if (let): ' + y + '</p>';
      // console.log(z); // Вызовет ошибку, z не определена за пределами блока
    }

    // Пример с hoisting
    function exampleHoisting() {
      output.innerHTML += '<p>Hoisting var: ' + (typeof myVar !== 'undefined' ? myVar : 'undefined') + '</p>'; // Выведет undefined
      var myVar = value;
      output.innerHTML += '<p>Hoisting var после присвоения: ' + myVar + '</p>';

      try {
        output.innerHTML += '<p>Hoisting let: ';
        let myLet = value * 4; // Вызовет ReferenceError, если раскомментировать console.log выше
        output.innerHTML += myLet + '</p>';
      } catch (e) {
        output.innerHTML += 'Ошибка: ' + e.message + '</p>';
      }

      try {
        output.innerHTML += '<p>Hoisting const: ';
        const myConst = value * 5; // Вызовет ReferenceError, если раскомментировать console.log выше
        output.innerHTML += myConst + '</p>';
      } catch (e) {
        output.innerHTML += 'Ошибка: ' + e.message + '</p>';
      }
    }

    output.innerHTML += '<h2>Пример с var:</h2>';
    exampleVar(value);

    output.innerHTML += '<h2>Пример с let и const:</h2>';
    exampleLetConst(value);

    output.innerHTML += '<h2>Пример с Hoisting:</h2>';
    exampleHoisting();
  });
});
`
  }}
  options={{
    showNavigator: false,
    showLineNumbers: true,
    editorHeight: 400
  }}
/>

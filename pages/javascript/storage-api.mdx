## JavaScript: Мозги. Урок: Storage API


![Иллюстрация к уроку](/lessons/javascript-storage-api.png)
Storage API позволяет веб-приложениям сохранять данные локально в браузере пользователя. Это отличный способ сохранить состояние приложения между сессиями, пользовательские настройки или даже кэшировать данные для повышения производительности.

### Что такое Storage API?

Storage API предоставляет два основных объекта: `localStorage` и `sessionStorage`. Оба они позволяют хранить данные в формате "ключ-значение", но отличаются временем жизни. `localStorage` сохраняет данные постоянно (пока пользователь сам не очистит), а `sessionStorage` хранит данные только в течение текущей сессии браузера (пока открыта вкладка или окно).

### localStorage

`localStorage` используется для хранения данных, которые должны сохраняться даже после закрытия браузера.

```javascript
// Сохраняем данные
localStorage.setItem('username', 'JohnDoe');
localStorage.setItem('theme', 'dark');

// Получаем данные
const username = localStorage.getItem('username');
const theme = localStorage.getItem('theme');

console.log('Username:', username); // Output: Username: JohnDoe
console.log('Theme:', theme); // Output: Theme: dark

// Удаляем один элемент
localStorage.removeItem('username');

// Очищаем все данные
localStorage.clear();
```

### sessionStorage

`sessionStorage` используется для хранения данных, которые должны быть доступны только в течение текущей сессии.

```javascript
// Сохраняем данные
sessionStorage.setItem('cartId', '12345');

// Получаем данные
const cartId = sessionStorage.getItem('cartId');

console.log('Cart ID:', cartId); // Output: Cart ID: 12345

// После закрытия вкладки или окна, cartId будет удален.
```

### Практический пример: Сохранение темы пользователя

Предположим, у нас есть сайт с возможностью переключения между светлой и темной темой. Мы можем использовать `localStorage`, чтобы сохранить выбор пользователя и восстановить его при следующем посещении.

```html
<!DOCTYPE html>
<html>
<head>
  <title>Theme Switcher</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <button id="theme-toggle">Toggle Theme</button>

  <script>
    const themeToggle = document.getElementById('theme-toggle');
    const body = document.body;

    // Функция для применения темы
    function setTheme(theme) {
      if (theme === 'dark') {
        body.classList.add('dark-theme');
      } else {
        body.classList.remove('dark-theme');
      }
    }

    // Получаем сохраненную тему из localStorage
    const savedTheme = localStorage.getItem('theme');

    // Применяем сохраненную тему при загрузке страницы
    if (savedTheme) {
      setTheme(savedTheme);
    }

    // Обработчик клика на кнопку
    themeToggle.addEventListener('click', () => {
      // Переключаем тему
      if (body.classList.contains('dark-theme')) {
        setTheme('light');
        localStorage.setItem('theme', 'light');
      } else {
        setTheme('dark');
        localStorage.setItem('theme', 'dark');
      }
    });
  </script>
</body>
</html>
```

```css
/* style.css */
body {
  background-color: white;
  color: black;
}

.dark-theme {
  background-color: black;
  color: white;
}
```

### Жизненный пример

*   **Сохранение настроек пользователя:** Многие веб-сайты используют Storage API для сохранения пользовательских настроек, таких как тема оформления, язык, размер шрифта и т.д.
*   **Корзины покупок:** Интернет-магазины часто используют `localStorage` или `sessionStorage` для хранения товаров в корзине пользователя до оформления заказа.
*   **Кэширование данных:** Веб-приложения могут использовать Storage API для кэширования данных с сервера, чтобы ускорить загрузку страниц и уменьшить количество запросов к серверу.
*   **Фреймворки:** Многие JavaScript фреймворки и библиотеки (например, React, Vue, Angular) используют Storage API для управления состоянием приложения.

### Ключевые моменты

*   `localStorage` хранит данные постоянно, `sessionStorage` - только в течение сессии.
*   Данные хранятся в формате "ключ-значение".
*   Storage API предоставляет методы `setItem`, `getItem`, `removeItem` и `clear`.
*   Используйте Storage API для сохранения пользовательских настроек, данных корзины покупок или кэширования данных.
*   Будьте осторожны с хранением конфиденциальных данных, так как они могут быть доступны скриптам на странице.
*   Максимальный объем данных, который можно хранить в Storage API, ограничен (обычно 5-10 МБ на домен).



## Интерактивный пример

<Sandpack
  template="vanilla"
  files={{
    "/index.html": `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Theme Switcher</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <h1>Theme Switcher</h1>
    <button id="theme-toggle">Toggle Theme</button>
    <p>Текущая тема: <span id="current-theme"></span></p>
    <label for="username">Имя пользователя:</label>
    <input type="text" id="username" placeholder="Введите имя">
    <button id="save-username">Сохранить имя</button>
    <p>Привет, <span id="greeting"></span>!</p>
  </div>
  <script src="index.js"><\/script>
</body>
</html>`,
    "/styles.css": `body {
  font-family: sans-serif;
  transition: background-color 0.3s, color 0.3s;
}

.container {
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  max-width: 400px;
  margin: 20px auto;
  text-align: center;
}

body.dark-theme {
  background-color: #333;
  color: #fff;
}

button {
  padding: 10px 20px;
  background-color: #4CAF50;
  color: white;
  border: none;
  cursor: pointer;
  border-radius: 5px;
  margin-top: 10px;
}

button:hover {
  background-color: #3e8e41;
}

input[type="text"] {
  padding: 8px;
  margin: 10px 0;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
  width: 100%;
}
`,
    "/index.js": `// Получаем элементы DOM
const themeToggle = document.getElementById('theme-toggle');
const body = document.body;
const currentThemeDisplay = document.getElementById('current-theme');
const usernameInput = document.getElementById('username');
const saveUsernameButton = document.getElementById('save-username');
const greetingDisplay = document.getElementById('greeting');

// Функция для применения темы
function setTheme(theme) {
  if (theme === 'dark') {
    body.classList.add('dark-theme');
    currentThemeDisplay.textContent = 'Темная';
  } else {
    body.classList.remove('dark-theme');
    currentThemeDisplay.textContent = 'Светлая';
  }
}

// Получаем сохраненную тему из localStorage
const savedTheme = localStorage.getItem('theme');

// Применяем сохраненную тему при загрузке страницы
if (savedTheme) {
  setTheme(savedTheme);
} else {
  // Если тема не сохранена, устанавливаем светлую тему по умолчанию
  setTheme('light');
  localStorage.setItem('theme', 'light');
}

// Обработчик клика на кнопку переключения темы
themeToggle.addEventListener('click', () => {
  // Переключаем тему
  if (body.classList.contains('dark-theme')) {
    setTheme('light');
    localStorage.setItem('theme', 'light');
  } else {
    setTheme('dark');
    localStorage.setItem('theme', 'dark');
  }
});

// Функция для сохранения имени пользователя
function saveUsername() {
  const username = usernameInput.value;
  localStorage.setItem('username', username);
  updateGreeting(username);
}

// Функция для обновления приветствия
function updateGreeting(username) {
  if (username) {
    greetingDisplay.textContent = username;
  } else {
    greetingDisplay.textContent = 'гость';
  }
}

// Получаем сохраненное имя пользователя из localStorage
const savedUsername = localStorage.getItem('username');

// Обновляем приветствие при загрузке страницы
updateGreeting(savedUsername);

// Обработчик клика на кнопку сохранения имени
saveUsernameButton.addEventListener('click', saveUsername);
`
  }}
  options={{
    showNavigator: false,
    showLineNumbers: true,
    editorHeight: 400
  }}
/>

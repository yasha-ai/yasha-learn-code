## JavaScript: Мозги. Урок: Notifications API


![Иллюстрация к уроку](/lessons/javascript-notifications-api.png)
Notifications API позволяет веб-приложениям отображать уведомления пользователю вне контекста веб-страницы. Это мощный инструмент для привлечения внимания и информирования о важных событиях.

### Что такое Notifications API?

Notifications API предоставляет интерфейс для отображения системных уведомлений. Это значит, что уведомления будут выглядеть как обычные уведомления операционной системы, а не как часть веб-страницы. Пользователь может взаимодействовать с ними так же, как и с любыми другими уведомлениями.

### Как это работает?

Чтобы использовать Notifications API, нужно выполнить несколько шагов:

1.  **Проверить разрешение:** Убедиться, что у вашего сайта есть разрешение на отправку уведомлений.
2.  **Запросить разрешение (если нужно):** Если разрешения нет, запросить его у пользователя.
3.  **Создать уведомление:** Создать объект `Notification` с нужными параметрами (заголовок, текст, иконка и т.д.).

Вот пример кода:

```javascript
// Проверяем, поддерживается ли Notifications API в браузере
if ("Notification" in window) {
  // Проверяем, есть ли у нас разрешение на отправку уведомлений
  if (Notification.permission === "granted") {
    // Если разрешение есть, создаем и показываем уведомление
    new Notification("Привет, мир!", {
      body: "Это ваше первое уведомление!",
      icon: "icon.png" // необязательно
    });
  } else if (Notification.permission !== "denied") {
    // Если разрешения нет (и пользователь еще не отказал), запрашиваем его
    Notification.requestPermission().then(function (permission) {
      // Если пользователь дал разрешение, создаем и показываем уведомление
      if (permission === "granted") {
        new Notification("Привет, мир!", {
          body: "Спасибо за разрешение!",
          icon: "icon.png" // необязательно
        });
      }
    });
  }
} else {
  alert("Ваш браузер не поддерживает Notifications API.");
}
```

### Дополнительные параметры

У уведомлений можно задавать разные параметры, например:

*   `body`: Текст уведомления.
*   `icon`: URL иконки уведомления.
*   `data`: Произвольные данные, которые можно использовать при обработке событий уведомления.
*   `tag`: Уникальный идентификатор уведомления. Если придет уведомление с таким же `tag`, то старое уведомление будет заменено новым.
*   `actions`: Массив кнопок, которые будут отображаться в уведомлении.

Пример с `tag`:

```javascript
new Notification("Новое сообщение!", {
  body: "У вас новое сообщение от друга.",
  tag: "new-message"
});
```

Если после этого отправить еще одно уведомление с `tag: "new-message"`, то старое уведомление будет заменено.

### События уведомлений

У уведомлений есть несколько событий, на которые можно подписаться:

*   `onclick`: Событие, которое срабатывает при клике на уведомление.
*   `onclose`: Событие, которое срабатывает при закрытии уведомления.
*   `onerror`: Событие, которое срабатывает при ошибке отображения уведомления.
*   `onshow`: Событие, которое срабатывает при отображении уведомления.

Пример обработки события `onclick`:

```javascript
let notification = new Notification("Напоминание!", {
  body: "Пора сделать перерыв!"
});

notification.onclick = function() {
  window.focus(); // Переключаемся на окно браузера, если оно свернуто
  // Дополнительная логика, например, открытие нужной вкладки
};
```

### Жизненный пример

Notifications API широко используется в различных веб-приложениях:

*   **Социальные сети:** Уведомления о новых сообщениях, упоминаниях, лайках.
*   **Email-клиенты:** Уведомления о новых письмах.
*   **Приложения для управления задачами:** Уведомления о приближающихся сроках выполнения задач.
*   **Новостные сайты:** Уведомления о важных новостях.
*   **Фреймворки:** Некоторые фреймворки, такие как Angular и React, предоставляют обертки над Notifications API для упрощения работы с ними.

### Ключевые моменты

*   Notifications API позволяет отправлять системные уведомления пользователю.
*   Перед отправкой уведомлений необходимо запросить разрешение у пользователя.
*   У уведомлений можно задавать различные параметры (заголовок, текст, иконка и т.д.).
*   Можно подписываться на события уведомлений (например, `onclick`, `onclose`).
*   Notifications API широко используется в различных веб-приложениях для информирования пользователя о важных событиях.



## Интерактивный пример

<Sandpack
  template="vanilla"
  files={{
    "/index.html": `<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Notifications API Demo</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div class="container">
    <h1>Notifications API Demo</h1>
    <button id="requestPermission">Запросить разрешение на уведомления</button>
    <button id="showNotification">Показать уведомление</button>
    <input type="text" id="notificationTitle" placeholder="Заголовок уведомления" value="Привет, мир!">
    <input type="text" id="notificationBody" placeholder="Текст уведомления" value="Это ваше первое уведомление!">
    <button id="updateNotification">Обновить уведомление (tag)</button>
  </div>
  <script src="/index.js"><\/script>
</body>
</html>`,
    "/styles.css": `body {
  font-family: sans-serif;
  background-color: #222;
  color: #eee;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  margin: 0;
}

.container {
  background-color: #333;
  padding: 20px;
  border-radius: 8px;
  text-align: center;
  width: 80%;
  max-width: 600px;
}

button {
  background-color: #4CAF50;
  border: none;
  color: white;
  padding: 10px 20px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 4px 2px;
  cursor: pointer;
  border-radius: 4px;
}

button:hover {
  background-color: #3e8e41;
}

input[type="text"] {
  padding: 10px;
  margin: 5px;
  border: 1px solid #555;
  border-radius: 4px;
  background-color: #444;
  color: #eee;
  width: 100%;
  box-sizing: border-box;
}
`,
    "/index.js": `// Получаем элементы управления из HTML
const requestPermissionButton = document.getElementById("requestPermission");
const showNotificationButton = document.getElementById("showNotification");
const updateNotificationButton = document.getElementById("updateNotification");
const notificationTitleInput = document.getElementById("notificationTitle");
const notificationBodyInput = document.getElementById("notificationBody");

let currentNotification = null; // Переменная для хранения текущего уведомления

// Функция для показа уведомления
function showNotification(title, body) {
  if ("Notification" in window) {
    if (Notification.permission === "granted") {
      currentNotification = new Notification(title, {
        body: body,
        icon: "https://sandpack-bundler.vercel.app/img/sandpack-logo.png",
        tag: "my-notification" // Используем tag для обновления уведомления
      });

      currentNotification.onclick = function() {
        console.log("Уведомление было кликнуто!");
      };

      currentNotification.onclose = function() {
        console.log("Уведомление было закрыто!");
      };

      currentNotification.onerror = function() {
        console.error("Ошибка при отображении уведомления!");
      };

    } else if (Notification.permission !== "denied") {
      Notification.requestPermission().then(function (permission) {
        if (permission === "granted") {
          currentNotification = new Notification(title, {
            body: body,
            icon: "https://sandpack-bundler.vercel.app/img/sandpack-logo.png",
            tag: "my-notification" // Используем tag для обновления уведомления
          });

          currentNotification.onclick = function() {
            console.log("Уведомление было кликнуто!");
          };

          currentNotification.onclose = function() {
            console.log("Уведомление было закрыто!");
          };

          currentNotification.onerror = function() {
            console.error("Ошибка при отображении уведомления!");
          };
        }
      });
    }
  } else {
    alert("Ваш браузер не поддерживает Notifications API.");
  }
}

// Обработчик клика на кнопку запроса разрешения
requestPermissionButton.addEventListener("click", function() {
  if ("Notification" in window) {
    Notification.requestPermission().then(function (permission) {
      console.log("Разрешение на уведомления:", permission);
    });
  } else {
    alert("Ваш браузер не поддерживает Notifications API.");
  }
});

// Обработчик клика на кнопку показа уведомления
showNotificationButton.addEventListener("click", function() {
  const title = notificationTitleInput.value;
  const body = notificationBodyInput.value;
  showNotification(title, body);
});

// Обработчик клика на кнопку обновления уведомления
updateNotificationButton.addEventListener("click", function() {
  const title = "Обновленное уведомление!";
  const body = "Это обновленное уведомление с тем же tag!";
  showNotification(title, body);
});
`
  }}
  options={{
    showNavigator: false,
    showLineNumbers: true,
    editorHeight: 400
  }}
/>

## JavaScript: Мозги. Урок: Resize Observer


![Иллюстрация к уроку](/lessons/javascript-resize-observer.png)
Resize Observer – это мощный инструмент JavaScript, позволяющий вам реагировать на изменения размеров элементов DOM.  Вместо постоянной проверки размеров с помощью `window.innerWidth` или `element.offsetWidth`, Resize Observer предоставляет элегантный и эффективный способ отслеживать эти изменения.

### Что такое Resize Observer?

Resize Observer – это API, которое позволяет вам отслеживать изменения размеров одного или нескольких HTML элементов. Когда размер отслеживаемого элемента изменяется (например, пользователь изменил размер окна браузера, элемент был добавлен или удален из DOM, изменились стили элемента), Resize Observer вызывает callback функцию, предоставляя информацию о новых размерах элемента.  Это позволяет динамически адаптировать контент и поведение вашего веб-приложения к текущим размерам элементов.

### Пример кода

Простейший пример использования Resize Observer:

```javascript
// Создаем экземпляр ResizeObserver
const resizeObserver = new ResizeObserver(entries => {
  for (let entry of entries) {
    // entry.target - это элемент, размер которого изменился
    const width = entry.contentRect.width;
    const height = entry.contentRect.height;

    console.log(`Размер элемента изменен! Ширина: ${width}, Высота: ${height}`);
  }
});

// Наблюдаем за элементом с id "myElement"
const element = document.getElementById('myElement');
resizeObserver.observe(element);

// Чтобы прекратить наблюдение:
// resizeObserver.unobserve(element);
// resizeObserver.disconnect(); // Прекратить наблюдение за всеми элементами
```

```html
<div id="myElement" style="width: 200px; height: 100px; background-color: lightblue;">
  Измените размер этого элемента!
</div>
```

В этом примере создается экземпляр `ResizeObserver`, который при изменении размера элемента с id `myElement` выводит в консоль его новую ширину и высоту.  Обратите внимание на `entry.contentRect`, который содержит информацию о размерах элемента.

### Параметры наблюдений (options)

Метод `observe` может принимать второй аргумент - объект с параметрами. На данный момент существует только один параметр: `box`.

*   `box`: Указывает, какую часть элемента нужно наблюдать. Возможные значения:
    *   `content-box`: Наблюдает за размерами контентной области элемента (внутри padding). **(Значение по умолчанию)**
    *   `border-box`: Наблюдает за размерами элемента с учетом border.
    *   `device-pixel-content-box`: Наблюдает за размерами контентной области в физических пикселях устройства.

Пример использования `border-box`:

```javascript
const resizeObserver = new ResizeObserver(entries => {
  for (let entry of entries) {
    console.log("Ширина с учетом border:", entry.borderBoxSize[0].inlineSize);
  }
});

const element = document.getElementById('myElement');
resizeObserver.observe(element, { box: 'border-box' });
```

### Жизненный пример

Resize Observer активно используется в современных веб-разработках:

*   **Адаптивные компоненты:**  Например, слайдеры, карусели или графики, которые автоматически подстраиваются под доступное пространство.
*   **Lazy loading изображений:**  Когда элемент (контейнер изображения) становится видимым (то есть его размер становится больше 0), загружается изображение.
*   **Библиотеки UI:**  Многие библиотеки UI (например, React, Vue, Angular) используют Resize Observer для управления компоновкой и адаптивностью своих компонентов.
*   **Реагирование на изменение ориентации мобильных устройств:**  Можно использовать Resize Observer для отслеживания изменений размеров viewport и адаптировать интерфейс приложения к портретной или альбомной ориентации.

### Ключевые моменты

*   Resize Observer – это эффективный и современный способ отслеживания изменений размеров элементов DOM.
*   Он вызывает callback функцию только при реальных изменениях размера, что экономит ресурсы.
*   `entry.contentRect` содержит информацию о новых размерах элемента.
*   Метод `observe` используется для начала наблюдения за элементом.
*   Методы `unobserve` и `disconnect` используются для прекращения наблюдения.
*   `box` параметр позволяет выбрать, какую часть элемента наблюдать.
*   Resize Observer активно используется в современных веб-приложениях для создания адаптивных и динамичных интерфейсов.



## Интерактивный пример

<Sandpack
  template="vanilla"
  files={{
    "/index.html": `<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Resize Observer Example</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <h1>Resize Observer Demo</h1>
    <div id="myElement">
      Измените размер этого элемента!
    </div>
    <div class="controls">
      <label for="widthInput">Ширина:</label>
      <input type="number" id="widthInput" value="200">
      <label for="heightInput">Высота:</label>
      <input type="number" id="heightInput" value="100">
      <button id="updateButton">Обновить размер</button>
      <select id="boxType">
        <option value="content-box">content-box</option>
        <option value="border-box">border-box</option>
      </select>
    </div>
    <div id="output">
      Размеры элемента: <span id="elementWidth"></span> x <span id="elementHeight"></span>
    </div>
  </div>
  <script src="index.js"><\/script>
</body>
</html>`,
    "/styles.css": `body {
  font-family: sans-serif;
  background-color: #222;
  color: #eee;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  margin: 0;
}

.container {
  background-color: #333;
  padding: 20px;
  border-radius: 8px;
  width: 80%;
  max-width: 600px;
}

#myElement {
  width: 200px;
  height: 100px;
  background-color: lightblue;
  padding: 20px;
  margin-bottom: 10px;
  box-sizing: border-box; /* Важно для border-box */
}

.controls {
  display: flex;
  flex-direction: column;
  margin-bottom: 10px;
}

.controls label {
  margin-bottom: 5px;
}

.controls input, .controls button, .controls select {
  margin-bottom: 10px;
  padding: 5px;
  border-radius: 4px;
  border: 1px solid #555;
  background-color: #444;
  color: #eee;
}

.controls button {
  cursor: pointer;
  background-color: #666;
}

#output {
  margin-top: 10px;
}
`,
    "/index.js": `// Получаем элементы DOM
const element = document.getElementById('myElement');
const widthInput = document.getElementById('widthInput');
const heightInput = document.getElementById('heightInput');
const updateButton = document.getElementById('updateButton');
const elementWidthDisplay = document.getElementById('elementWidth');
const elementHeightDisplay = document.getElementById('elementHeight');
const boxTypeSelect = document.getElementById('boxType');

// Функция для обновления размеров элемента
function updateElementSize() {
  element.style.width = widthInput.value + 'px';
  element.style.height = heightInput.value + 'px';
}

// Создаем экземпляр ResizeObserver
const resizeObserver = new ResizeObserver(entries => {
  for (let entry of entries) {
    let width, height;
    if (boxTypeSelect.value === 'border-box') {
      width = entry.borderBoxSize[0].inlineSize;
      height = entry.borderBoxSize[0].blockSize;
    } else {
      width = entry.contentRect.width;
      height = entry.contentRect.height;
    }

    // Обновляем отображение размеров
    elementWidthDisplay.textContent = width;
    elementHeightDisplay.textContent = height;
  }
});

// Наблюдаем за элементом
resizeObserver.observe(element, { box: boxTypeSelect.value });

// Обработчик кнопки "Обновить размер"
updateButton.addEventListener('click', updateElementSize);

// Обработчик изменения типа box
boxTypeSelect.addEventListener('change', () => {
  resizeObserver.unobserve(element);
  resizeObserver.observe(element, { box: boxTypeSelect.value });
  updateElementSize(); // Обновляем размер, чтобы сразу отобразить изменения
});

// Инициализация размеров при загрузке страницы
updateElementSize();
`
  }}
  options={{
    showNavigator: false,
    showLineNumbers: true,
    editorHeight: 400
  }}
/>

## JavaScript: Мозги. Урок 3: Приведение типов (coercion)


![Иллюстрация к уроку](/lessons/javascript-type-coercion.png)
Приведение типов (coercion) в JavaScript - это автоматическое преобразование значения из одного типа данных в другой. Понимание этого механизма критически важно для написания предсказуемого и надежного кода. Давайте разберемся, как это работает.

### Что такое приведение типов?

JavaScript - язык с динамической типизацией. Это значит, что тип переменной определяется во время выполнения программы, а не во время компиляции.  Когда мы выполняем операции с разными типами данных, JavaScript пытается привести их к общему типу, чтобы выполнить операцию. Это и есть приведение типов.

### Примеры приведения типов

Рассмотрим несколько примеров.

**1. Сложение строки и числа:**

```javascript
let result = "5" + 3;
console.log(result); // Вывод: "53"
console.log(typeof result); // Вывод: "string"
```

В этом случае число `3` приводится к строке, и происходит конкатенация (объединение) строк. Результат - строка "53".

**2. Вычитание строки и числа:**

```javascript
let result = "5" - 3;
console.log(result); // Вывод: 2
console.log(typeof result); // Вывод: "number"
```

Здесь строка "5" приводится к числу, и происходит вычитание.  Результат - число 2.

**3. Сравнение с использованием `==`:**

```javascript
console.log(5 == "5"); // Вывод: true
console.log(0 == false); // Вывод: true
console.log(null == undefined); // Вывод: true
```

Оператор `==` выполняет нестрогое сравнение, которое включает приведение типов.  В этих случаях значения приводятся к одному типу перед сравнением.

**4. Сравнение с использованием `===`:**

```javascript
console.log(5 === "5"); // Вывод: false
console.log(0 === false); // Вывод: false
console.log(null === undefined); // Вывод: false
```

Оператор `===` выполняет строгое сравнение, которое не включает приведение типов. Значения должны быть одного типа и иметь одинаковое значение, чтобы сравнение было истинным.

**5. Приведение к булеву типу:**

```javascript
console.log(Boolean(0)); // Вывод: false
console.log(Boolean("")); // Вывод: false
console.log(Boolean(null)); // Вывод: false
console.log(Boolean(undefined)); // Вывод: false
console.log(Boolean(NaN)); // Вывод: false
console.log(Boolean("hello")); // Вывод: true
console.log(Boolean(123)); // Вывод: true
console.log(Boolean({})); // Вывод: true
console.log(Boolean([])); // Вывод: true
```

Значения, которые приводятся к `false`, называются "falsy" значениями.  Все остальные значения приводятся к `true` ("truthy" значения).

### Жизненный пример

Приведение типов часто встречается при работе с формами и DOM. Например, значение, введенное пользователем в текстовое поле, всегда является строкой. Если вам нужно использовать это значение как число, вам необходимо явно привести его к числовому типу:

```html
<input type="text" id="age">
<button onclick="calculateAge()">Calculate</button>
<p id="result"></p>

<script>
function calculateAge() {
  let ageString = document.getElementById("age").value;
  let age = parseInt(ageString); // Приведение строки к числу

  if (isNaN(age)) {
    document.getElementById("result").innerText = "Please enter a valid number.";
  } else {
    document.getElementById("result").innerText = "You are " + age + " years old.";
  }
}
</script>
```

В этом примере `parseInt()` используется для преобразования строки, полученной из текстового поля, в целое число. Без этого преобразования, при выполнении дальнейших операций с `age` могут возникнуть непредсказуемые результаты.

### Ключевые моменты

*   JavaScript выполняет приведение типов автоматически.
*   Оператор `==` выполняет нестрогое сравнение с приведением типов.
*   Оператор `===` выполняет строгое сравнение без приведения типов.
*   Понимание "falsy" и "truthy" значений важно для работы с условными операторами.
*   Явное приведение типов (`parseInt()`, `parseFloat()`, `Number()`, `String()`, `Boolean()`) помогает избежать ошибок и делает код более понятным.
*   Всегда учитывайте приведение типов при работе с данными, полученными из форм или других внешних источников.



## Интерактивный пример

<Sandpack
  template="vanilla"
  files={{
    "/index.html": `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Приведение типов (Coercion) в JavaScript</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div class="container">
    <h1>Приведение типов (Coercion)</h1>

    <div class="example">
      <h2>Сложение строки и числа</h2>
      <input type="text" id="stringInput" value="10">
      <input type="number" id="numberInput" value="5">
      <button id="addButton">Сложить</button>
      <p id="additionResult">Результат: </p>
    </div>

    <div class="example">
      <h2>Вычитание строки и числа</h2>
      <input type="text" id="stringInput2" value="20">
      <input type="number" id="numberInput2" value="7">
      <button id="subtractButton">Вычесть</button>
      <p id="subtractionResult">Результат: </p>
    </div>

    <div class="example">
      <h2>Сравнение == и ===</h2>
      <input type="text" id="compareInput1" value="5">
      <input type="number" id="compareInput2" value="5">
      <button id="compareButton">Сравнить</button>
      <p id="comparisonResult">Результат (==): </p>
      <p id="strictComparisonResult">Результат (===): </p>
    </div>

    <div class="example">
      <h2>Проверка Truthy/Falsy</h2>
      <input type="text" id="truthyFalsyInput" value="">
      <button id="truthyFalsyButton">Проверить</button>
      <p id="truthyFalsyResult">Результат: </p>
    </div>
  </div>

  <script src="/index.js"><\/script>
</body>
</html>`,
    "/styles.css": `body {
  font-family: sans-serif;
  background-color: #222;
  color: #eee;
  padding: 20px;
}

.container {
  max-width: 800px;
  margin: 0 auto;
}

.example {
  margin-bottom: 20px;
  padding: 15px;
  border: 1px solid #555;
  border-radius: 5px;
}

input[type="text"],
input[type="number"] {
  padding: 8px;
  margin-right: 10px;
  border: 1px solid #777;
  background-color: #333;
  color: #eee;
  border-radius: 3px;
}

button {
  padding: 8px 15px;
  background-color: #4CAF50;
  color: white;
  border: none;
  border-radius: 3px;
  cursor: pointer;
}

button:hover {
  background-color: #3e8e41;
}

p {
  margin-top: 10px;
}`,
    "/index.js": `// Сложение строки и числа
const stringInput = document.getElementById('stringInput');
const numberInput = document.getElementById('numberInput');
const addButton = document.getElementById('addButton');
const additionResult = document.getElementById('additionResult');

addButton.addEventListener('click', () => {
  const stringValue = stringInput.value;
  const numberValue = parseFloat(numberInput.value); // Явное приведение к числу для корректного сложения
  const result = stringValue + numberValue; // JavaScript приводит число к строке
  additionResult.textContent = \`Результат: \${'}result'}\`;
});

// Вычитание строки и числа
const stringInput2 = document.getElementById('stringInput2');
const numberInput2 = document.getElementById('numberInput2');
const subtractButton = document.getElementById('subtractButton');
const subtractionResult = document.getElementById('subtractionResult');

subtractButton.addEventListener('click', () => {
  const stringValue = stringInput2.value;
  const numberValue = parseFloat(numberInput2.value); // Явное приведение к числу для корректного вычитания
  const result = stringValue - numberValue; // JavaScript приводит строку к числу
  subtractionResult.textContent = \`Результат: \${'}result'}\`;
});

// Сравнение == и ===
const compareInput1 = document.getElementById('compareInput1');
const compareInput2 = document.getElementById('compareInput2');
const compareButton = document.getElementById('compareButton');
const comparisonResult = document.getElementById('comparisonResult');
const strictComparisonResult = document.getElementById('strictComparisonResult');

compareButton.addEventListener('click', () => {
  const value1 = compareInput1.value;
  const value2 = parseFloat(compareInput2.value); // Явное приведение к числу для демонстрации сравнения

  comparisonResult.textContent = \`Результат (==): \${'}value1 == value2'}\`; // Нестрогое сравнение
  strictComparisonResult.textContent = \`Результат (===): \${'}value1 === value2'}\`; // Строгое сравнение
});

// Проверка Truthy/Falsy
const truthyFalsyInput = document.getElementById('truthyFalsyInput');
const truthyFalsyButton = document.getElementById('truthyFalsyButton');
const truthyFalsyResult = document.getElementById('truthyFalsyResult');

truthyFalsyButton.addEventListener('click', () => {
  const inputValue = truthyFalsyInput.value;
  const isTruthy = Boolean(inputValue); // Явное приведение к булеву типу
  truthyFalsyResult.textContent = \`Результат: \${'}isTruthy'}\`;
});
`
  }}
  options={{
    showNavigator: false,
    showLineNumbers: true,
    editorHeight: 400
  }}
/>

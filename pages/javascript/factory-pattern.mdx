import { Sandpack } from '@codesandbox/sandpack-react'

# Ğ¤Ğ°Ğ±Ñ€Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ (Factory Pattern)

Ğ¤Ğ°Ğ±Ñ€Ğ¸ĞºĞ° â€” Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ¸Ğ»Ğ¸ Ğ¼ĞµÑ‚Ğ¾Ğ´, ÑĞ¾Ğ·Ğ´Ğ°ÑÑ‰Ğ¸Ğ¹ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ñ‹ Ğ±ĞµĞ· ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ¸Ñ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ»Ğ°ÑÑĞ°. Ğ’Ğ¼ĞµÑÑ‚Ğ¾ `new SomeClass()` Ğ²Ñ‹ Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚Ğµ `createSomething()` Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚Ğµ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹Ğ¹ Ğ¾Ğ±ÑŠĞµĞºÑ‚. Ğ¤Ğ°Ğ±Ñ€Ğ¸ĞºĞ¸ Ğ´Ğ°ÑÑ‚ Ğ³Ğ¸Ğ±ĞºĞ¾ÑÑ‚ÑŒ: Ğ¾Ğ´Ğ¸Ğ½ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ â€” Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸.

## Ğ¤Ğ°Ğ±Ñ€Ğ¸Ñ‡Ğ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ vs ĞšĞ¾Ğ½ÑÑ‚Ñ€ÑƒĞºÑ‚Ğ¾Ñ€

```javascript
// ĞšĞ¾Ğ½ÑÑ‚Ñ€ÑƒĞºÑ‚Ğ¾Ñ€ â€” Ğ½ÑƒĞ¶ĞµĞ½ new, this, prototype
function UserConstructor(name, role) {
  this.name = name
  this.role = role
  this.greet = function() { return `ĞŸÑ€Ğ¸Ğ²ĞµÑ‚, Ñ ${this.name}!` }
}
const u1 = new UserConstructor('ĞĞ»ĞµĞºÑĞµĞ¹', 'admin')

// Ğ¤Ğ°Ğ±Ñ€Ğ¸Ñ‡Ğ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ â€” Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ¾Ğ±ÑŠĞµĞºÑ‚
function createUser(name, role) {
  return {
    name,
    role,
    greet() { return `ĞŸÑ€Ğ¸Ğ²ĞµÑ‚, Ñ ${name}!` },
    isAdmin() { return role === 'admin' },
  }
}
const u2 = createUser('ĞĞ»ĞµĞºÑĞµĞ¹', 'admin')

// ĞĞ±Ğ° Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‚, Ğ½Ğ¾ Ñ„Ğ°Ğ±Ñ€Ğ¸ĞºĞ°:
// âœ… ĞĞµ Ğ½ÑƒĞ¶ĞµĞ½ new
// âœ… Ğ›Ñ‘Ğ³ĞºĞ¸Ğ¹ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ñ‚Ğ¸Ğ¿Ğ¾Ğ² Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ¾Ğ²
// âœ… ĞĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼ Ñ this
// âœ… ĞĞ°ÑÑ‚Ğ¾ÑÑ‰Ğ°Ñ Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ğ¾ÑÑ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ· Ğ·Ğ°Ğ¼Ñ‹ĞºĞ°Ğ½Ğ¸Ğµ
```

## Ğ¤Ğ°Ğ±Ñ€Ğ¸ĞºĞ° Ñ Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğ¼ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸ĞµĞ¼

```javascript
function createCounter(initial = 0, { min = -Infinity, max = Infinity } = {}) {
  let count = initial

  const clamp = (val) => Math.min(Math.max(val, min), max)

  return {
    increment(by = 1) { count = clamp(count + by); return this },
    decrement(by = 1) { count = clamp(count - by); return this },
    reset() { count = initial; return this },
    get value() { return count },
    toString() { return `Counter(${count})` },
  }
}

const c = createCounter(0, { min: 0, max: 10 })
c.increment(5).increment(3).increment(5) // Ğ·Ğ°Ğ¶Ğ°Ñ‚Ğ¾ Ğ½Ğ° 10
console.log(c.value) // 10

const unlimited = createCounter(100)
unlimited.decrement(150)
console.log(unlimited.value) // -50
```

## Abstract Factory â€” ÑĞµĞ¼ĞµĞ¹ÑÑ‚Ğ²Ğ¾ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ¾Ğ²

ĞĞ±ÑÑ‚Ñ€Ğ°ĞºÑ‚Ğ½Ğ°Ñ Ñ„Ğ°Ğ±Ñ€Ğ¸ĞºĞ° ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ **ÑĞµĞ¼ĞµĞ¹ÑÑ‚Ğ²Ğ° ÑĞ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ¾Ğ²**:

```javascript
// ĞĞ±ÑÑ‚Ñ€Ğ°ĞºÑ‚Ğ½Ğ°Ñ Ñ„Ğ°Ğ±Ñ€Ğ¸ĞºĞ° UI-ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²
function createTheme(variant) {
  const themes = {
    dark: {
      button: () => ({
        render: (text) => `<button style="background:#1a1a2e;color:#e0e0ff">${text}</button>`
      }),
      input: () => ({
        render: (placeholder) => `<input style="background:#16213e;color:#e0e0ff" placeholder="${placeholder}">`
      }),
      modal: () => ({
        render: (content) => `<div style="background:#0f3460;color:white">${content}</div>`
      }),
    },
    light: {
      button: () => ({
        render: (text) => `<button style="background:#4361ee;color:white">${text}</button>`
      }),
      input: () => ({
        render: (placeholder) => `<input style="background:#white;border:1px solid #4361ee" placeholder="${placeholder}">`
      }),
      modal: () => ({
        render: (content) => `<div style="background:white;border:1px solid #4361ee">${content}</div>`
      }),
    }
  }

  const theme = themes[variant]
  if (!theme) throw new Error(`ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ°Ñ Ñ‚ĞµĞ¼Ğ°: ${variant}`)

  return {
    createButton: theme.button,
    createInput: theme.input,
    createModal: theme.modal,
  }
}

// Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ñ„Ğ°Ğ±Ñ€Ğ¸ĞºÑƒ â€” Ğ½Ğµ Ğ·Ğ½Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¾ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğµ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
function renderForm(factory) {
  const button = factory.createButton()
  const input = factory.createInput()
  return input.render('Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¸Ğ¼Ñ') + button.render('ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ')
}

console.log(renderForm(createTheme('dark')))
console.log(renderForm(createTheme('light')))
```

## Factory Method Ğ² ĞºĞ»Ğ°ÑÑĞ°Ñ…

```javascript
class Transport {
  constructor(speed, fuel) {
    this.speed = speed
    this.fuel = fuel
  }

  describe() {
    return `${this.constructor.name}: ${this.speed}ĞºĞ¼/Ñ‡, Ñ‚Ğ¾Ğ¿Ğ»Ğ¸Ğ²Ğ¾: ${this.fuel}`
  }

  // Ğ¤Ğ°Ğ±Ñ€Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ğ¼ĞµÑ‚Ğ¾Ğ´
  static create(type) {
    const types = {
      car:   () => new Car(120, 'Ğ±ĞµĞ½Ğ·Ğ¸Ğ½'),
      bike:  () => new Bike(30, 'Ğ¼Ñ‹ÑˆĞµÑ‡Ğ½Ğ°Ñ ÑĞ¸Ğ»Ğ°'),
      plane: () => new Plane(900, 'ĞºĞµÑ€Ğ¾ÑĞ¸Ğ½'),
    }
    const factory = types[type]
    if (!factory) throw new Error(`ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ğ¹ Ñ‚Ğ¸Ğ¿: ${type}`)
    return factory()
  }
}

class Car extends Transport {
  honk() { return 'Ğ‘Ğ¸Ğ¿!' }
}

class Bike extends Transport {
  ring() { return 'Ğ”Ğ·Ñ‹Ğ½ÑŒ!' }
}

class Plane extends Transport {
  takeoff() { return 'Ğ’Ğ·Ğ»ĞµÑ‚Ğ°ĞµĞ¼!' }
}

const car = Transport.create('car')
const bike = Transport.create('bike')
const plane = Transport.create('plane')

console.log(car.describe())   // Car: 120ĞºĞ¼/Ñ‡, Ñ‚Ğ¾Ğ¿Ğ»Ğ¸Ğ²Ğ¾: Ğ±ĞµĞ½Ğ·Ğ¸Ğ½
console.log(bike.describe())  // Bike: 30ĞºĞ¼/Ñ‡, Ñ‚Ğ¾Ğ¿Ğ»Ğ¸Ğ²Ğ¾: Ğ¼Ñ‹ÑˆĞµÑ‡Ğ½Ğ°Ñ ÑĞ¸Ğ»Ğ°
console.log(plane.takeoff())  // Ğ’Ğ·Ğ»ĞµÑ‚Ğ°ĞµĞ¼!
```

## Registry Pattern â€” Ñ€ĞµĞµÑÑ‚Ñ€ Ñ„Ğ°Ğ±Ñ€Ğ¸Ğº

```javascript
class PluginRegistry {
  #factories = new Map()

  register(name, factory) {
    this.#factories.set(name, factory)
    return this
  }

  create(name, ...args) {
    const factory = this.#factories.get(name)
    if (!factory) throw new Error(`ĞŸĞ»Ğ°Ğ³Ğ¸Ğ½ "${name}" Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½`)
    return factory(...args)
  }

  list() { return [...this.#factories.keys()] }
}

const registry = new PluginRegistry()

registry
  .register('json', (data) => ({
    parse: (str) => JSON.parse(str),
    stringify: (obj) => JSON.stringify(obj, null, 2),
  }))
  .register('csv', (delimiter = ',') => ({
    parse: (str) => str.split('\n').map(row => row.split(delimiter)),
    stringify: (data) => data.map(row => row.join(delimiter)).join('\n'),
  }))

const jsonParser = registry.create('json')
console.log(jsonParser.parse('{"name":"Ğ¯ÑˆĞ°"}')) // { name: 'Ğ¯ÑˆĞ°' }

const csvParser = registry.create('csv', ';')
console.log(csvParser.stringify([['a', 'b'], ['1', '2']])) // a;b\n1;2
```

## Ğ˜Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€

<Sandpack
  template="vanilla"
  files={{
    "/index.html": `<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Factory Pattern</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <h2>Factory Pattern â€” Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ĞµĞ¹</h2>
  <div class="controls">
    <select id="type">
      <option value="warrior">âš”ï¸ Ğ’Ğ¾Ğ¸Ğ½</option>
      <option value="mage">ğŸ§™ ĞœĞ°Ğ³</option>
      <option value="archer">ğŸ¹ Ğ›ÑƒÑ‡Ğ½Ğ¸Ğº</option>
    </select>
    <input id="name" placeholder="Ğ˜Ğ¼Ñ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶Ğ°" value="Ğ“ĞµÑ€Ğ¾Ğ¹">
    <button id="create">Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ</button>
  </div>
  <div id="characters"></div>
  <script src="/index.js"></script>
</body>
</html>`,
    "/styles.css": `body { font-family: sans-serif; background: #1e1e2e; color: #cdd6f4; padding: 20px; }
h2 { color: #89b4fa; }
.controls { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 16px; }
select, input { background: #313244; border: 1px solid #45475a; color: #cdd6f4; padding: 8px 12px; border-radius: 6px; }
button { background: #89b4fa; color: #1e1e2e; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: bold; }
.character { background: #313244; border-radius: 8px; padding: 16px; margin: 8px 0; display: flex; gap: 16px; align-items: center; border-left: 4px solid #89b4fa; }
.icon { font-size: 36px; }
.stats span { display: inline-block; background: #45475a; border-radius: 4px; padding: 2px 8px; margin: 2px; font-size: 13px; font-family: monospace; }`,
    "/index.js": `function createCharacter(type, name) {
  const configs = {
    warrior: {
      icon: 'âš”ï¸',
      hp: 150, mp: 30, attack: 25, defense: 20,
      skills: ['Ğ£Ğ´Ğ°Ñ€ Ñ‰Ğ¸Ñ‚Ğ¾Ğ¼', 'Ğ‘Ğ¾ĞµĞ²Ğ¾Ğ¹ ĞºĞ»Ğ¸Ñ‡'],
      color: '#f38ba8',
    },
    mage: {
      icon: 'ğŸ§™',
      hp: 60, mp: 200, attack: 45, defense: 5,
      skills: ['ĞĞ³Ğ½ĞµĞ½Ğ½Ñ‹Ğ¹ ÑˆĞ°Ñ€', 'Ğ—Ğ°Ğ¼Ğ¾Ñ€Ğ¾Ğ·ĞºĞ°', 'Ğ¢ĞµĞ»ĞµĞ¿Ğ¾Ñ€Ñ‚'],
      color: '#89b4fa',
    },
    archer: {
      icon: 'ğŸ¹',
      hp: 90, mp: 80, attack: 35, defense: 10,
      skills: ['ĞœĞµÑ‚ĞºĞ¸Ğ¹ Ğ²Ñ‹ÑÑ‚Ñ€ĞµĞ»', 'Ğ”Ğ¾Ğ¶Ğ´ÑŒ ÑÑ‚Ñ€ĞµĞ»'],
      color: '#a6e3a1',
    },
  }

  const config = configs[type]
  if (!config) throw new Error('ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ğ¹ Ñ‚Ğ¸Ğ¿')
  
  return { name, type, ...config }
}

document.getElementById('create').addEventListener('click', () => {
  const type = document.getElementById('type').value
  const name = document.getElementById('name').value || 'Ğ‘ĞµĞ·Ñ‹Ğ¼ÑĞ½Ğ½Ñ‹Ğ¹'
  const char = createCharacter(type, name)
  
  const el = document.createElement('div')
  el.className = 'character'
  el.style.borderColor = char.color
  el.innerHTML = \`
    <div class="icon">\${char.icon}</div>
    <div>
      <strong style="color:\${char.color}">\${char.name}</strong> (\${char.type})<br>
      <div class="stats">
        <span>â¤ï¸ \${char.hp}</span>
        <span>ğŸ’« \${char.mp}</span>
        <span>âš”ï¸ \${char.attack}</span>
        <span>ğŸ›¡ï¸ \${char.defense}</span>
      </div>
      <div style="margin-top:6px">ğŸ¯ \${char.skills.join(', ')}</div>
    </div>
  \`
  document.getElementById('characters').prepend(el)
})
`
  }}
  options={{ showNavigator: false, showLineNumbers: true, editorHeight: 380 }}
/>

## JavaScript: Мозги. Урок 2: Числа – IEEE 754, BigInt, Math


![Иллюстрация к уроку](/lessons/javascript-numbers-math-bigint.png)
В JavaScript числа играют ключевую роль, будь то математические вычисления или работа с данными. В этом уроке мы разберемся с тем, как JavaScript представляет числа, познакомимся с ограничениями и способами их обхода, а также изучим полезные инструменты для работы с числами.

### IEEE 754: Представление чисел с плавающей точкой

JavaScript использует формат IEEE 754 для представления чисел. Это означает, что большинство чисел (включая десятичные дроби) хранятся в памяти компьютера в виде чисел с плавающей точкой двойной точности (64 бита). Это приводит к некоторым особенностям. Например, некоторые десятичные дроби не могут быть представлены точно.

```javascript
console.log(0.1 + 0.2); // Вывод: 0.30000000000000004
```

Это не ошибка JavaScript, а особенность представления чисел с плавающей точкой.  Чтобы избежать проблем, связанных с неточностью, можно использовать методы округления:

```javascript
console.log((0.1 + 0.2).toFixed(1)); // Вывод: "0.3" (строка)
console.log(Math.round((0.1 + 0.2) * 10) / 10); // Вывод: 0.3 (число)
```

`toFixed()` возвращает строку с указанным количеством знаков после запятой.  `Math.round()` округляет число до ближайшего целого.

### BigInt: Работа с большими числами

Когда требуются вычисления с целыми числами, превышающими `Number.MAX_SAFE_INTEGER` (2^53 - 1), на помощь приходит `BigInt`. Это специальный тип данных для представления произвольно больших целых чисел.

```javascript
const largeNumber = 9007199254740991n; // Добавляем "n" в конце
const anotherLargeNumber = BigInt(9007199254740992);

console.log(largeNumber + 1n); // Вывод: 9007199254740992n
console.log(anotherLargeNumber); // Вывод: 9007199254740992n
```

Важно: `BigInt` не совместим с обычными числами. Операции можно проводить только между `BigInt`.

```javascript
// console.log(largeNumber + 1); // Ошибка!
console.log(largeNumber + BigInt(1)); // Правильно
```

### Math: Математические функции

Объект `Math` предоставляет множество полезных математических функций и констант.

```javascript
console.log(Math.PI); // Вывод: 3.141592653589793
console.log(Math.abs(-5)); // Вывод: 5 (абсолютное значение)
console.log(Math.pow(2, 3)); // Вывод: 8 (2 в степени 3)
console.log(Math.sqrt(9)); // Вывод: 3 (квадратный корень)
console.log(Math.random()); // Вывод: случайное число от 0 (включительно) до 1 (исключая 1)
console.log(Math.floor(3.7)); // Вывод: 3 (округление вниз)
console.log(Math.ceil(3.2)); // Вывод: 4 (округление вверх)
```

### Жизненный пример

*   **Финансовые расчеты:** В финансовых приложениях часто требуется высокая точность, поэтому используют библиотеки, работающие с `BigInt` или десятичными числами (например, `decimal.js`) для избежания ошибок округления.
*   **Криптография:** При работе с криптографическими алгоритмами используются очень большие числа, которые обрабатываются с помощью `BigInt`.
*   **Графика:** `Math` используется для вычисления координат, углов, расстояний в играх, визуализациях данных и других графических приложениях.  Например, для вращения элемента вокруг центра используется `Math.sin()` и `Math.cos()`.

### Ключевые моменты

*   JavaScript использует IEEE 754 для представления чисел с плавающей точкой, что может приводить к неточностям.
*   `BigInt` позволяет работать с целыми числами произвольного размера.
*   Объект `Math` предоставляет множество полезных математических функций.
*   Выбирайте подходящий тип данных и методы работы с числами в зависимости от задачи.



## Интерактивный пример

<Sandpack
  template="vanilla"
  files={{
    "/index.html": `<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Числа, Math, BigInt</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div class="container">
    <h1>Числа, Math, BigInt в JavaScript</h1>

    <section id="ieee754">
      <h2>IEEE 754</h2>
      <p>0.1 + 0.2 = <span id="ieee754-result"></span></p>
      <button id="ieee754-button">Вычислить</button>
    </section>

    <section id="bigint">
      <h2>BigInt</h2>
      <label for="bigint-input">Введите большое число:</label>
      <input type="number" id="bigint-input">
      <p>Результат + 1: <span id="bigint-result"></span></p>
    </section>

    <section id="math">
      <h2>Math</h2>
      <p>Случайное число: <span id="math-random"></span></p>
      <button id="math-random-button">Сгенерировать</button>
      <label for="math-power-input">Возвести 2 в степень:</label>
      <input type="number" id="math-power-input">
      <p>2 в степени <span id="math-power-value"></span> = <span id="math-power-result"></span></p>
    </section>
  </div>

  <script src="/index.js"><\/script>
</body>
</html>`,
    "/styles.css": `body {
  font-family: sans-serif;
  background-color: #222;
  color: #eee;
  padding: 20px;
}

.container {
  max-width: 800px;
  margin: 0 auto;
}

section {
  margin-bottom: 20px;
  padding: 10px;
  border: 1px solid #555;
  border-radius: 5px;
}

input[type="number"] {
  background-color: #444;
  color: #eee;
  border: none;
  padding: 5px;
  border-radius: 3px;
}

button {
  background-color: #007bff;
  color: white;
  border: none;
  padding: 5px 10px;
  border-radius: 3px;
  cursor: pointer;
}

button:hover {
  background-color: #0056b3;
}`,
    "/index.js": `// IEEE 754
const ieee754Button = document.getElementById('ieee754-button');
const ieee754Result = document.getElementById('ieee754-result');

ieee754Button.addEventListener('click', () => {
  ieee754Result.textContent = 0.1 + 0.2;
});

// BigInt
const bigintInput = document.getElementById('bigint-input');
const bigintResult = document.getElementById('bigint-result');

bigintInput.addEventListener('input', () => {
  const inputValue = bigintInput.value;
  if (inputValue) {
    const bigIntValue = BigInt(inputValue);
    bigintResult.textContent = bigIntValue + 1n;
  } else {
    bigintResult.textContent = '';
  }
});

// Math
const mathRandomButton = document.getElementById('math-random-button');
const mathRandom = document.getElementById('math-random');
const mathPowerInput = document.getElementById('math-power-input');
const mathPowerResult = document.getElementById('math-power-result');
const mathPowerValue = document.getElementById('math-power-value');

mathRandomButton.addEventListener('click', () => {
  mathRandom.textContent = Math.random();
});

mathPowerInput.addEventListener('input', () => {
  const inputValue = mathPowerInput.value;
  mathPowerValue.textContent = inputValue || 0;
  if (inputValue) {
    mathPowerResult.textContent = Math.pow(2, inputValue);
  } else {
    mathPowerResult.textContent = '';
  }
});`
  }}
  options={{
    showNavigator: false,
    showLineNumbers: true,
    editorHeight: 400
  }}
/>

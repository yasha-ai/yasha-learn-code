## JavaScript: Мозги. Урок: Lookahead & Lookbehind


![Иллюстрация к уроку](/lessons/javascript-lookahead-lookbehind.png)
В этом уроке мы разберем мощные инструменты регулярных выражений JavaScript: Lookahead и Lookbehind. Они позволяют искать совпадения, основываясь на том, что идет *до* или *после* искомого текста, но не включая эти "окрестности" в само совпадение.

### Что такое Lookahead и Lookbehind?

Lookahead и Lookbehind - это "смотри вперед" и "смотри назад" соответственно. Они позволяют проверять, соответствует ли часть строки определенному шаблону, не включая этот шаблон в сам результат поиска. Это называется "zero-width assertions" (утверждения нулевой ширины), потому что они не потребляют символы строки.

Есть два типа:

*   **Positive Lookahead (?=pattern):** Соответствует, если за текущей позицией в строке следует `pattern`.
*   **Negative Lookahead (?!pattern):** Соответствует, если за текущей позицией в строке *не* следует `pattern`.
*   **Positive Lookbehind `(?<=pattern)`:** Соответствует, если перед текущей позицией в строке находится `pattern`.
*   **Negative Lookbehind `(?<!pattern)`:** Соответствует, если перед текущей позицией в строке *не* находится `pattern`.

### Примеры кода

```javascript
// Positive Lookahead: Найти "JavaScript", за которым следует " is awesome"
let str = "JavaScript is awesome. Python is good.";
let regex = /JavaScript(?= is awesome)/;
let result = str.match(regex);

console.log(result); // ["JavaScript", index: 0, input: "JavaScript is awesome. Python is good.", groups: undefined]

// Negative Lookahead: Найти "JavaScript", за которым не следует " is terrible"
str = "JavaScript is awesome. JavaScript is terrible.";
regex = /JavaScript(?! is terrible)/;
result = str.match(regex);

console.log(result); // ["JavaScript", index: 0, input: "JavaScript is awesome. JavaScript is terrible.", groups: undefined]

// Positive Lookbehind: Найти слово, перед которым стоит символ доллара
str = "Цена: $100, $200, 300";
regex = /(?<=\$)(\d+)/g;
result = str.match(regex);

console.log(result); // ["100", "200"]

// Negative Lookbehind: Найти слово, перед которым не стоит символ доллара
str = "Цена: $100, 200, EUR 300";
regex = /(?<!\$)(\d+)/g;
result = str.match(regex);

console.log(result); // ["200", "300"]
```

### Жизненный пример

Lookahead и Lookbehind очень полезны для валидации данных, форматирования текста и парсинга. Например, их можно использовать для:

*   **Валидации паролей:**  Проверка, что пароль содержит определенное количество символов, хотя бы одну цифру и одну заглавную букву.
*   **Форматирования чисел:** Добавление запятых в большие числа (например, 1000000 -> 1,000,000).
*   **Подсветки синтаксиса:** Определение ключевых слов в коде, не затрагивая другие части текста.
*   **Парсинга HTML:** Извлечение данных из HTML-тегов, не включая сами теги в результат.

Например, фреймворки и библиотеки для работы с текстом, такие как Ace Editor или CodeMirror, часто используют Lookahead и Lookbehind для подсветки синтаксиса.

### Ключевые моменты

*   Lookahead и Lookbehind - это zero-width assertions: они не "потребляют" символы.
*   Используйте Positive Lookahead `(?=pattern)` для поиска совпадений, за которыми следует `pattern`.
*   Используйте Negative Lookahead `(?!pattern)` для поиска совпадений, за которыми *не* следует `pattern`.
*   Используйте Positive Lookbehind `(?<=pattern)` для поиска совпадений, перед которыми находится `pattern`.
*   Используйте Negative Lookbehind `(?<!pattern)` для поиска совпадений, перед которыми *не* находится `pattern`.
*   Они полезны для валидации, форматирования и парсинга данных.



## Интерактивный пример

<Sandpack
  template="vanilla"
  files={{
    "/index.html": `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lookahead & Lookbehind Demo</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div class="container">
    <h1>Lookahead & Lookbehind Demo</h1>

    <div class="input-area">
      <label for="inputString">Текст:</label>
      <input type="text" id="inputString" value="JavaScript is awesome. Python is good. Цена: $100, 200, EUR 300">
    </div>

    <div class="regex-area">
      <label for="regexPattern">Регулярное выражение:</label>
      <input type="text" id="regexPattern" value="(?<=\\$)(\\d+)" >
      <select id="regexType">
        <option value="positiveLookahead">Positive Lookahead</option>
        <option value="negativeLookahead">Negative Lookahead</option>
        <option value="positiveLookbehind" selected>Positive Lookbehind</option>
        <option value="negativeLookbehind">Negative Lookbehind</option>
      </select>
    </div>

    <button id="runRegex">Выполнить</button>

    <div class="output-area">
      <label for="outputResult">Результат:</label>
      <textarea id="outputResult" readonly></textarea>
    </div>
  </div>

  <script src="/index.js"><\/script>
</body>
</html>`,
    "/styles.css": `body {
  font-family: sans-serif;
  background-color: #222;
  color: #eee;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  margin: 0;
}

.container {
  background-color: #333;
  padding: 20px;
  border-radius: 8px;
  width: 80%;
  max-width: 600px;
}

h1 {
  text-align: center;
  margin-bottom: 20px;
}

.input-area, .regex-area, .output-area {
  margin-bottom: 15px;
}

label {
  display: block;
  margin-bottom: 5px;
}

input[type="text"], textarea, select {
  width: 100%;
  padding: 8px;
  border: 1px solid #555;
  border-radius: 4px;
  background-color: #444;
  color: #eee;
  box-sizing: border-box; /* Important for width: 100% */
}

textarea {
  resize: vertical;
  min-height: 100px;
}

button {
  background-color: #4CAF50;
  color: white;
  padding: 10px 15px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  width: 100%;
}

button:hover {
  background-color: #367c39;
}
`,
    "/index.js": `// Получаем элементы DOM
const inputStringElement = document.getElementById('inputString');
const regexPatternElement = document.getElementById('regexPattern');
const regexTypeElement = document.getElementById('regexType');
const runRegexButton = document.getElementById('runRegex');
const outputResultElement = document.getElementById('outputResult');

// Функция для выполнения регулярного выражения и отображения результата
function runRegex() {
  const inputString = inputStringElement.value;
  const regexPattern = regexPatternElement.value;
  const regexType = regexTypeElement.value;

  try {
    // Создаем регулярное выражение
    const regex = new RegExp(regexPattern, 'g');

    // Выполняем поиск
    const result = inputString.match(regex);

    // Отображаем результат
    outputResultElement.value = result ? result.join(', ') : 'Совпадений не найдено.';
  } catch (error) {
    outputResultElement.value = 'Ошибка в регулярном выражении: ' + error.message;
  }
}

// Добавляем обработчик события на кнопку
runRegexButton.addEventListener('click', runRegex);
`
  }}
  options={{
    showNavigator: false,
    showLineNumbers: true,
    editorHeight: 400
  }}
/>

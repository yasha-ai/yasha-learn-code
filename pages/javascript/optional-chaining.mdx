import { Sandpack } from '@codesandbox/sandpack-react'

## JavaScript: Мозги. Урок: Опциональная цепочка ?.

В JavaScript часто приходится работать с вложенными объектами, и доступ к их свойствам может привести к ошибкам, если какое-то из промежуточных свойств окажется `null` или `undefined`. Опциональная цепочка (`?.`) позволяет безопасно получать доступ к свойствам вложенных объектов, избегая ошибок.

### Что такое опциональная цепочка?

Опциональная цепочка – это синтаксическая конструкция в JavaScript, которая позволяет читать значение свойства, расположенного глубоко внутри цепочки связанных объектов, не проверяя явно каждое звено цепочки на наличие `null` или `undefined`. Если какое-либо звено в цепочке окажется `null` или `undefined`, выражение немедленно вернет `undefined`, не вызывая ошибку.

### Примеры кода

```javascript
// Пример 1: Объект пользователя
const user = {
  profile: {
    address: {
      street: 'Main Street',
    },
  },
};

// Доступ к улице через опциональную цепочку
const street = user?.profile?.address?.street; // 'Main Street'

console.log(street);

// Пример 2: Объект без address
const userWithoutAddress = {
  profile: {},
};

// Попытка доступа к улице через опциональную цепочку
const streetWithoutAddress = userWithoutAddress?.profile?.address?.street; // undefined

console.log(streetWithoutAddress);

// Пример 3: Использование с функциями
const obj = {
  func: function() {
    return 'Hello';
  }
};

const result = obj?.func?.(); // 'Hello'

console.log(result);

const objWithoutFunc = {};
const resultWithoutFunc = objWithoutFunc?.func?.(); // undefined

console.log(resultWithoutFunc);

// Пример 4: Доступ к элементам массива
const arr = [1, 2, 3];
const element = arr?.[10]; // undefined

console.log(element);
```

### Жизненный пример

Представьте себе веб-приложение, которое отображает информацию о пользователе, полученную с сервера. Данные с сервера могут быть неполными, и некоторые поля могут отсутствовать.

```javascript
// Предположим, мы получили такой объект с сервера
const userData = {
  name: 'John Doe',
  address: {
    city: 'New York',
  },
  // phone: '123-456-7890' // Пользователь не указал телефон
};

// Без опциональной цепочки:
// const phone = userData.phone.number; // Ошибка! Cannot read properties of undefined (reading 'number')

// С опциональной цепочкой:
const phone = userData?.phone?.number; // undefined

if (phone) {
  console.log('Телефон пользователя:', phone);
} else {
  console.log('Телефон пользователя не указан.');
}

// В React компонентах часто используют опциональную цепочку для доступа к данным, полученным через props
// или из Redux store.

// Пример (псевдокод React компонента):
/*
function UserProfile({ user }) {
  return (
    <div>
      <h1>{user?.name}</h1>
      <p>Город: {user?.address?.city}</p>
      <p>Телефон: {user?.phone || 'Не указан'}</p>
    </div>
  );
}
*/
```

В фреймворках, таких как React, Angular или Vue.js, опциональная цепочка широко используется для безопасного доступа к данным, которые могут быть получены асинхронно или могут отсутствовать. Это помогает избежать ошибок и сделать код более надежным.

### Ключевые моменты

*   Опциональная цепочка (`?.`) упрощает доступ к свойствам вложенных объектов.
*   Если какое-либо звено в цепочке `null` или `undefined`, возвращается `undefined`.
*   Помогает избежать ошибок `TypeError: Cannot read properties of undefined (reading '...')`.
*   Можно использовать с вызовами функций и доступом к элементам массива.
*   Широко применяется в современных JavaScript фреймворках и библиотеках.

### Практика

Попробуйте примеры в интерактивном редакторе:

<Sandpack
  template="vanilla"
  files={{
    '/index.js': `// Создаем карточки пользователей с разной полнотой данных
var users = [
  {
    name: 'Alice',
    profile: {
      address: {
        city: 'Moscow',
        street: 'Tverskaya'
      },
      phone: {
        mobile: '+7-999-123-45-67'
      }
    }
  },
  {
    name: 'Bob',
    profile: {
      address: {
        city: 'Saint Petersburg'
        // street отсутствует
      }
      // phone отсутствует
    }
  },
  {
    name: 'Charlie',
    profile: null  // Профиль не заполнен
  }
];

var app = document.getElementById('app');

users.forEach(function(user) {
  var card = document.createElement('div');
  card.className = 'user-card';

  // Используем проверки && для безопасного доступа (аналог ?.)
  var city = (user && user.profile && user.profile.address && user.profile.address.city) || 'Не указан';
  var street = (user && user.profile && user.profile.address && user.profile.address.street) || 'Не указана';
  var phone = (user && user.profile && user.profile.phone && user.profile.phone.mobile) || 'Не указан';

  card.innerHTML =
    '<h3>' + user.name + '</h3>' +
    '<p>Город: ' + city + '</p>' +
    '<p>Улица: ' + street + '</p>' +
    '<p>Телефон: ' + phone + '</p>';

  app.appendChild(card);

  console.log(user.name + ':', {
    city: user && user.profile && user.profile.address && user.profile.address.city,
    street: user && user.profile && user.profile.address && user.profile.address.street,
    phone: user && user.profile && user.profile.phone && user.profile.phone.mobile
  });
});

// Демонстрация опасности без проверок
var demo = document.createElement('div');
demo.className = 'demo';
demo.innerHTML = '<h3>Без проверок произошла бы ошибка!</h3>';

try {
  // Это вызовет ошибку для Charlie (profile === null)
  var result = users[2].profile.address.city;
} catch (error) {
  demo.innerHTML += '<p class="error">Ошибка: ' + error.message + '</p>';
  console.error('Ошибка без проверок: ', error.message);
}

app.appendChild(demo);
`,
    '/index.html': `<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div id="app"></div>
  <script src="index.js"></script>
</body>
</html>`,
    '/styles.css': `body {
  font-family: system-ui, -apple-system, sans-serif;
  padding: 20px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  margin: 0;
}

#app {
  max-width: 600px;
  margin: 0 auto;
}

.user-card {
  background: white;
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 16px;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.user-card h3 {
  margin: 0 0 12px 0;
  color: #667eea;
  font-size: 1.3em;
}

.user-card p {
  margin: 8px 0;
  color: #555;
}

.demo {
  background: #fff3cd;
  border: 2px solid #ffc107;
  border-radius: 8px;
  padding: 16px;
  margin-top: 20px;
}

.demo h3 {
  margin: 0 0 10px 0;
  color: #856404;
}

.error {
  color: #d32f2f;
  font-weight: bold;
  background: #ffebee;
  padding: 8px;
  border-radius: 4px;
}`
  }}
/>

```markdown
# JavaScript: Мозги. Урок: map, filter, reduce детально


![Иллюстрация к уроку](/lessons/javascript-map-filter-reduce-deep.png)
Добро пожаловать! Сегодня мы разберем три мощных метода массивов в JavaScript: `map`, `filter` и `reduce`. Они позволяют элегантно и эффективно преобразовывать и обрабатывать данные.

## map: Преобразование каждого элемента

Метод `map` создает *новый* массив, применяя функцию к *каждому* элементу исходного массива. Представьте, что у вас есть конвейер, где каждый элемент массива проходит через станцию обработки (вашу функцию) и выходит уже измененным.

```javascript
const numbers = [1, 2, 3, 4, 5];

// Увеличиваем каждый элемент массива на 2
const doubledNumbers = numbers.map(function(number) {
  return number * 2;
});

console.log(doubledNumbers); // Output: [2, 4, 6, 8, 10]
console.log(numbers); // Output: [1, 2, 3, 4, 5] (Исходный массив не изменился!)
```

Здесь `numbers.map(...)` применяет анонимную функцию `function(number) { return number * 2; }` к каждому числу в массиве `numbers`. Результат - новый массив `doubledNumbers` с удвоенными значениями.  Обратите внимание, что исходный массив `numbers` остался без изменений.

## filter: Отбор нужных элементов

Метод `filter` создает *новый* массив, содержащий только те элементы исходного массива, для которых функция-условие вернула `true`.  Это как сито, которое пропускает только то, что соответствует критериям.

```javascript
const numbers = [1, 2, 3, 4, 5, 6];

// Отбираем только четные числа
const evenNumbers = numbers.filter(function(number) {
  return number % 2 === 0;
});

console.log(evenNumbers); // Output: [2, 4, 6]
console.log(numbers); // Output: [1, 2, 3, 4, 5, 6] (Исходный массив не изменился!)
```

В этом примере `numbers.filter(...)` применяет функцию `function(number) { return number % 2 === 0; }` к каждому числу.  Если число четное (остаток от деления на 2 равен 0), то функция возвращает `true`, и число попадает в новый массив `evenNumbers`.

## reduce: Сведение массива к одному значению

Метод `reduce` сводит массив к одному значению (числу, строке, объекту и т.д.), последовательно применяя функцию к каждому элементу и аккумулятору (значению, полученному на предыдущем шаге). Это как калькулятор, который последовательно применяет операцию к числам и накапливает результат.

```javascript
const numbers = [1, 2, 3, 4, 5];

// Суммируем все элементы массива
const sum = numbers.reduce(function(accumulator, currentValue) {
  return accumulator + currentValue;
}, 0); // 0 - это начальное значение аккумулятора

console.log(sum); // Output: 15
console.log(numbers); // Output: [1, 2, 3, 4, 5] (Исходный массив не изменился!)
```

Здесь `numbers.reduce(...)` применяет функцию `function(accumulator, currentValue) { return accumulator + currentValue; }`.  `accumulator` - это текущая сумма (начинается с 0), а `currentValue` - текущий элемент массива. Функция возвращает сумму `accumulator` и `currentValue`, которая становится новым значением `accumulator` для следующей итерации.

## Жизненный пример

Представьте, что у вас есть список товаров в интернет-магазине.

*   **map**: Вы можете использовать `map` для отображения цены каждого товара в определенной валюте.
*   **filter**: Вы можете использовать `filter` для отображения только товаров, находящихся в наличии.
*   **reduce**: Вы можете использовать `reduce` для вычисления общей стоимости всех товаров в корзине.

В React, Vue и Angular эти методы активно используются для обработки данных, полученных с сервера, для рендеринга списков, фильтрации результатов поиска и агрегации данных. Например, в React:

```javascript
// Пример в React (псевдокод)
const products = [/* ... массив объектов продуктов ... */];

const availableProducts = products.filter(product => product.inStock);
const productNames = availableProducts.map(product => product.name);

return (
  <ul>
    {productNames.map(name => <li key={name}>{name}</li>)}
  </ul>
);
```

## Ключевые моменты

*   `map`, `filter` и `reduce` не изменяют исходный массив.
*   `map` создает новый массив с преобразованными элементами.
*   `filter` создает новый массив с отфильтрованными элементами.
*   `reduce` сводит массив к одному значению.
*   Эти методы часто используются вместе для решения сложных задач обработки данных.
*   Важно понимать, что каждый метод возвращает.
```


## Интерактивный пример

<Sandpack
  template="vanilla"
  files={{
    "/index.html": `<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Map, Filter, Reduce</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div class="container">
    <h1>Map, Filter, Reduce</h1>

    <label for="numbers">Введите числа через запятую:</label>
    <input type="text" id="numbers" value="1,2,3,4,5,6,7,8,9,10">

    <div class="buttons">
      <button id="mapButton">Удвоить (Map)</button>
      <button id="filterButton">Четные (Filter)</button>
      <button id="reduceButton">Сумма (Reduce)</button>
    </div>

    <div class="results">
      <p>Исходный массив: <span id="original"></span></p>
      <p>Результат Map: <span id="mapResult"></span></p>
      <p>Результат Filter: <span id="filterResult"></span></p>
      <p>Результат Reduce: <span id="reduceResult"></span></p>
    </div>
  </div>

  <script src="/index.js"><\/script>
</body>
</html>`,
    "/styles.css": `body {
  font-family: sans-serif;
  background-color: #222;
  color: #eee;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  margin: 0;
}

.container {
  background-color: #333;
  padding: 20px;
  border-radius: 8px;
  width: 80%;
  max-width: 600px;
}

h1 {
  text-align: center;
  color: #ddd;
}

label {
  display: block;
  margin-bottom: 5px;
  color: #ccc;
}

input[type="text"] {
  width: 100%;
  padding: 8px;
  margin-bottom: 15px;
  border: 1px solid #555;
  background-color: #444;
  color: #eee;
  border-radius: 4px;
}

.buttons {
  display: flex;
  justify-content: space-around;
  margin-bottom: 20px;
}

button {
  background-color: #555;
  color: #fff;
  border: none;
  padding: 10px 20px;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.3s;
}

button:hover {
  background-color: #777;
}

.results p {
  margin: 5px 0;
  color: #bbb;
}

.results span {
  font-weight: bold;
  color: #eee;
}`,
    "/index.js": `// Получаем элементы DOM
const numbersInput = document.getElementById('numbers');
const mapButton = document.getElementById('mapButton');
const filterButton = document.getElementById('filterButton');
const reduceButton = document.getElementById('reduceButton');
const originalSpan = document.getElementById('original');
const mapResultSpan = document.getElementById('mapResult');
const filterResultSpan = document.getElementById('filterResult');
const reduceResultSpan = document.getElementById('reduceResult');

// Функция для преобразования строки в массив чисел
function getNumbersArray() {
  const numbersString = numbersInput.value;
  return numbersString.split(',').map(Number).filter(num => !isNaN(num));
}

// Обработчик для кнопки Map
mapButton.addEventListener('click', () => {
  const numbers = getNumbersArray();
  originalSpan.textContent = JSON.stringify(numbers); // Отображаем исходный массив
  const doubledNumbers = numbers.map(number => number * 2);
  mapResultSpan.textContent = JSON.stringify(doubledNumbers); // Отображаем результат
});

// Обработчик для кнопки Filter
filterButton.addEventListener('click', () => {
  const numbers = getNumbersArray();
  originalSpan.textContent = JSON.stringify(numbers); // Отображаем исходный массив
  const evenNumbers = numbers.filter(number => number % 2 === 0);
  filterResultSpan.textContent = JSON.stringify(evenNumbers); // Отображаем результат
});

// Обработчик для кнопки Reduce
reduceButton.addEventListener('click', () => {
  const numbers = getNumbersArray();
  originalSpan.textContent = JSON.stringify(numbers); // Отображаем исходный массив
  const sum = numbers.reduce((accumulator, currentValue) => accumulator + currentValue, 0);
  reduceResultSpan.textContent = sum; // Отображаем результат
});`
  }}
  options={{
    showNavigator: false,
    showLineNumbers: true,
    editorHeight: 400
  }}
/>

## JavaScript: Мозги. Урок: Typed Arrays


![Иллюстрация к уроку](/lessons/javascript-typed-arrays.png)
Typed Arrays – это мощный инструмент в JavaScript для работы с бинарными данными. Они позволяют эффективно хранить и манипулировать массивами чисел определенных типов, что особенно полезно при работе с графикой, аудио и другими ресурсоемкими задачами. Давайте разберемся, как они работают.

### Что такое Typed Arrays?

В отличие от обычных JavaScript массивов, которые могут содержать элементы разных типов, Typed Arrays хранят однородные данные определенного числового типа (например, целые числа или числа с плавающей точкой). Это делает их более эффективными с точки зрения использования памяти и скорости операций.

Представьте себе обычный JavaScript массив как коробку, в которую можно положить что угодно - число, строку, объект. Typed Array – это как коробка с ячейками, каждая из которых предназначена для хранения только одного типа данных, например, только целых чисел.

### Создание Typed Arrays

Существует несколько типов Typed Arrays, каждый из которых предназначен для хранения чисел определенного размера и типа:

*   `Int8Array`: 8-битные целые числа со знаком.
*   `Uint8Array`: 8-битные целые числа без знака.
*   `Int16Array`: 16-битные целые числа со знаком.
*   `Uint16Array`: 16-битные целые числа без знака.
*   `Int32Array`: 32-битные целые числа со знаком.
*   `Uint32Array`: 32-битные целые числа без знака.
*   `Float32Array`: 32-битные числа с плавающей точкой.
*   `Float64Array`: 64-битные числа с плавающей точкой.

Чтобы создать Typed Array, нужно сначала создать `ArrayBuffer`, который представляет собой блок памяти, в котором будут храниться данные. Затем создается Typed Array "представление" (view) этого буфера.

```javascript
// Создаем ArrayBuffer размером 16 байт
const buffer = new ArrayBuffer(16);

// Создаем Int32Array представление буфера
const int32View = new Int32Array(buffer);

// Теперь мы можем работать с int32View как с массивом 32-битных целых чисел
int32View[0] = 10;
int32View[1] = 20;
int32View[2] = 30;
int32View[3] = 40;

console.log(int32View); // Вывод: Int32Array [ 10, 20, 30, 40 ]

// Можно создавать Typed Arrays сразу с заданным размером
const uint8View = new Uint8Array(8); // 8 элементов типа Uint8

uint8View[0] = 255;
uint8View[1] = 128;

console.log(uint8View); // Вывод: Uint8Array [ 255, 128, 0, 0, 0, 0, 0, 0 ]
```

### Практические примеры

```javascript
// Создание Typed Array из обычного массива
const numbers = [1, 2, 3, 4, 5];
const float32Array = new Float32Array(numbers);

console.log(float32Array); // Вывод: Float32Array [ 1, 2, 3, 4, 5 ]

// Изменение значения элемента
float32Array[0] = 3.14;
console.log(float32Array); // Вывод: Float32Array [ 3.14, 2, 3, 4, 5 ]

// Получение длины Typed Array
console.log(float32Array.length); // Вывод: 5
```

### Жизненный пример

Typed Arrays широко используются в WebGL для работы с графикой. WebGL использует их для передачи вершин, текстур и других данных на видеокарту.  Также, они активно применяются в библиотеках для обработки изображений и аудио, где требуется эффективная работа с большими объемами бинарных данных.  Например, при работе с `<canvas>` элементом для создания сложных визуализаций часто используются Typed Arrays для хранения информации о пикселях.

### Ключевые моменты

*   Typed Arrays предназначены для хранения однородных числовых данных.
*   Они более эффективны с точки зрения памяти и скорости по сравнению с обычными массивами JavaScript.
*   Для создания Typed Array необходимо создать `ArrayBuffer` и затем "представление" (view) этого буфера.
*   Существуют разные типы Typed Arrays для различных числовых типов.
*   Они активно используются в WebGL, библиотеках для обработки изображений и аудио.



## Интерактивный пример

<Sandpack
  template="vanilla"
  files={{
    "/index.html": `<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Typed Arrays Demo</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div class="container">
    <h1>Typed Arrays Demo</h1>

    <label for="arrayLength">Длина массива:</label>
    <input type="number" id="arrayLength" value="5" min="1">

    <label for="arrayType">Тип массива:</label>
    <select id="arrayType">
      <option value="Int8Array">Int8Array</option>
      <option value="Uint8Array">Uint8Array</option>
      <option value="Int16Array">Int16Array</option>
      <option value="Uint16Array">Uint16Array</option>
      <option value="Int32Array">Int32Array</option>
      <option value="Uint32Array">Uint32Array</option>
      <option value="Float32Array">Float32Array</option>
      <option value="Float64Array">Float64Array</option>
    </select>

    <button id="createArray">Создать массив</button>

    <div id="arrayDisplay">
      <p>Массив:</p>
      <pre id="arrayContent"></pre>
    </div>

    <label for="index">Индекс для изменения:</label>
    <input type="number" id="index" value="0" min="0">

    <label for="newValue">Новое значение:</label>
    <input type="number" id="newValue">

    <button id="updateValue">Обновить значение</button>
  </div>

  <script src="/index.js"><\/script>
</body>
</html>`,
    "/styles.css": `body {
  font-family: sans-serif;
  background-color: #222;
  color: #eee;
  padding: 20px;
}

.container {
  max-width: 600px;
  margin: 0 auto;
}

label {
  display: block;
  margin-top: 10px;
}

input[type="number"],
select {
  width: 100%;
  padding: 8px;
  margin-top: 5px;
  border: 1px solid #555;
  background-color: #333;
  color: #eee;
  box-sizing: border-box;
}

button {
  background-color: #4CAF50;
  color: white;
  padding: 10px 15px;
  margin-top: 10px;
  border: none;
  cursor: pointer;
  border-radius: 5px;
}

button:hover {
  background-color: #3e8e41;
}

#arrayDisplay {
  margin-top: 20px;
  border: 1px solid #555;
  padding: 10px;
  background-color: #333;
  border-radius: 5px;
}

#arrayContent {
  white-space: pre-wrap;
  word-wrap: break-word;
}
`,
    "/index.js": `document.addEventListener('DOMContentLoaded', () => {
  const arrayLengthInput = document.getElementById('arrayLength');
  const arrayTypeSelect = document.getElementById('arrayType');
  const createArrayButton = document.getElementById('createArray');
  const arrayContentDisplay = document.getElementById('arrayContent');
  const indexInput = document.getElementById('index');
  const newValueInput = document.getElementById('newValue');
  const updateValueButton = document.getElementById('updateValue');

  let typedArray;

  createArrayButton.addEventListener('click', () => {
    const length = parseInt(arrayLengthInput.value);
    const type = arrayTypeSelect.value;

    try {
      switch (type) {
        case 'Int8Array':
          typedArray = new Int8Array(length);
          break;
        case 'Uint8Array':
          typedArray = new Uint8Array(length);
          break;
        case 'Int16Array':
          typedArray = new Int16Array(length);
          break;
        case 'Uint16Array':
          typedArray = new Uint16Array(length);
          break;
        case 'Int32Array':
          typedArray = new Int32Array(length);
          break;
        case 'Uint32Array':
          typedArray = new Uint32Array(length);
          break;
        case 'Float32Array':
          typedArray = new Float32Array(length);
          break;
        case 'Float64Array':
          typedArray = new Float64Array(length);
          break;
        default:
          throw new Error('Неизвестный тип массива');
      }

      // Отображаем массив
      arrayContentDisplay.textContent = typedArray.toString();
    } catch (error) {
      arrayContentDisplay.textContent = 'Ошибка: ' + error.message;
    }
  });

  updateValueButton.addEventListener('click', () => {
    if (!typedArray) {
      arrayContentDisplay.textContent = 'Сначала создайте массив!';
      return;
    }

    const index = parseInt(indexInput.value);
    const newValue = parseFloat(newValueInput.value);

    if (index >= 0 && index < typedArray.length) {
      typedArray[index] = newValue;
      arrayContentDisplay.textContent = typedArray.toString();
    } else {
      arrayContentDisplay.textContent = 'Неверный индекс!';
    }
  });
});
`
  }}
  options={{
    showNavigator: false,
    showLineNumbers: true,
    editorHeight: 400
  }}
/>

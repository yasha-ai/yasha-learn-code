## JavaScript: DOM Манипуляции

Привет! Сегодня мы погрузимся в мир, где JavaScript оживляет веб-страницы, позволяя нам динамически изменять их содержимое, структуру и внешний вид. Это магия называется **DOM Манипуляциями**!

### Что такое DOM?

**DOM** (Document Object Model) — это программный интерфейс для HTML и XML документов. Он представляет страницу как древовидную структуру, где каждый узел (node) — это объект: элемент, текст, комментарий и т.д. JS предоставляет нам API для взаимодействия с этой структурой: читать данные, изменять атрибуты, добавлять новые элементы и удалять старые.

### Доступ к элементам

Прежде чем что-либо менять, нужно найти нужный элемент на странице.

*   `document.getElementById('id')`: Находит элемент по его уникальному ID.
*   `document.querySelector('CSS-селектор')`: Находит *первый* элемент, соответствующий CSS-селектору. Это самый универсальный и часто используемый метод.
*   `document.querySelectorAll('CSS-селектор')`: Находит *все* элементы, соответствующие CSS-селектору, возвращая `NodeList`.

```javascript
// Пример 1: Получение элемента по ID
const mainTitle = document.getElementById('mainTitle');
console.log('Заголовок:', mainTitle.textContent);

// Пример 2: Получение первого элемента по классу
const firstParagraph = document.querySelector('.item');
console.log('Первый параграф:', firstParagraph.textContent);

// Пример 3: Получение всех элементов по тегу и классу
const allItems = document.querySelectorAll('p.item');
allItems.forEach((item, index) => {
    console.log(`Элемент ${index + 1}: ${item.textContent}`);
});
```

### Изменение содержимого и атрибутов

Найдя элемент, мы можем изменить его внутренности или свойства.

*   `element.textContent`: Изменяет или получает текстовое содержимое элемента (безопасно).
*   `element.innerHTML`: Изменяет или получает HTML-содержимое элемента (будьте осторожны с XSS!).
*   `element.setAttribute('name', 'value')`: Устанавливает атрибут.
*   `element.getAttribute('name')`: Получает значение атрибута.
*   `element.removeAttribute('name')`: Удаляет атрибут.
*   `element.classList.add()`, `remove()`, `toggle()`: Удобные методы для управления классами CSS.
*   `element.style.propertyName`: Устанавливает инлайн-стили.

```javascript
// Пример 4: Изменение текста и HTML
mainTitle.textContent = 'Новый Заголовок Курса!'; // Только текст
// mainTitle.innerHTML = '<em>Супер</em> <strong>Заголовок</strong>!'; // Используйте осторожно!

// Пример 5: Работа с классами и стилями
const card = document.querySelector('.card');
card.classList.remove('hidden'); // Убираем класс 'hidden'
card.classList.add('visible');   // Добавляем класс 'visible'
card.classList.toggle('highlight'); // Переключаем класс 'highlight'

card.style.backgroundColor = '#f0f8ff'; // Устанавливаем фон
card.style.padding = '15px';

// Пример 6: Работа с атрибутами
card.setAttribute('data-category', 'learning');
console.log('Категория карточки:', card.getAttribute('data-category'));
```

### Создание, добавление и удаление элементов

Мы можем не только изменять существующие, но и создавать новые элементы "с нуля".

*   `document.createElement('tagName')`: Создает новый HTML-элемент.
*   `document.createTextNode('text')`: Создает текстовый узел.
*   `parent.appendChild(child)`: Добавляет дочерний элемент в конец родителя.
*   `parent.prepend(child)`: Добавляет дочерний элемент в начало родителя.
*   `parent.insertBefore(newNode, referenceNode)`: Вставляет `newNode` перед `referenceNode`.
*   `element.remove()`: Удаляет элемент (современный способ).
*   `parent.removeChild(child)`: Удаляет указанный дочерний элемент из родителя.

```javascript
// Пример 7: Создание и добавление нового элемента
const newButton = document.createElement('button');
newButton.textContent = 'Нажми меня!';
newButton.id = 'dynamicButton';
newButton.classList.add('btn', 'btn-primary');

const appDiv = document.getElementById('app');
appDiv.appendChild(newButton); // Добавляем кнопку в конец #app

// Пример 8: Добавление элемента в начало
const introText = document.createElement('p');
introText.textContent = 'Это динамически добавленный текст в начало.';
appDiv.prepend(introText);

// Пример 9: Удаление элемента
const oldItem = document.querySelector('.old-item');
if (oldItem) { // Всегда проверяйте, существует ли элемент перед удалением
    oldItem.remove(); // Удаляем элемент с классом 'old-item'
    console.log('Элемент .old-item удален.');
}
```

### Продвинутые приёмы и производительность

Частые манипуляции с DOM могут быть медленными, так как они вызывают перерисовку страницы (reflow/repaint). Для оптимизации используйте:

*   **`DocumentFragment`**: Создайте элементы в "невидимом" фрагменте, затем добавьте его целиком в DOM за одну операцию.

### Типичные ошибки и подводные камни

1.  **Элемент не найден**: Попытка манипулировать элементом, который еще не загрузился или не существует. Всегда оборачивайте код манипуляций в `DOMContentLoaded` или размещайте `<script>` в конце `<body>`.
    ```javascript
    document.addEventListener('DOMContentLoaded', () => {
        const nonExistent = document.getElementById('non-existent');
        if (nonExistent) {
            nonExistent.textContent = 'Я не null!';
        } else {
            console.error('Элемент не найден!'); // Будет выведено
        }
    });
    ```
2.  **XSS с `innerHTML`**: Не используйте `innerHTML` с данными, полученными от пользователя, так как это может привести к атакам (Cross-Site Scripting). Предпочитайте `textContent`.
3.  **`NodeList` не является массивом**: `querySelectorAll` возвращает `NodeList`, который похож на массив, но не имеет всех его методов (`.map()`, `.filter()`). Используйте `Array.from(nodeList)` или спред-оператор `[...nodeList]` для преобразования в массив.

### Практика и советы

*   **Используйте `querySelector`/`querySelectorAll`**: Они наиболее гибкие и позволяют использовать всю мощь CSS-селекторов.
*   **Обновляйте DOM пакетно**: Старайтесь вносить все изменения в DOM за одну операцию или как можно реже, чтобы минимизировать перерисовки.
*   **Отделяйте логику от представления**: Старайтесь, чтобы ваши JS-файлы были максимально "чистыми" и не содержали инлайн-стилей или слишком много HTML-разметки.

```html
<!-- Пример HTML для экспериментов -->
<div id="app">
    <h1 id="mainTitle">Исходный Заголовок</h1>
    <div class="container">
        <p class="item">Первый параграф</p>
        <p class="item old-item">Второй параграф (будет удален)</p>
        <div class="card hidden">
            <h3>Заголовок Карточки</h3>
            <p>Детальное описание.</p>
        </div>
    </div>
    <button id="updateButton">Обновить DOM</button>
</div>
```
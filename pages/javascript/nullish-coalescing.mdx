import { Sandpack } from '@codesandbox/sandpack-react'

# JavaScript: Мозги. Урок: Nullish coalescing ??

Привет! Сегодня мы разберем оператор `??` (nullish coalescing), который поможет нам элегантно обрабатывать значения, которые могут быть `null` или `undefined`. Он упрощает код и делает его более читаемым.

## Что такое Nullish Coalescing Operator (??)

Оператор `??` возвращает правый операнд, только если левый операнд равен `null` или `undefined`. В противном случае, он возвращает левый операнд. Думайте о нем как о безопасном способе предоставить значение по умолчанию, когда переменная "пустая".

### Пример кода

```javascript
let name = null;
let defaultName = "Guest";

let displayName = name ?? defaultName; // displayName будет "Guest"

console.log(displayName); // Выведет: Guest

name = "Alice";
displayName = name ?? defaultName; // displayName будет "Alice"

console.log(displayName); // Выведет: Alice
```

В этом примере, если `name` – `null` или `undefined`, то `displayName` получит значение `defaultName`. Если `name` содержит какое-либо другое значение, то `displayName` получит это значение.

## Практические примеры

Вот несколько примеров использования `??` в разных сценариях:

```javascript
// 1. Установка значения по умолчанию для переменной
let userAge = null;
let age = userAge ?? 18; // Если userAge null или undefined, age будет 18
console.log(age); // Выведет: 18

// 2. Работа с объектами
let user = {
  name: "Bob",
  // age: null // Предположим, что age отсутствует в объекте
};

let userAgeFromObject = user.age ?? 25; // Если user.age null или undefined, userAgeFromObject будет 25
console.log(userAgeFromObject); // Выведет: 25

// 3. Использование с функциями
function greet(name) {
  let greeting = "Hello, " + (name ?? "User") + "!";
  return greeting;
}

console.log(greet("Charlie")); // Выведет: Hello, Charlie!
console.log(greet(null)); // Выведет: Hello, User!
```

## Жизненный пример

В React и других фреймворках часто используются пропсы (props) для передачи данных компонентам.  Иногда пропсы могут быть не переданы, и в этом случае `??` может быть полезен для установки значений по умолчанию.

```javascript
// Пример компонента React
function Greeting(props) {
  const name = props.name ?? "Guest";
  return <h1>Hello, {name}!</h1>;
}

// Использование компонента
// <Greeting name="Eve" />  // Выведет: Hello, Eve!
// <Greeting />           // Выведет: Hello, Guest!
```

В Redux, Vuex и других системах управления состоянием, `??` может использоваться для безопасного доступа к данным, которые могут быть еще не загружены или иметь значение `null` или `undefined`.

## Ключевые моменты

*   `??` проверяет только `null` и `undefined`.
*   `??` отличается от `||` (логическое ИЛИ), который проверяет на любой "falsy" value (0, "", NaN, null, undefined, false).
*   `??` делает код более читаемым, когда нужно предоставить значение по умолчанию для `null` или `undefined`.
*   `??` широко используется в современных JavaScript-фреймворках и библиотеках.

### Практика

Попробуйте примеры в интерактивном редакторе:

<Sandpack
  template="vanilla"
  files={{
    '/index.js': `// Демонстрация Nullish Coalescing Operator (??)

// Вспомогательная функция: замена оператора ??
// nn(val, def) вернёт def только если val === null или val === undefined
function nn(val, def) {
  return (val !== null && val !== undefined) ? val : def;
}

document.body.style.fontFamily = 'Arial, sans-serif';
document.body.style.padding = '20px';
document.body.style.lineHeight = '1.6';

const title = document.createElement('h2');
title.textContent = 'Оператор ?? (Nullish Coalescing)';
document.body.appendChild(title);

function createTable(data) {
  const table = document.createElement('table');
  table.style.borderCollapse = 'collapse';
  table.style.width = '100%';
  table.style.marginBottom = '20px';

  // Заголовок
  const thead = document.createElement('thead');
  const headerRow = document.createElement('tr');
  ['Значение', 'С ??', 'С ||', 'Разница?'].forEach(function(text) {
    const th = document.createElement('th');
    th.textContent = text;
    th.style.border = '1px solid #ddd';
    th.style.padding = '10px';
    th.style.backgroundColor = '#2196F3';
    th.style.color = 'white';
    headerRow.appendChild(th);
  });
  thead.appendChild(headerRow);
  table.appendChild(thead);

  // Данные
  const tbody = document.createElement('tbody');
  data.forEach(function(item) {
    const value = item[0];
    const label = item[1];
    const row = document.createElement('tr');

    const valueWithNullish = nn(value, 'DEFAULT');
    const valueWithOr = value || 'DEFAULT';
    const different = valueWithNullish !== valueWithOr;

    [
      label,
      String(valueWithNullish),
      String(valueWithOr),
      different ? 'ДА' : 'Нет'
    ].forEach(function(text, i) {
      const td = document.createElement('td');
      td.textContent = text;
      td.style.border = '1px solid #ddd';
      td.style.padding = '10px';
      if (i === 3 && different) {
        td.style.backgroundColor = '#fff3e0';
        td.style.fontWeight = 'bold';
      }
      row.appendChild(td);
    });

    tbody.appendChild(row);
  });
  table.appendChild(tbody);

  return table;
}

// Сравнение ?? и ||
const h3_1 = document.createElement('h3');
h3_1.textContent = '1. Сравнение ?? vs ||';
document.body.appendChild(h3_1);

const testValues = [
  [null, 'null'],
  [undefined, 'undefined'],
  [0, '0'],
  ['', '""'],
  [false, 'false'],
  [NaN, 'NaN'],
  ['Hello', '"Hello"']
];

document.body.appendChild(createTable(testValues));

// Практические примеры
const h3_2 = document.createElement('h3');
h3_2.textContent = '2. Практические примеры';
document.body.appendChild(h3_2);

const examples = document.createElement('div');
examples.style.backgroundColor = '#f5f5f5';
examples.style.padding = '15px';
examples.style.borderRadius = '8px';

// Пример 1: Настройки пользователя
const settings = {
  theme: null,
  notifications: undefined,
  volume: 0,
  autoplay: false
};

examples.innerHTML = \`
  <h4>Пример 1: Настройки пользователя</h4>
  <pre style="background: white; padding: 10px; border-radius: 5px;">
const settings = {
  theme: null,
  notifications: undefined,
  volume: 0,
  autoplay: false
};

// С ?? (правильно)
theme: \${nn(settings.theme, 'light')}
notifications: \${nn(settings.notifications, true)}
volume: \${nn(settings.volume, 50)}
autoplay: \${nn(settings.autoplay, true)}

// С || (неправильно для 0 и false!)
theme: \${settings.theme || 'light'}
notifications: \${settings.notifications || true}
volume: \${settings.volume || 50} — 0 заменено на 50!
autoplay: \${settings.autoplay || true} — false заменено на true!
  </pre>
\`;

document.body.appendChild(examples);

// Пример 2: API ответы
const h3_3 = document.createElement('h3');
h3_3.textContent = '3. Реальный кейс: API ответы';
h3_3.style.marginTop = '20px';
document.body.appendChild(h3_3);

const apiExample = document.createElement('div');
apiExample.style.backgroundColor = '#e3f2fd';
apiExample.style.padding = '15px';
apiExample.style.borderRadius = '8px';

const user = {
  name: 'Иван',
  age: 0, // новорожденный!
  score: null // еще не участвовал
};

apiExample.innerHTML = \`
  <h4>Объект пользователя:</h4>
  <pre style="background: white; padding: 10px; border-radius: 5px;">
{
  name: '\${user.name}',
  age: \${user.age},
  score: \${user.score}
}
  </pre>

  <h4>Отображение:</h4>
  <p><strong>Имя:</strong> \${nn(user.name, 'Аноним')}</p>
  <p><strong>Возраст:</strong> \${nn(user.age, 'Неизвестно')} (\${user.age} корректно!)</p>
  <p><strong>Очки:</strong> \${nn(user.score, 'Еще не играл')}</p>

  <p style="color: #f44336; margin-top: 15px;">
    <strong>С || было бы:</strong><br>
    Возраст: \${user.age || 'Неизвестно'} (показывает "Неизвестно" вместо 0!)
  </p>
\`;

document.body.appendChild(apiExample);

// Итоги
const summary = document.createElement('div');
summary.innerHTML = \`
  <h3>Итоги:</h3>
  <ul>
    <li><strong>??</strong> проверяет только <code>null</code> и <code>undefined</code></li>
    <li><strong>||</strong> проверяет все falsy значения (0, "", false, null, undefined, NaN)</li>
    <li>Используй <strong>??</strong> когда 0 и false - валидные значения!</li>
    <li>Используй <strong>||</strong> когда нужна проверка на любое falsy значение</li>
  </ul>
\`;
summary.style.backgroundColor = '#e8f5e9';
summary.style.padding = '15px';
summary.style.borderRadius = '8px';
summary.style.marginTop = '20px';
document.body.appendChild(summary);

console.log('Демонстрация ?? завершена. Проверьте консоль!');`
  }}
/>

## JavaScript: Мозги. Урок "Сортировка и её подводные камни"


![Иллюстрация к уроку](/lessons/javascript-sorting-pitfalls.png)
Сортировка - это фундаментальный алгоритм в программировании, позволяющий упорядочить элементы массива по определенному критерию. В JavaScript, как и в любом другом языке, есть встроенные инструменты для сортировки, но важно понимать, как они работают и какие "подводные камни" могут встретиться.

### Основы сортировки в JavaScript

Самый простой способ отсортировать массив в JavaScript - использовать метод `sort()`. По умолчанию, он преобразует все элементы массива в строки и сортирует их в алфавитном порядке.

```javascript
const fruits = ["banana", "apple", "orange", "grape"];
fruits.sort();
console.log(fruits); // ["apple", "banana", "grape", "orange"]
```

Но что, если нам нужно отсортировать массив чисел? Тут нас ждет первая "подводная лодка".

```javascript
const numbers = [10, 5, 40, 25, 1];
numbers.sort();
console.log(numbers); // [1, 10, 25, 40, 5]  - Ой!
```

Результат неожиданный, потому что JavaScript сравнивает числа как строки. Чтобы правильно отсортировать числа, нужно передать функцию сравнения в метод `sort()`.

```javascript
const numbers = [10, 5, 40, 25, 1];
numbers.sort((a, b) => a - b); // Функция сравнения для числовой сортировки
console.log(numbers); // [1, 5, 10, 25, 40] - Теперь все правильно!
```

`a - b` определяет порядок сортировки:
*  Если `a - b` возвращает отрицательное число, `a` ставится перед `b`.
*  Если `a - b` возвращает положительное число, `b` ставится перед `a`.
*  Если `a - b` возвращает 0, порядок `a` и `b` не меняется.

Для обратной сортировки можно использовать `b - a`.

### Сортировка объектов

Сортировка объектов требует указания, по какому свойству сортировать.

```javascript
const products = [
  { name: "Laptop", price: 1200 },
  { name: "Keyboard", price: 75 },
  { name: "Mouse", price: 25 },
];

products.sort((a, b) => a.price - b.price); // Сортировка по цене
console.log(products);
```

### Жизненный пример

Сортировка используется повсеместно. Например:

*   **Интернет-магазины:** Сортировка товаров по цене, популярности, рейтингу.
*   **Социальные сети:** Сортировка постов по времени, лайкам, релевантности.
*   **Фреймворки:** React, Angular, Vue.js используют сортировку для отображения списков, таблиц и других компонентов.  Например, сортировка столбцов в таблице данных.

Рассмотрим пример React компонента, который сортирует список пользователей по имени:

```javascript
// Пример React компонента
function UserList({ users, sortBy }) {
  const sortedUsers = [...users].sort((a, b) => {
    if (sortBy === 'name') {
      return a.name.localeCompare(b.name);
    }
    return 0; // Не сортировать, если sortBy не 'name'
  });

  return (
    <ul>
      {sortedUsers.map(user => (
        <li key={user.id}>{user.name}</li>
      ))}
    </ul>
  );
}
```

В этом примере используется `localeCompare` для корректной сортировки строк, учитывая локаль.

### Ключевые моменты

*   `sort()` изменяет исходный массив. Если нужно сохранить исходный массив, создайте его копию (`[...array].sort()`).
*   Для числовой сортировки обязательно передавайте функцию сравнения.
*   Для сортировки строк используйте `localeCompare` для корректной сортировки с учетом локали.
*   Сортировка объектов требует указания свойства для сортировки.
*   Понимание алгоритмов сортировки (например, быстрая сортировка, сортировка слиянием) может помочь оптимизировать производительность для больших объемов данных, хотя встроенный `sort()` обычно достаточно хорош.



## Интерактивный пример

<Sandpack
  template="vanilla"
  files={{
    "/index.html": `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Сортировка и её подводные камни</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div class="container">
    <h1>Сортировка массивов в JavaScript</h1>

    <h2>Числа</h2>
    <div id="numbers-example">
      <button id="sort-numbers-button">Сортировать числа</button>
      <p>Исходный массив: <span id="original-numbers"></span></p>
      <p>Отсортированный массив: <span id="sorted-numbers"></span></p>
    </div>

    <h2>Объекты</h2>
    <div id="objects-example">
      <label for="sort-property">Сортировать по свойству:</label>
      <select id="sort-property">
        <option value="name">Имя</option>
        <option value="price">Цена</option>
      </select>
      <button id="sort-objects-button">Сортировать объекты</button>
      <p>Исходный массив объектов: <span id="original-objects"></span></p>
      <p>Отсортированный массив объектов: <span id="sorted-objects"></span></p>
    </div>
  </div>

  <script src="/index.js"><\/script>
</body>
</html>`,
    "/styles.css": `body {
  font-family: sans-serif;
  background-color: #222;
  color: #eee;
  padding: 20px;
}

.container {
  max-width: 800px;
  margin: 0 auto;
}

button {
  background-color: #4CAF50; /* Green */
  border: none;
  color: white;
  padding: 10px 20px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 4px 2px;
  cursor: pointer;
  border-radius: 5px;
}

select {
  padding: 8px;
  font-size: 16px;
  border-radius: 5px;
  border: 1px solid #ccc;
  background-color: #333;
  color: #eee;
}

label {
  margin-right: 10px;
}
`,
    "/index.js": `// Пример с числами
const numbers = [10, 5, 40, 25, 1];
const originalNumbersSpan = document.getElementById("original-numbers");
const sortedNumbersSpan = document.getElementById("sorted-numbers");
const sortNumbersButton = document.getElementById("sort-numbers-button");

originalNumbersSpan.textContent = JSON.stringify(numbers);

sortNumbersButton.addEventListener("click", () => {
  const sortedNumbers = [...numbers].sort((a, b) => a - b); // Создаем копию массива, чтобы не изменять исходный
  sortedNumbersSpan.textContent = JSON.stringify(sortedNumbers);
});

// Пример с объектами
const products = [
  { name: "Laptop", price: 1200 },
  { name: "Keyboard", price: 75 },
  { name: "Mouse", price: 25 },
];

const originalObjectsSpan = document.getElementById("original-objects");
const sortedObjectsSpan = document.getElementById("sorted-objects");
const sortObjectsButton = document.getElementById("sort-objects-button");
const sortPropertySelect = document.getElementById("sort-property");

originalObjectsSpan.textContent = JSON.stringify(products);

sortObjectsButton.addEventListener("click", () => {
  const sortBy = sortPropertySelect.value;
  const sortedProducts = [...products].sort((a, b) => {
    if (sortBy === "name") {
      return a.name.localeCompare(b.name);
    } else if (sortBy === "price") {
      return a.price - b.price;
    }
    return 0;
  });
  sortedObjectsSpan.textContent = JSON.stringify(sortedProducts);
});
`
  }}
  options={{
    showNavigator: false,
    showLineNumbers: true,
    editorHeight: 400
  }}
/>

## JavaScript: Мозги. Урок: __proto__ vs prototype


![Иллюстрация к уроку](/lessons/javascript-proto-vs-prototype.png)
В JavaScript понимание прототипного наследования – ключ к освоению языка. Сегодня мы разберемся с двумя важными, но часто путаемыми понятиями: `__proto__` и `prototype`.

### Что такое `__proto__`?

`__proto__` – это свойство объекта, которое указывает на его прототип. Прототип – это другой объект, от которого текущий объект наследует свойства и методы. Когда мы пытаемся получить доступ к свойству объекта, которого у него нет, JavaScript ищет это свойство в прототипе объекта (указанном через `__proto__`), затем в прототипе прототипа и так далее, пока не достигнет `null`.

```javascript
const animal = {
  name: "Generic Animal",
  makeSound: function() {
    console.log("Generic sound");
  }
};

const dog = {
  name: "Dog",
  bark: function() {
    console.log("Woof!");
  }
};

// Устанавливаем прототип для dog
dog.__proto__ = animal;

console.log(dog.name); // Выведет "Dog"
dog.makeSound(); // Выведет "Generic sound" - метод унаследован от animal
dog.bark(); // Выведет "Woof!"
```

### Что такое `prototype`?

`prototype` – это свойство **функции-конструктора**. Оно определяет прототип для всех объектов, созданных с помощью этой функции-конструктора.  Другими словами,  `prototype` функции определяет `__proto__` создаваемых ею объектов.

```javascript
function Animal(name) {
  this.name = name;
}

Animal.prototype.makeSound = function() {
  console.log("Generic sound");
};

const cat = new Animal("Cat");
cat.makeSound(); // Выведет "Generic sound"
console.log(cat.__proto__ === Animal.prototype); // Выведет true
```

В этом примере, `Animal.prototype` является прототипом для объекта `cat`.  `cat.__proto__` указывает на `Animal.prototype`.

### Ключевое различие

*   `__proto__` – это свойство **объекта**, указывающее на его прототип.
*   `prototype` – это свойство **функции-конструктора**, определяющее прототип для объектов, создаваемых этой функцией.

### Практический пример кода

```javascript
function Person(name, age) {
  this.name = name;
  this.age = age;
}

Person.prototype.greet = function() {
  console.log(`Hello, my name is ${this.name} and I am ${this.age} years old.`);
};

const john = new Person("John", 30);
john.greet(); // Выведет "Hello, my name is John and I am 30 years old."

const jane = new Person("Jane", 25);
jane.greet(); // Выведет "Hello, my name is Jane and I am 25 years old."

// Добавляем метод в прототип Person после создания объектов
Person.prototype.sayGoodbye = function() {
  console.log("Goodbye!");
};

john.sayGoodbye(); // Выведет "Goodbye!"
jane.sayGoodbye(); // Выведет "Goodbye!"
```

### Жизненный пример

Многие JavaScript фреймворки и библиотеки (React, Vue, Angular) активно используют прототипное наследование. Например, при создании компонентов в React, часто используется наследование от базового класса `React.Component`.  Методы, определенные в `React.Component.prototype`, становятся доступны всем компонентам, созданным на его основе.  Это позволяет избежать дублирования кода и делает структуру приложения более организованной.  В Vue.js также широко используется прототипное наследование для добавления глобальных методов и свойств во все экземпляры Vue.

### Ключевые моменты

*   `__proto__` - это свойство объекта, указывающее на его прототип.
*   `prototype` - это свойство функции-конструктора, определяющее прототип для создаваемых объектов.
*   Прототипное наследование позволяет объектам наследовать свойства и методы от других объектов.
*   Изменения в `prototype` функции-конструктора отражаются на всех объектах, созданных с помощью этой функции.
*   Понимание прототипного наследования необходимо для эффективной работы с JavaScript.



## Интерактивный пример

<Sandpack
  template="vanilla"
  files={{
    "/index.html": `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>__proto__ vs prototype</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div id="app">
    <h1>__proto__ vs prototype</h1>
    <p>Введите имя животного и действие:</p>
    <input type="text" id="animalName" placeholder="Имя животного">
    <input type="text" id="animalAction" placeholder="Действие животного">
    <button id="createAnimal">Создать животное</button>
    <div id="output"></div>
  </div>
  <script src="/index.js"><\/script>
</body>
</html>`,
    "/styles.css": `body {
  font-family: sans-serif;
  background-color: #222;
  color: #eee;
  padding: 20px;
}

#app {
  background-color: #333;
  padding: 20px;
  border-radius: 5px;
}

input[type="text"] {
  padding: 8px;
  margin-right: 10px;
  border: none;
  border-radius: 3px;
  background-color: #444;
  color: #eee;
}

button {
  padding: 8px 12px;
  background-color: #555;
  color: #eee;
  border: none;
  border-radius: 3px;
  cursor: pointer;
}

button:hover {
  background-color: #666;
}

#output {
  margin-top: 20px;
  padding: 10px;
  border: 1px solid #555;
  border-radius: 5px;
  background-color: #444;
}`,
    "/index.js": `// Функция-конструктор Animal
function Animal(name) {
  this.name = name;
}

// Добавляем метод makeSound в prototype Animal
Animal.prototype.makeSound = function(action) {
  return \`\${'}this.name\${'}: \${'}action\${'}\`;
};

// Получаем элементы DOM
const animalNameInput = document.getElementById("animalName");
const animalActionInput = document.getElementById("animalAction");
const createAnimalButton = document.getElementById("createAnimal");
const outputDiv = document.getElementById("output");

// Обработчик клика на кнопку "Создать животное"
createAnimalButton.addEventListener("click", () => {
  const name = animalNameInput.value;
  const action = animalActionInput.value;

  // Создаем новый объект Animal
  const newAnimal = new Animal(name);

  // Вызываем метод makeSound и выводим результат
  const sound = newAnimal.makeSound(action);
  outputDiv.textContent = sound;

  // Пример работы с __proto__
  console.log("newAnimal.__proto__ === Animal.prototype:", newAnimal.__proto__ === Animal.prototype); // true
});

// Пример наследования
function Dog(name, breed) {
    Animal.call(this, name); // Вызываем конструктор Animal для инициализации name
    this.breed = breed;
}

// Устанавливаем прототип Dog на Animal.prototype, чтобы Dog наследовал от Animal
Dog.prototype = Object.create(Animal.prototype);

// Добавляем метод bark только для Dog
Dog.prototype.bark = function() {
    return "Woof!";
};

// Создаем экземпляр Dog
const myDog = new Dog("Buddy", "Golden Retriever");

// Проверяем наследование
console.log("myDog.name:", myDog.name); // Buddy
console.log("myDog.makeSound(\"runs around\"): ", myDog.makeSound("runs around")); // Buddy: runs around
console.log("myDog.bark():", myDog.bark()); // Woof!
console.log("myDog.__proto__ === Dog.prototype:", myDog.__proto__ === Dog.prototype); // true
console.log("Dog.prototype.__proto__ === Animal.prototype:", Dog.prototype.__proto__ === Animal.prototype); // true
`
  }}
  options={{
    showNavigator: false,
    showLineNumbers: true,
    editorHeight: 400
  }}
/>

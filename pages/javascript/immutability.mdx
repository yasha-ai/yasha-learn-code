## JavaScript: Мозги. Урок: Иммутабельность


![Иллюстрация к уроку](/lessons/javascript-immutability.png)
Иммутабельность – это краеугольный камень надежного и предсказуемого кода. В этом уроке мы разберем, что такое иммутабельность, зачем она нужна и как ее реализовать в JavaScript.

### Что такое иммутабельность?

Иммутабельность означает, что после создания объект не может быть изменен. Вместо изменения существующего объекта, создается его новая копия с нужными изменениями. Представьте себе, что у вас есть лего-конструктор. Вместо того, чтобы ломать собранную фигуру и перестраивать ее, вы берете новые детали и строите новую фигуру, основываясь на старой.

### Иммутабельность на практике

#### Работа с примитивами

Примитивные типы данных в JavaScript (строки, числа, булевы значения, null, undefined, Symbol) уже иммутабельны. Их значения нельзя изменить.

```javascript
let str = "Hello";
str = str.toUpperCase(); // str теперь "HELLO", исходная строка "Hello" не изменилась, создана новая.

let num = 5;
num = num + 2; // num теперь 7, исходное значение 5 не изменилось.
```

#### Работа с объектами и массивами

С объектами и массивами все сложнее, так как они по умолчанию мутабельны (изменяемые).

```javascript
let person = { name: "Alice", age: 30 };
person.age = 31; // Мутация объекта person

let numbers = [1, 2, 3];
numbers.push(4); // Мутация массива numbers
```

Чтобы работать с объектами и массивами иммутабельно, нужно создавать их копии.

```javascript
// Иммутабельное обновление объекта с использованием spread syntax
let person = { name: "Alice", age: 30 };
let updatedPerson = { ...person, age: 31 }; // Создается новый объект, age обновляется

// Иммутабельное обновление массива с использованием slice и spread syntax
let numbers = [1, 2, 3];
let updatedNumbers = [...numbers, 4]; // Создается новый массив, добавляется элемент
let removedNumbers = numbers.slice(0, 2); // Создается новый массив с первыми двумя элементами

//Альтернативный вариант для массивов: map, filter, reduce
let doubledNumbers = numbers.map(x => x * 2); // [2, 4, 6] - новый массив
```

### Зачем нужна иммутабельность?

*   **Предсказуемость:** Легче понимать, как изменяются данные в вашем приложении.
*   **Отладка:** Проще отслеживать источник ошибок, так как изменения данных происходят более контролируемо.
*   **Оптимизация:** В некоторых случаях иммутабельность позволяет оптимизировать производительность, например, в React.
*   **Параллелизм:** Иммутабельные структуры данных безопасны для использования в многопоточных приложениях.

### Жизненный пример

В React, Redux и других фреймворках и библиотеках иммутабельность играет ключевую роль. Например, в Redux состояние приложения хранится в иммутабельном виде. При каждом изменении состояния создается новый объект состояния, что позволяет React эффективно обнаруживать изменения и перерисовывать только необходимые компоненты. Это значительно повышает производительность. Многие библиотеки для работы с данными, такие как Immutable.js, предоставляют инструменты для упрощения работы с иммутабельными структурами данных.

### Ключевые моменты

*   Иммутабельность – это концепция, при которой данные не могут быть изменены после создания.
*   Примитивные типы в JavaScript иммутабельны.
*   Объекты и массивы по умолчанию мутабельны, поэтому необходимо создавать их копии для иммутабельного обновления.
*   Иммутабельность упрощает отладку, повышает предсказуемость и может улучшить производительность.
*   Фреймворки, такие как React и Redux, активно используют иммутабельность.

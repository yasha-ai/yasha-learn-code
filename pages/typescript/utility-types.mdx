## TypeScript: Броня. Урок 6: Utility Types


![Иллюстрация к уроку](/lessons/typescript-utility-types.png)
Utility Types в TypeScript - это мощный инструмент, позволяющий трансформировать существующие типы, создавая новые на их основе. Они помогают избежать дублирования, делают код более читаемым и поддерживаемым. В этом уроке мы рассмотрим наиболее полезные из них.

### Что такое Utility Types?

Utility Types - это предопределенные типы в TypeScript, которые позволяют выполнять общие операции с типами, такие как создание типов, допускающих только для чтения свойства, или типов, делающих свойства необязательными.  Их можно рассматривать как функции для типов.

### `Partial<Type>`

`Partial<Type>` создает новый тип, в котором все свойства типа `Type` становятся необязательными.

```typescript
interface User {
  id: number;
  name: string;
  email: string;
}

// Все свойства UserPartial теперь необязательны
type UserPartial = Partial<User>;

const userPartial: UserPartial = {
  name: "John Doe",
}; // Корректно, так как name необязательное свойство
```

### `Required<Type>`

`Required<Type>` делает все свойства типа `Type` обязательными.  Это противоположность `Partial<Type>`.

```typescript
interface UserPartial {
  id?: number;
  name?: string;
  email?: string;
}

// Все свойства UserRequired теперь обязательны
type UserRequired = Required<UserPartial>;

// const userRequired: UserRequired = {}; // Ошибка: Отсутствуют свойства 'id', 'name' и 'email'
const userRequired: UserRequired = {
  id: 1,
  name: "John Doe",
  email: "john.doe@example.com",
}; // Корректно
```

### `Readonly<Type>`

`Readonly<Type>` создает новый тип, в котором все свойства типа `Type` доступны только для чтения.

```typescript
interface User {
  id: number;
  name: string;
}

// Все свойства ReadonlyUser доступны только для чтения
type ReadonlyUser = Readonly<User>;

const readonlyUser: ReadonlyUser = {
  id: 1,
  name: "John Doe",
};

// readonlyUser.name = "Jane Doe"; // Ошибка: Невозможно назначить свойство 'name', так как оно доступно только для чтения.
```

### `Pick<Type, Keys>`

`Pick<Type, Keys>` выбирает указанные свойства (`Keys`) из типа `Type` и создает новый тип, содержащий только эти свойства.

```typescript
interface User {
  id: number;
  name: string;
  email: string;
}

// UserWithoutEmail содержит только свойства id и name
type UserWithoutEmail = Pick<User, "id" | "name">;

const userWithoutEmail: UserWithoutEmail = {
  id: 1,
  name: "John Doe",
};
```

### `Omit<Type, Keys>`

`Omit<Type, Keys>` исключает указанные свойства (`Keys`) из типа `Type` и создает новый тип, содержащий все свойства, кроме исключенных.

```typescript
interface User {
  id: number;
  name: string;
  email: string;
}

// UserWithoutEmail содержит только свойства id и email
type UserWithoutName = Omit<User, "name">;

const userWithoutName: UserWithoutName = {
  id: 1,
  email: "john.doe@example.com",
};
```

### `Record<Keys, Type>`

`Record<Keys, Type>` создает тип объекта, где ключи (`Keys`) имеют тип `Type`.

```typescript
// Создаем тип, где ключи - строки, а значения - числа
type StringToNumberMap = Record<string, number>;

const stringToNumber: StringToNumberMap = {
  one: 1,
  two: 2,
};
```

### Жизненный пример

В React часто используются `Partial` и `Omit` для работы с состояниями компонентов и пропсами.

```typescript
interface Props {
    name: string;
    age: number;
    address?: string;
}

// Пример использования Partial:  Создаем тип для обновления пропсов
type UpdateProps = Partial<Props>;

// Пример использования Omit:  Создаем тип для пропсов без address
type RequiredProps = Omit<Props, 'address'>;

function MyComponent(props: Props) {
  // ...
}
```

В Redux Toolkit `Partial` используется для создания типов для обновления состояния reducer-а.

### Ключевые моменты

*   Utility Types экономят время и уменьшают дублирование кода.
*   Они делают код более читаемым и поддерживаемым.
*   `Partial`, `Required`, `Readonly`, `Pick`, `Omit` и `Record` - наиболее часто используемые Utility Types.
*   Они широко применяются в популярных библиотеках и фреймворках.



## Интерактивный пример

<Sandpack
  template="vanilla-ts"
  files={{
    "/index.ts": `
// Utility Types в TypeScript: Интерактивный пример

// Стили для отображения
const style = \`
  body {
    font-family: sans-serif;
    background-color: #282c34;
    color: #fff;
    padding: 20px;
  }

  button {
    background-color: #61dafb;
    border: none;
    padding: 10px 20px;
    cursor: pointer;
    border-radius: 5px;
    color: #282c34;
    font-weight: bold;
    margin-top: 10px;
  }

  input {
    padding: 8px;
    margin-bottom: 10px;
    border-radius: 5px;
    border: 1px solid #ccc;
    background-color: #333;
    color: #fff;
  }

  label {
    display: block;
    margin-bottom: 5px;
  }

  .output {
    margin-top: 20px;
    padding: 10px;
    border: 1px solid #61dafb;
    border-radius: 5px;
    background-color: #333;
  }
\`;

const styleElement = document.createElement('style');
styleElement.innerHTML = style;
document.head.appendChild(styleElement);

// 1. Partial<Type>
interface Product {
  id: number;
  name: string;
  price: number;
}

function updateProduct(product: Product, updates: Partial<Product>): Product {
  return { ...product, ...updates };
}

const initialProduct: Product = { id: 1, name: "Laptop", price: 1200 };
const partialUpdate = { price: 1300 };
const updatedProduct = updateProduct(initialProduct, partialUpdate);

// 2. Required<Type>
interface Config {
  apiUrl?: string;
  timeout?: number;
}

function validateConfig(config: Config): Required<Config> {
  const defaultConfig: Required<Config> = { apiUrl: "https://example.com/api", timeout: 5000 };
  return { ...defaultConfig, ...config } as Required<Config>;
}

const partialConfig: Config = { timeout: 2000 };
const validatedConfig = validateConfig(partialConfig);

// 3. Readonly<Type>
interface Point {
  x: number;
  y: number;
}

const initialPoint: Point = { x: 0, y: 0 };
const readonlyPoint: Readonly<Point> = initialPoint;

// 4. Pick<Type, Keys>
interface Task {
  id: number;
  title: string;
  description: string;
  completed: boolean;
}

type TaskPreview = Pick<Task, "id" | "title">;

const taskPreview: TaskPreview = { id: 1, title: "Learn TypeScript" };

// 5. Omit<Type, Keys>
type TaskWithoutDescription = Omit<Task, "description">;

const taskWithoutDescription: TaskWithoutDescription = { id: 1, title: "Learn TypeScript", completed: false };

// 6. Record<Keys, Type>
type ThemeColors = Record<string, string>;

const themeColors: ThemeColors = {
  primary: "#007bff",
  secondary: "#6c757d",
  success: "#28a745",
};

// UI elements
const appDiv = document.body;

// Partial Example
const partialDiv = document.createElement('div');
partialDiv.innerHTML = \`
  <h2>Partial Example</h2>
  <p>Original Product: \${'}<code>\${JSON.stringify(initialProduct)}</code>\${'}'}</p>
  <p>Partial Update: \${'}<code>\${JSON.stringify(partialUpdate)}</code>\${'}'}</p>
  <p>Updated Product: \${'}<code>\${JSON.stringify(updatedProduct)}</code>\${'}'}</p>
\`;
appDiv.appendChild(partialDiv);

// Required Example
const requiredDiv = document.createElement('div');
requiredDiv.innerHTML = \`
  <h2>Required Example</h2>
  <p>Partial Config: \${'}<code>\${JSON.stringify(partialConfig)}</code>\${'}'}</p>
  <p>Validated Config: \${'}<code>\${JSON.stringify(validatedConfig)}</code>\${'}'}</p>
\`;
appDiv.appendChild(requiredDiv);

// Readonly Example
const readonlyDiv = document.createElement('div');
readonlyDiv.innerHTML = \`
  <h2>Readonly Example</h2>
  <p>Initial Point: \${'}<code>\${JSON.stringify(initialPoint)}</code>\${'}'}</p>
  <p>Readonly Point: \${'}<code>\${JSON.stringify(readonlyPoint)}</code>\${'}'}</p>
\`;
appDiv.appendChild(readonlyDiv);

// Pick Example
const pickDiv = document.createElement('div');
pickDiv.innerHTML = \`
  <h2>Pick Example</h2>
  <p>Task Preview: \${'}<code>\${JSON.stringify(taskPreview)}</code>\${'}'}</p>
\`;
appDiv.appendChild(pickDiv);

// Omit Example
const omitDiv = document.createElement('div');
omitDiv.innerHTML = \`
  <h2>Omit Example</h2>
  <p>Task Without Description: \${'}<code>\${JSON.stringify(taskWithoutDescription)}</code>\${'}'}</p>
\`;
appDiv.appendChild(omitDiv);

// Record Example
const recordDiv = document.createElement('div');
recordDiv.innerHTML = \`
  <h2>Record Example</h2>
  <p>Theme Colors: \${'}<code>\${JSON.stringify(themeColors)}</code>\${'}'}</p>
\`;
appDiv.appendChild(recordDiv);
`
  }}
  options={{
    showNavigator: false,
    showLineNumbers: true,
    editorHeight: 400
  }}
/>

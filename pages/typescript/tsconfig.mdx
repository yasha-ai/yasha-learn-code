## TypeScript: Броня. Урок 3: Конфигурация tsconfig


![Иллюстрация к уроку](/lessons/typescript-tsconfig.png)
`tsconfig.json` – это сердце вашего TypeScript проекта. Он определяет, как компилятор TypeScript будет преобразовывать ваш код в JavaScript. Без него компилятор будет использовать настройки по умолчанию, которые редко подходят для реальных проектов.

### Что такое tsconfig.json?

`tsconfig.json` - это JSON-файл, содержащий настройки компилятора TypeScript. Он указывает, какие файлы включать в компиляцию, какие правила использовать для проверки типов и как генерировать JavaScript-код.  Думайте о нем как о файле конфигурации, который говорит компилятору: "Вот как нужно компилировать этот проект!".

### Основные параметры tsconfig.json

Рассмотрим несколько ключевых параметров:

*   **`compilerOptions`**: Самый важный раздел. Содержит опции, определяющие поведение компилятора.
*   **`include` и `exclude`**: Определяют, какие файлы включать или исключать из компиляции.
*   **`files`**: Указывает конкретные файлы для компиляции.

Давайте посмотрим на пример:

```json
{
  "compilerOptions": {
    "target": "es5", // Версия JavaScript, в которую компилируется код
    "module": "commonjs", // Система модулей
    "strict": true, // Включает строгий режим проверки типов
    "esModuleInterop": true, // Позволяет импортировать CommonJS модули как ES модули
    "outDir": "./dist", // Директория для сгенерированных JavaScript файлов
    "sourceMap": true // Создает source map файлы для отладки
  },
  "include": ["src/**/*"], // Включает все файлы TypeScript в директории src и поддиректориях
  "exclude": ["node_modules"] // Исключает папку node_modules
}
```

В этом примере:

*   `target: "es5"` говорит компилятору генерировать JavaScript, совместимый с ES5.  Это важно для поддержки старых браузеров.
*   `module: "commonjs"` указывает, что код будет использовать систему модулей CommonJS (используется в Node.js).
*   `strict: true` включает строгий режим, который помогает выявлять ошибки на этапе компиляции.
*   `outDir: "./dist"` указывает, что скомпилированные JavaScript файлы будут помещены в папку `dist`.
*   `include: ["src/**/*"]` включает все файлы TypeScript в папке `src` и ее подпапках.
*   `exclude: ["node_modules"]` исключает папку `node_modules`.  Это важно, чтобы не компилировать код из сторонних библиотек.

### Практические примеры кода

Предположим, у вас есть следующий TypeScript код:

```typescript
// src/greeter.ts
function greet(name: string) {
  return "Hello, " + name;
}

let user = "Jane User";

console.log(greet(user));
```

С приведенным выше `tsconfig.json`, команда `tsc` (TypeScript Compiler) скомпилирует этот код в `dist/greeter.js`.

```javascript
// dist/greeter.js
function greet(name) {
    return "Hello, " + name;
}
var user = "Jane User";
console.log(greet(user));
//# sourceMappingURL=greeter.js.map
```

Обратите внимание на `greeter.js.map` файл.  Он используется для отладки TypeScript кода в браузере.

### Жизненный пример

В React проектах, созданных с помощью `create-react-app`, `tsconfig.json` уже настроен.  Он содержит оптимальные настройки для работы с React и TypeScript.  Фреймворки, такие как Angular и Vue.js (через Vue CLI), также генерируют `tsconfig.json` с настройками по умолчанию, которые можно настроить под свои нужды. Например, можно изменить `target`, чтобы сгенерировать код, совместимый с более старыми браузерами, или настроить `moduleResolution` для работы с разными системами модулей.

### Ключевые моменты

*   `tsconfig.json` определяет, как компилируется ваш TypeScript проект.
*   `compilerOptions` содержит основные настройки компилятора.
*   `include` и `exclude` контролируют, какие файлы включаются в компиляцию.
*   Правильная настройка `tsconfig.json` важна для обеспечения правильной компиляции и отладки вашего кода.
*   Изучите документацию TypeScript для более детального понимания всех доступных опций.



## Интерактивный пример

<Sandpack
  template="vanilla-ts"
  files={{
    "/index.ts": `
// src/index.ts
// Этот файл демонстрирует конфигурацию TypeScript и ее влияние на вывод.

// Функция приветствия, принимающая имя и возвращающая приветствие
function greet(name: string): string {
  return \`Привет, \${name}!\`;
}

// Функция для обновления приветствия на странице
function updateGreeting(name: string): void {
  const greetingElement = document.getElementById('greeting');
  if (greetingElement) {
    greetingElement.textContent = greet(name);
  }
}

// Обработчик события для кнопки
document.addEventListener('DOMContentLoaded', () => {
  const nameInput = document.getElementById('nameInput') as HTMLInputElement;
  const greetButton = document.getElementById('greetButton');

  if (greetButton && nameInput) {
    greetButton.addEventListener('click', () => {
      const name = nameInput.value;
      updateGreeting(name);
    });
  }
});

// Начальное приветствие
updateGreeting("Мир");

// Пример использования условной типизации (если включен strict mode)
type StringOrNumber<T> = T extends string ? string : number;

let example: StringOrNumber<string> = "hello"; // Ok
// let example2: StringOrNumber<string> = 123; // Ошибка, если strict mode включен

// Функция, демонстрирующая использование enum
enum Color {
  Red,
  Green,
  Blue,
}

function getColorName(color: Color): string {
  switch (color) {
    case Color.Red:
      return "Красный";
    case Color.Green:
      return "Зеленый";
    case Color.Blue:
      return "Синий";
    default:
      return "Неизвестный цвет";
  }
}

console.log(getColorName(Color.Green)); // Выводит "Зеленый" в консоль
`
,
    "/index.html": `
<!DOCTYPE html>
<html>
<head>
  <title>TypeScript Конфигурация</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background-color: #222;
      color: #eee;
    }
    input {
      padding: 8px;
      margin-right: 10px;
      border: 1px solid #555;
      background-color: #333;
      color: #eee;
    }
    button {
      padding: 8px 12px;
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }
    #greeting {
      margin-top: 20px;
      font-size: 1.2em;
    }
  </style>
</head>
<body>
  <h1>TypeScript Конфигурация</h1>
  <input type="text" id="nameInput" placeholder="Введите имя">
  <button id="greetButton">Поздороваться</button>
  <div id="greeting"></div>
  <script src="./index.ts"><\/script>
</body>
</html>
`,
    "/tsconfig.json": `{
  "compilerOptions": {
    "target": "es5",
    "module": "esnext",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "moduleResolution": "node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",
    "lib": ["dom", "esnext"]
  },
  "include": ["src/**/*", "index.ts"],
  "exclude": ["node_modules"]
}`
  }}
  options={{
    showNavigator: false,
    showLineNumbers: true,
    editorHeight: 400,
    preview: {
      head: '<link rel="stylesheet" href="style.css" />

import { Playground } from '../../components/Playground'

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ AJAX

–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

## –ö–æ–¥—ã –æ—à–∏–±–æ–∫

404, 500, timeout

```javascript
// –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –¥–ª—è –ö–æ–¥—ã –æ—à–∏–±–æ–∫
$('.example').text('Hello from –ö–æ–¥—ã –æ—à–∏–±–æ–∫');
```

## .fail()

–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫

```javascript
// –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –¥–ª—è .fail()
$('.example').text('Hello from .fail()');
```

## Retry –ª–æ–≥–∏–∫–∞

–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏

```javascript
// –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –¥–ª—è Retry –ª–æ–≥–∏–∫–∞
$('.example').text('Hello from Retry –ª–æ–≥–∏–∫–∞');
```

## UX –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

–°–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

```javascript
// –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –¥–ª—è UX –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
$('.example').text('Hello from UX –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö');
```

## üöÄ –ü—Ä–∞–∫—Ç–∏–∫–∞

<Sandpack 
  template="static"
  files={{
    'index.html': `<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AJAX Error Handling</title>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 600px;
      margin: 40px auto;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }
    h2 {
      color: #667eea;
      margin-top: 0;
    }
    .btn-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin: 20px 0;
    }
    button {
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s;
      flex: 1;
      min-width: 120px;
    }
    .btn-404 {
      background: #f39c12;
      color: white;
    }
    .btn-500 {
      background: #e74c3c;
      color: white;
    }
    .btn-timeout {
      background: #95a5a6;
      color: white;
    }
    .btn-retry {
      background: #3498db;
      color: white;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    .status {
      margin: 20px 0;
      padding: 15px;
      border-radius: 8px;
      font-size: 14px;
      display: none;
    }
    .status.show {
      display: block;
      animation: slideIn 0.3s ease-out;
    }
    .status.loading {
      background: #e3f2fd;
      color: #1976d2;
      border-left: 4px solid #1976d2;
    }
    .status.error {
      background: #ffebee;
      color: #c62828;
      border-left: 4px solid #c62828;
    }
    .status.success {
      background: #e8f5e9;
      color: #2e7d32;
      border-left: 4px solid #2e7d32;
    }
    .retry-info {
      font-size: 12px;
      color: #7f8c8d;
      margin-top: 5px;
    }
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .spinner {
      display: inline-block;
      width: 14px;
      height: 14px;
      border: 2px solid #1976d2;
      border-top: 2px solid transparent;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-right: 8px;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>‚ö†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ AJAX</h2>
    <p>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫–∏, —á—Ç–æ–±—ã —Å–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫:</p>
    
    <div class="btn-group">
      <button class="btn-404">404 Not Found</button>
      <button class="btn-500">500 Server Error</button>
      <button class="btn-timeout">‚è±Ô∏è Timeout</button>
    </div>
    
    <div class="btn-group">
      <button class="btn-retry">üîÑ Retry Logic</button>
    </div>
    
    <div class="status" id="status"></div>
  </div>

  <script>
    let retryCount = 0;
    const maxRetries = 3;

    // –°–∏–º—É–ª—è—Ü–∏—è 404 –æ—à–∏–±–∫–∏
    $('.btn-404').click(function() {
      showStatus('loading', '<span class="spinner"></span>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...');
      
      $.ajax({
        url: 'https://jsonplaceholder.typicode.com/posts/999999',
        timeout: 5000
      })
      .done(function(data) {
        showStatus('success', '‚úì –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!');
      })
      .fail(function(jqXHR, textStatus, errorThrown) {
        if (jqXHR.status === 404) {
          showStatus('error', 
            \`‚ùå <strong>–û—à–∏–±–∫–∞ 404:</strong> –†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω<br>
            <small>–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.</small>\`
          );
        }
      });
    });

    // –°–∏–º—É–ª—è—Ü–∏—è 500 –æ—à–∏–±–∫–∏
    $('.btn-500').click(function() {
      showStatus('loading', '<span class="spinner"></span>–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞...');
      
      $.ajax({
        url: 'https://httpstat.us/500',
        timeout: 5000
      })
      .done(function(data) {
        showStatus('success', '‚úì –£—Å–ø–µ—à–Ω–æ!');
      })
      .fail(function(jqXHR, textStatus, errorThrown) {
        if (jqXHR.status === 500) {
          showStatus('error', 
            \`‚ùå <strong>–û—à–∏–±–∫–∞ 500:</strong> –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞<br>
            <small>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å –ø–æ–∑–∂–µ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É.</small>\`
          );
        }
      });
    });

    // –°–∏–º—É–ª—è—Ü–∏—è timeout
    $('.btn-timeout').click(function() {
      showStatus('loading', '<span class="spinner"></span>–û–∂–∏–¥–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ (timeout: 2s)...');
      
      $.ajax({
        url: 'https://httpstat.us/200?sleep=5000',
        timeout: 2000
      })
      .done(function(data) {
        showStatus('success', '‚úì –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã!');
      })
      .fail(function(jqXHR, textStatus, errorThrown) {
        if (textStatus === 'timeout') {
          showStatus('error', 
            \`‚è±Ô∏è <strong>–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è</strong><br>
            <small>–°–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª –≤ —Ç–µ—á–µ–Ω–∏–µ 2 —Å–µ–∫—É–Ω–¥. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.</small>\`
          );
        }
      });
    });

    // Retry –ª–æ–≥–∏–∫–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏
    $('.btn-retry').click(function() {
      retryCount = 0;
      attemptRequest();
    });

    function attemptRequest() {
      const attempt = retryCount + 1;
      showStatus('loading', 
        \`<span class="spinner"></span>–ü–æ–ø—ã—Ç–∫–∞ \${attempt}/\${maxRetries}...\`
      );
      
      // –°–∏–º—É–ª–∏—Ä—É–µ–º –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–π endpoint (50% —à–∞–Ω—Å –Ω–∞ –æ—à–∏–±–∫—É)
      const shouldFail = Math.random() < 0.7;
      const url = shouldFail ? 'https://httpstat.us/503' : 'https://jsonplaceholder.typicode.com/posts/1';
      
      $.ajax({
        url: url,
        timeout: 3000
      })
      .done(function(data) {
        showStatus('success', 
          \`‚úì <strong>–£—Å–ø–µ—à–Ω–æ!</strong> –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã –ø–æ—Å–ª–µ \${attempt} –ø–æ–ø—ã—Ç\${attempt === 1 ? '–∫–∏' : '–æ–∫'}.\`
        );
        retryCount = 0;
      })
      .fail(function(jqXHR, textStatus) {
        retryCount++;
        
        if (retryCount < maxRetries) {
          showStatus('error', 
            \`‚ö†Ô∏è –ü–æ–ø—ã—Ç–∫–∞ \${attempt} –Ω–µ —É–¥–∞–ª–∞—Å—å. –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã...\`
          );
          setTimeout(attemptRequest, 2000);
        } else {
          showStatus('error', 
            \`‚ùå <strong>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</strong><br>
            <small>–í—ã–ø–æ–ª–Ω–µ–Ω–æ \${maxRetries} –ø–æ–ø—ã—Ç–∫–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏–ª–∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</small>\`
          );
          retryCount = 0;
        }
      });
    }

    function showStatus(type, message) {
      const $status = $('#status');
      $status.removeClass('loading error success').addClass(type + ' show');
      $status.html(message);
    }
  </script>
</body>
</html>`,
  }}
/>

---

**–°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–∫:** [–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ ‚Üí](/jquery/ajax-loading)

![Animation Performance](/lessons/css-animation-perf.png)

## CSS: Производительность анимаций (will-change, GPU)

Анимации делают веб-сайты более привлекательными, но неправильная их реализация может существенно снизить производительность. В этом уроке мы рассмотрим, как оптимизировать CSS-анимации, используя свойство `will-change` и задействуя графический процессор (GPU).

### Проблема производительности

Когда браузер анимирует элемент, ему приходится пересчитывать стили и перерисовывать его на каждом кадре анимации. Это может быть ресурсоемким процессом, особенно если анимируется сложное свойство или большое количество элементов. Без оптимизации, анимация может стать "дерганой" и неприятной для пользователя.

### `will-change`: Подсказка для браузера

Свойство `will-change` позволяет сообщить браузеру, какие свойства элемента будут анимироваться. Это дает браузеру возможность заранее подготовиться к изменениям и оптимизировать процесс анимации.

Пример:

```css
.element {
  transition: transform 0.3s ease-in-out;
}

.element:hover {
  transform: translateX(100px);
}

.element:hover {
  will-change: transform; /* Сообщаем браузеру, что будет изменяться transform */
}
```

В этом примере, при наведении на элемент `.element`, он будет смещаться вправо. Добавление `will-change: transform;` позволяет браузеру заранее выделить необходимые ресурсы для плавной анимации `transform`.

**Важно:** Не злоупотребляйте `will-change`. Используйте его только для элементов, которые действительно анимируются. Чрезмерное использование может привести к повышенному потреблению памяти и даже ухудшению производительности.

### GPU: Аппаратное ускорение

Современные браузеры используют графический процессор (GPU) для ускорения определенных операций, включая CSS-анимации. Однако, не все CSS-свойства могут быть ускорены GPU.

Свойства, которые обычно ускоряются GPU:

*   `transform` (translate, rotate, scale)
*   `opacity`

Использование этих свойств для анимации, как правило, обеспечивает более плавную и производительную анимацию, чем, например, анимация `top`, `left`, `width` или `height`.

Пример:

```css
.element {
  transition: transform 0.3s ease-in-out;
}

.element:hover {
  transform: translateX(100px) rotate(45deg); /* Используем transform для анимации */
}
```

Вместо изменения `left` или `top` для перемещения элемента, мы используем `translateX`. Это позволяет браузеру задействовать GPU для анимации, что значительно повышает производительность.

### Жизненный пример

Многие современные веб-сайты и фреймворки активно используют `will-change` и GPU-ускоренные свойства для создания плавных и интерактивных пользовательских интерфейсов.

Например, при создании параллакс-эффекта (когда фон движется с другой скоростью, чем основной контент), часто используют `transform: translateZ(0)` в сочетании с `will-change: transform` для плавного перемещения фоновых изображений. Библиотеки анимаций, такие как GreenSock (GSAP), также активно используют эти методы для оптимизации производительности анимаций.

React и Vue.js фреймворки могут динамически добавлять и удалять классы, содержащие `will-change`, в зависимости от состояния компонента, чтобы оптимизировать рендеринг.

### Ключевые моменты

*   `will-change` подсказывает браузеру, какие свойства будут анимироваться.
*   Используйте `will-change` только для анимируемых элементов.
*   `transform` и `opacity` обычно ускоряются GPU.
*   Избегайте анимации свойств, которые не ускоряются GPU (например, `top`, `left`).
*   Используйте инструменты разработчика браузера для анализа производительности анимаций.
*   Тестируйте анимации на разных устройствах и браузерах.

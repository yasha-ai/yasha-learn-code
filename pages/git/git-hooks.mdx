# Git: Машина времени. Урок 5: Git Hooks

Git Hooks – это как стражники вашего репозитория, автоматически проверяющие и выполняющие действия перед или после определенных событий в Git. Они помогают автоматизировать задачи и поддерживать качество кода.

## Что такое Git Hooks?

Git Hooks – это скрипты, которые Git выполняет автоматически до или после событий, таких как коммит, пуш или мерж. Они позволяют вам настраивать рабочий процесс Git, добавляя собственные проверки, уведомления и автоматические действия. Представьте, что это автоматические помощники, которые помогают вам следить за порядком в вашем коде.

Git Hooks хранятся в каталоге `.git/hooks` внутри вашего репозитория. По умолчанию, там находятся примеры скриптов с расширением `.sample`. Чтобы активировать hook, нужно убрать расширение `.sample` и сделать файл исполняемым (например, `chmod +x pre-commit`).

## Типы Git Hooks и примеры

Существует множество Git Hooks, которые срабатывают в разных точках рабочего процесса. Рассмотрим некоторые из них:

*   **`pre-commit`**: Выполняется перед созданием коммита. Часто используется для проверки стиля кода, запуска тестов или проверки наличия комментариев.

    ```bash
    #!/bin/sh
    # Проверяем, что сообщение коммита не пустое
    if [ -z "$(git commit -m ' ' --allow-empty | grep 'No commit message')" ]; then
      echo "Пожалуйста, добавьте сообщение к коммиту."
      exit 1
    fi
    ```

*   **`prepare-commit-msg`**: Выполняется перед открытием редактора для ввода сообщения коммита. Можно использовать для автоматического добавления информации в сообщение коммита.

    ```bash
    #!/bin/sh
    # Добавляем номер задачи из Jira в сообщение коммита
    echo "#JIRA-123" >> $1
    ```

*   **`commit-msg`**: Проверяет сообщение коммита. Можно использовать для обеспечения соответствия сообщения коммита определенному формату.

    ```bash
    #!/bin/sh
    # Проверяем, что сообщение коммита начинается с префикса
    if ! grep -q "^feat\|^fix\|^docs\|^style\|^refactor\|^test\|^chore" "$1"; then
      echo "Сообщение коммита должно начинаться с одного из префиксов: feat, fix, docs, style, refactor, test, chore"
      exit 1
    fi
    ```

*   **`pre-push`**: Выполняется перед отправкой изменений на удаленный репозиторий. Можно использовать для запуска тестов или проверки соответствия кода стандартам.

    ```bash
    #!/bin/sh
    # Запускаем тесты перед отправкой
    npm test
    if [ $? -ne 0 ]; then
      echo "Тесты не прошли. Отправка отменена."
      exit 1
    fi
    ```

*   **`post-receive`**: Выполняется на удаленном репозитории после получения изменений. Можно использовать для развертывания кода на сервере или отправки уведомлений.

## Жизненный пример

Представьте себе проект веб-приложения, где важно, чтобы все коммиты соответствовали определенному стилю кодирования и проходили тесты перед отправкой на удаленный репозиторий.

*   **`pre-commit`**:  Скрипт запускает линтер (например, ESLint для JavaScript) и форматировщик кода (например, Prettier). Если линтер находит ошибки или код не отформатирован, коммит будет отменен.
*   **`pre-push`**:  Скрипт запускает все автоматизированные тесты. Если хотя бы один тест не проходит, отправка на удаленный репозиторий будет отменена.
*   **`commit-msg`**: Скрипт проверяет, что сообщение коммита соответствует соглашению Conventional Commits (например, "feat: add new feature").

Такой подход позволяет поддерживать высокое качество кода и предотвращать попадание ошибок в основную ветку разработки.  Многие фреймворки и библиотеки, такие как React, Vue.js и Laravel, используют Git Hooks для автоматизации задач и обеспечения качества кода.

## Ключевые моменты

*   Git Hooks – это скрипты, которые выполняются автоматически до или после определенных событий в Git.
*   Они позволяют автоматизировать задачи, такие как проверка стиля кода, запуск тестов и проверка сообщений коммитов.
*   Git Hooks хранятся в каталоге `.git/hooks` внутри репозитория.
*   Использование Git Hooks помогает поддерживать качество кода и предотвращать попадание ошибок в основную ветку разработки.
*   Можно использовать различные языки программирования для написания Git Hooks, например, Bash, Python или JavaScript.
```
